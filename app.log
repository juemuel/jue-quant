2025-07-01 11:42:22.881 | ERROR    | app.routers.router:get_gdp_data:31 - An error has been caught in function 'get_gdp_data', process 'SpawnProcess-1' (49328), thread 'MainThread' (30400):
Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "C:\else_env\Python39\lib\multiprocessing\spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 348
               │     └ 3
               └ <function _main at 0x000001D27ECB6AF0>

  File "C:\else_env\Python39\lib\multiprocessing\spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 348
           │    └ <function BaseProcess._bootstrap at 0x000001D27E95B5E0>
           └ <SpawnProcess name='SpawnProcess-1' parent=40376 started>

  File "C:\else_env\Python39\lib\multiprocessing\process.py", line 315, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x000001D27E956C10>
    └ <SpawnProcess name='SpawnProcess-1' parent=40376 started>

  File "C:\else_env\Python39\lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x000001D27E6AB3D0>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=40376 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=40376 started>
    │    └ <function subprocess_started at 0x000001D27FA3F040>
    └ <SpawnProcess name='SpawnProcess-1' parent=40376 started>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\uvicorn\_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=192, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('127.0.0.1', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x000001D27E576CD0>>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\uvicorn\server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=192, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('127.0.0.1', 8001)>]
           │       │   │    └ <function Server.serve at 0x000001D27FA07040>
           │       │   └ <uvicorn.server.Server object at 0x000001D27E576CD0>
           │       └ <function run at 0x000001D27ECAF820>
           └ <module 'asyncio' from 'C:\\else_env\\Python39\\lib\\asyncio\\__init__.py'>

  File "C:\else_env\Python39\lib\asyncio\runners.py", line 44, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x000001D27F9FDA40>
           │    └ <function BaseEventLoop.run_until_complete at 0x000001D27F24E670>
           └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 629, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x000001D27F24E5E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 596, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x000001D27F251160>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 1890, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x000001D27F1F0DC0>
    └ <Handle <TaskStepMethWrapper object at 0x000001D231CCA0A0>()>

  File "C:\else_env\Python39\lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x000001D231CCA0A0>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x000001D231CCA0A0>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x000001D231CCA0A0>()>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\base.py", line 141, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000001D231CBC040>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001D231C8AEE0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x000001D231C8B400>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x000001D231C8B3A0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000001D231CBC040>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001D231C8AEE0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000001D231C8B340>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x000001D231C8B400>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
          │                            │    │    │     │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000001D231CBC040>
          │                            │    │    │     │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001D231C8AEE0>
          │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │                            │    │    └ <starlette.requests.Request object at 0x000001D231CE1220>
          │                            │    └ <fastapi.routing.APIRouter object at 0x000001D201FD0D90>
          │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000001D231C8B340>
          └ <function wrap_app_handling_exceptions at 0x000001D201EC7160>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001D231CF4AF0>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001D231C8AEE0>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          └ <fastapi.routing.APIRouter object at 0x000001D201FD0D90>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001D231CF4AF0>
          │    │                │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001D231C8AEE0>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0x000001D201FD0D90>>
          └ <fastapi.routing.APIRouter object at 0x000001D201FD0D90>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 734, in app
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001D231CF4AF0>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001D231C8AEE0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x000001D201ED9820>
          └ APIRoute(path='/macro/gdp', name='get_gdp_data', methods=['GET'])

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001D231CF4AF0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001D231C8AEE0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x000001D231C77EE0>
          └ APIRoute(path='/macro/gdp', name='get_gdp_data', methods=['GET'])

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
          │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001D231CF4AF0>
          │                            │    │        │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001D231C8AEE0>
          │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │                            │    └ <starlette.requests.Request object at 0x000001D231CE1760>
          │                            └ <function request_response.<locals>.app.<locals>.app at 0x000001D231CF4B80>
          └ <function wrap_app_handling_exceptions at 0x000001D201EC7160>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001D231CF4C10>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001D231C8AEE0>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          └ <function request_response.<locals>.app.<locals>.app at 0x000001D231CF4B80>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
                     │ └ <starlette.requests.Request object at 0x000001D231CE1760>
                     └ <function get_request_handler.<locals>.app at 0x000001D231C77E50>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x000001D201EDF430>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {}
                 │         └ <function get_gdp_data at 0x000001D231C774C0>
                 └ Dependant(path_params=[], query_params=[], header_params=[], cookie_params=[], body_params=[], dependencies=[], security_requ...

> File "C:\proj\ELSE\SELF\py-fastapi-demo\app\routers\router.py", line 31, in get_gdp_data
    return macro_service.get_gdp_data()
           │             └ <function get_gdp_data at 0x000001D231AB9AF0>
           └ <module 'app.services.macro_service' from 'C:\\proj\\ELSE\\SELF\\py-fastapi-demo\\app\\services\\macro_service.py'>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\app\services\macro_service.py", line 12, in get_gdp_data
    raise Exception("Testing macro_service execution")  # 强制抛出异常

Exception: Testing macro_service execution
2025-07-01 12:39:55.144 | INFO     | app.services.data_service:get_stock_history:19 - Fetching stock history data for 000001.SH from akshare
2025-07-01 12:39:55.144 | ERROR    | app.services.data_service:get_stock_history:53 - Error fetching stock history data
Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "C:\else_env\Python39\lib\multiprocessing\spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 324
               │     └ 3
               └ <function _main at 0x00000253E0436AF0>

  File "C:\else_env\Python39\lib\multiprocessing\spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 324
           │    └ <function BaseProcess._bootstrap at 0x00000253E00B45E0>
           └ <SpawnProcess name='SpawnProcess-1' parent=47996 started>

  File "C:\else_env\Python39\lib\multiprocessing\process.py", line 315, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x00000253E00B6C10>
    └ <SpawnProcess name='SpawnProcess-1' parent=47996 started>

  File "C:\else_env\Python39\lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x00000253DFA0B3D0>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=47996 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=47996 started>
    │    └ <function subprocess_started at 0x00000253E25CF040>
    └ <SpawnProcess name='SpawnProcess-1' parent=47996 started>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\uvicorn\_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=352, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('127.0.0.1', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x00000253DF986CD0>>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\uvicorn\server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=352, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('127.0.0.1', 8001)>]
           │       │   │    └ <function Server.serve at 0x00000253E2597040>
           │       │   └ <uvicorn.server.Server object at 0x00000253DF986CD0>
           │       └ <function run at 0x00000253E042F820>
           └ <module 'asyncio' from 'C:\\else_env\\Python39\\lib\\asyncio\\__init__.py'>

  File "C:\else_env\Python39\lib\asyncio\runners.py", line 44, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x00000253E258DA40>
           │    └ <function BaseEventLoop.run_until_complete at 0x00000253E1DEE670>
           └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 629, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x00000253E1DEE5E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 596, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x00000253E1DF1160>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 1890, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x00000253E1D90DC0>
    └ <Handle <TaskStepMethWrapper object at 0x000002539354BF10>()>

  File "C:\else_env\Python39\lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x000002539354BF10>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x000002539354BF10>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x000002539354BF10>()>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\base.py", line 141, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000002539354D040>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002539351BEE0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x000002539351C370>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x000002539351C310>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000002539354D040>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002539351BEE0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000002539351C2B0>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x000002539351C370>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
          │                            │    │    │     │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000002539354D040>
          │                            │    │    │     │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002539351BEE0>
          │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │                            │    │    └ <starlette.requests.Request object at 0x0000025393571130>
          │                            │    └ <fastapi.routing.APIRouter object at 0x00000253E36CBBB0>
          │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000002539351C2B0>
          └ <function wrap_app_handling_exceptions at 0x00000253E360A160>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000025393584AF0>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002539351BEE0>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          └ <fastapi.routing.APIRouter object at 0x00000253E36CBBB0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000025393584AF0>
          │    │                │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002539351BEE0>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0x00000253E36CBBB0>>
          └ <fastapi.routing.APIRouter object at 0x00000253E36CBBB0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 734, in app
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000025393584AF0>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002539351BEE0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x00000253E3629820>
          └ APIRoute(path='/data/index', name='get_history_data', methods=['GET'])

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000025393584AF0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002539351BEE0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x0000025393509940>
          └ APIRoute(path='/data/index', name='get_history_data', methods=['GET'])

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
          │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000025393584AF0>
          │                            │    │        │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002539351BEE0>
          │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │                            │    └ <starlette.requests.Request object at 0x0000025393571790>
          │                            └ <function request_response.<locals>.app.<locals>.app at 0x0000025393584B80>
          └ <function wrap_app_handling_exceptions at 0x00000253E360A160>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000025393584C10>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002539351BEE0>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          └ <function request_response.<locals>.app.<locals>.app at 0x0000025393584B80>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
                     │ └ <starlette.requests.Request object at 0x0000025393571790>
                     └ <function get_request_handler.<locals>.app at 0x0000025393509B80>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x00000253E362F430>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'source': 'akshare', 'market': 'SH', 'code': '000001'}
                 │         └ <function get_history_data at 0x00000253933503A0>
                 └ Dependant(path_params=[], query_params=[ModelField(field_info=Query(akshare), name='source', mode='validation'), ModelField(f...

  File "C:\proj\ELSE\SELF\py-fastapi-demo\app\routers\router.py", line 11, in get_history_data
    df = data_service.get_stock_history(source=source, code=code, market=market)
         │            │                        │            │            └ 'SH'
         │            │                        │            └ '000001'
         │            │                        └ 'akshare'
         │            └ <function get_stock_history at 0x00000253F4E36040>
         └ <module 'app.services.data_service' from 'C:\\proj\\ELSE\\SELF\\py-fastapi-demo\\app\\services\\data_service.py'>

> File "C:\proj\ELSE\SELF\py-fastapi-demo\app\services\data_service.py", line 21, in get_stock_history
    df = data_provider.get_stock_history(code=f"{code}.{market}")
         │             └ <function AkShareProvider.get_stock_history at 0x00000253F41F9C10>
         └ <data_providers.akshare.AkShareProvider object at 0x00000253E36D3040>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\data_providers\akshare.py", line 15, in get_stock_history
    df = ak.stock_zh_a_hist_df(symbol=code, period='daily', start_date=start_date, end_date=end_date, adjust='hfq')
         │                            │                                │                    └ None
         │                            │                                └ None
         │                            └ '000001.SH'
         └ <module 'akshare' from 'C:\\proj\\ELSE\\SELF\\py-fastapi-demo\\.venv\\lib\\site-packages\\akshare\\__init__.py'>

AttributeError: module 'akshare' has no attribute 'stock_zh_a_hist_df'
2025-07-01 13:27:01.946 | INFO     | app.services.data_service:get_stock_history:19 - Fetching stock history data for 000001.SH from akshare
2025-07-01 13:27:02.025 | WARNING  | app.services.data_service:get_stock_history:24 - No data returned from akshare for 000001.SH
2025-07-01 13:39:17.947 | INFO     | app.services.data_service:get_stock_history:21 - Fetching stock history data for 000001.SH from akshare
2025-07-01 13:39:17.948 | ERROR    | app.services.data_service:get_stock_history:55 - Error fetching stock history data
Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "C:\else_env\Python39\lib\multiprocessing\spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 344
               │     └ 3
               └ <function _main at 0x0000023E53996AF0>

  File "C:\else_env\Python39\lib\multiprocessing\spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 344
           │    └ <function BaseProcess._bootstrap at 0x0000023E5364B5E0>
           └ <SpawnProcess name='SpawnProcess-6' parent=36700 started>

  File "C:\else_env\Python39\lib\multiprocessing\process.py", line 315, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x0000023E53646C10>
    └ <SpawnProcess name='SpawnProcess-6' parent=36700 started>

  File "C:\else_env\Python39\lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x0000023E52F6B3D0>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-6' parent=36700 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-6' parent=36700 started>
    │    └ <function subprocess_started at 0x0000023E55B1F040>
    └ <SpawnProcess name='SpawnProcess-6' parent=36700 started>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\uvicorn\_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=460, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('127.0.0.1', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x0000023E52EE6CD0>>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\uvicorn\server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=460, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('127.0.0.1', 8001)>]
           │       │   │    └ <function Server.serve at 0x0000023E55AE7040>
           │       │   └ <uvicorn.server.Server object at 0x0000023E52EE6CD0>
           │       └ <function run at 0x0000023E5398E820>
           └ <module 'asyncio' from 'C:\\else_env\\Python39\\lib\\asyncio\\__init__.py'>

  File "C:\else_env\Python39\lib\asyncio\runners.py", line 44, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x0000023E55ADDA40>
           │    └ <function BaseEventLoop.run_until_complete at 0x0000023E5532E670>
           └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 629, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x0000023E5532E5E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 596, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x0000023E55331160>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 1890, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x0000023E552D0DC0>
    └ <Handle <TaskStepMethWrapper object at 0x0000023E06A365E0>()>

  File "C:\else_env\Python39\lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x0000023E06A365E0>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x0000023E06A365E0>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x0000023E06A365E0>()>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\base.py", line 141, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x0000023E06A2F040>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000023E069FFEE0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x0000023E069FEA00>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x0000023E069FE9A0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x0000023E06A2F040>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000023E069FFEE0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x0000023E069FE940>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x0000023E069FEA00>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
          │                            │    │    │     │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x0000023E06A2F040>
          │                            │    │    │     │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000023E069FFEE0>
          │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │                            │    │    └ <starlette.requests.Request object at 0x0000023E06A53550>
          │                            │    └ <fastapi.routing.APIRouter object at 0x0000023E56C1BBB0>
          │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x0000023E069FE940>
          └ <function wrap_app_handling_exceptions at 0x0000023E56B5D160>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000023E06A65AF0>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000023E069FFEE0>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          └ <fastapi.routing.APIRouter object at 0x0000023E56C1BBB0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000023E06A65AF0>
          │    │                │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000023E069FFEE0>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0x0000023E56C1BBB0>>
          └ <fastapi.routing.APIRouter object at 0x0000023E56C1BBB0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 734, in app
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000023E06A65AF0>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000023E069FFEE0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x0000023E56B79820>
          └ APIRoute(path='/data/index', name='get_history_data', methods=['GET'])

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000023E06A65AF0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000023E069FFEE0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x0000023E069EB940>
          └ APIRoute(path='/data/index', name='get_history_data', methods=['GET'])

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
          │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000023E06A65AF0>
          │                            │    │        │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000023E069FFEE0>
          │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │                            │    └ <starlette.requests.Request object at 0x0000023E06A533A0>
          │                            └ <function request_response.<locals>.app.<locals>.app at 0x0000023E06A65B80>
          └ <function wrap_app_handling_exceptions at 0x0000023E56B5D160>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000023E06A65C10>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000023E069FFEE0>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          └ <function request_response.<locals>.app.<locals>.app at 0x0000023E06A65B80>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
                     │ └ <starlette.requests.Request object at 0x0000023E06A533A0>
                     └ <function get_request_handler.<locals>.app at 0x0000023E069EBB80>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x0000023E56B7F430>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'source': 'akshare', 'market': 'SH', 'code': '000001', 'start_date': '20050501', 'end_date': '20050520'}
                 │         └ <function get_history_data at 0x0000023E0682F430>
                 └ Dependant(path_params=[], query_params=[ModelField(field_info=Query(akshare), name='source', mode='validation'), ModelField(f...

  File "C:\proj\ELSE\SELF\py-fastapi-demo\app\routers\router.py", line 11, in get_history_data
    df = data_service.get_stock_history(source=source, code=code, market=market, start_date=start_date, end_date=end_date)
         │            │                        │            │            │                  │                    └ '20050520'
         │            │                        │            │            │                  └ '20050501'
         │            │                        │            │            └ 'SH'
         │            │                        │            └ '000001'
         │            │                        └ 'akshare'
         │            └ <function get_stock_history at 0x0000023E683850D0>
         └ <module 'app.services.data_service' from 'C:\\proj\\ELSE\\SELF\\py-fastapi-demo\\app\\services\\data_service.py'>

> File "C:\proj\ELSE\SELF\py-fastapi-demo\app\services\data_service.py", line 23, in get_stock_history
    df = data_provider.get_stock_history(source=source, code=code, market=market, start_date=start_date, end_date=end_date)
         │             │                        │            │            │                  │                    └ '20050520'
         │             │                        │            │            │                  └ '20050501'
         │             │                        │            │            └ 'SH'
         │             │                        │            └ '000001'
         │             │                        └ 'akshare'
         │             └ <function AkShareProvider.get_stock_history at 0x0000023E6774CCA0>
         └ <data_providers.akshare.AkShareProvider object at 0x0000023E56C23040>

TypeError: get_stock_history() got an unexpected keyword argument 'source'
2025-07-01 13:40:12.133 | INFO     | app.services.data_service:get_stock_history:21 - Fetching stock history data for 000001.SH from akshare
2025-07-01 13:43:55.858 | INFO     | app.services.data_service:get_stock_history:21 - Fetching stock history data for 000001.SH from akshare
2025-07-01 13:45:54.458 | INFO     | app.services.data_service:get_stock_history:21 - [Bridge]获取股票历史行情数据并标准化输出格式 for 000001.SH from akshare
2025-07-01 13:52:08.129 | INFO     | app.services.data_service:get_stock_history:21 - [Bridge]获取股票历史行情数据并标准化输出格式 for 000001.SH from tushare
2025-07-01 13:53:43.442 | INFO     | app.services.data_service:get_stock_history:21 - [Bridge]获取股票历史行情数据并标准化输出格式 for 000001.SH from yfinance
2025-07-01 13:54:06.295 | INFO     | app.services.data_service:get_stock_history:21 - [Bridge]获取股票历史行情数据并标准化输出格式 for 000001.SH from qstock
2025-07-01 13:55:06.269 | ERROR    | app.routers.router:get_gdp_data:31 - An error has been caught in function 'get_gdp_data', process 'SpawnProcess-14' (46560), thread 'MainThread' (26892):
Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "C:\else_env\Python39\lib\multiprocessing\spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 340
               │     └ 3
               └ <function _main at 0x0000020BB0C96AF0>

  File "C:\else_env\Python39\lib\multiprocessing\spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 340
           │    └ <function BaseProcess._bootstrap at 0x0000020BB093B5E0>
           └ <SpawnProcess name='SpawnProcess-14' parent=36700 started>

  File "C:\else_env\Python39\lib\multiprocessing\process.py", line 315, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x0000020BB0936C10>
    └ <SpawnProcess name='SpawnProcess-14' parent=36700 started>

  File "C:\else_env\Python39\lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x0000020BB068B3D0>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-14' parent=36700 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-14' parent=36700 started>
    │    └ <function subprocess_started at 0x0000020BB2E30040>
    └ <SpawnProcess name='SpawnProcess-14' parent=36700 started>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\uvicorn\_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=604, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('127.0.0.1', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x0000020BB01E6CD0>>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\uvicorn\server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=604, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('127.0.0.1', 8001)>]
           │       │   │    └ <function Server.serve at 0x0000020BB2DF7040>
           │       │   └ <uvicorn.server.Server object at 0x0000020BB01E6CD0>
           │       └ <function run at 0x0000020BB0C91820>
           └ <module 'asyncio' from 'C:\\else_env\\Python39\\lib\\asyncio\\__init__.py'>

  File "C:\else_env\Python39\lib\asyncio\runners.py", line 44, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x0000020BB2DEDA40>
           │    └ <function BaseEventLoop.run_until_complete at 0x0000020BB264E670>
           └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 629, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x0000020BB264E5E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 596, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x0000020BB2651160>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 1890, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x0000020BB25F0DC0>
    └ <Handle <TaskStepMethWrapper object at 0x0000020BE3C63F10>()>

  File "C:\else_env\Python39\lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x0000020BE3C63F10>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x0000020BE3C63F10>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x0000020BE3C63F10>()>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\base.py", line 141, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x0000020BE3CD2F70>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000020BE3C5E8B0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x0000020BE3C5D910>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x0000020BE3C5D8B0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x0000020BE3CD2F70>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000020BE3C5E8B0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x0000020BE3C5D850>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x0000020BE3C5D910>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
          │                            │    │    │     │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x0000020BE3CD2F70>
          │                            │    │    │     │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000020BE3C5E8B0>
          │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │                            │    │    └ <starlette.requests.Request object at 0x0000020BE3C8B730>
          │                            │    └ <fastapi.routing.APIRouter object at 0x0000020BB3F2BBB0>
          │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x0000020BE3C5D850>
          └ <function wrap_app_handling_exceptions at 0x0000020BB3E6A160>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000020BE3CD2C10>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000020BE3C5E8B0>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          └ <fastapi.routing.APIRouter object at 0x0000020BB3F2BBB0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000020BE3CD2C10>
          │    │                │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000020BE3C5E8B0>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0x0000020BB3F2BBB0>>
          └ <fastapi.routing.APIRouter object at 0x0000020BB3F2BBB0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 734, in app
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000020BE3CD2C10>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000020BE3C5E8B0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x0000020BB3E89820>
          └ APIRoute(path='/macro/gdp', name='get_gdp_data', methods=['GET'])

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000020BE3CD2C10>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000020BE3C5E8B0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x0000020BE3C42F70>
          └ APIRoute(path='/macro/gdp', name='get_gdp_data', methods=['GET'])

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
          │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000020BE3CD2C10>
          │                            │    │        │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000020BE3C5E8B0>
          │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │                            │    └ <starlette.requests.Request object at 0x0000020BE3CA5610>
          │                            └ <function request_response.<locals>.app.<locals>.app at 0x0000020BE3CD2B80>
          └ <function wrap_app_handling_exceptions at 0x0000020BB3E6A160>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000020BE3CD2EE0>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000020BE3C5E8B0>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          └ <function request_response.<locals>.app.<locals>.app at 0x0000020BE3CD2B80>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
                     │ └ <starlette.requests.Request object at 0x0000020BE3CA5610>
                     └ <function get_request_handler.<locals>.app at 0x0000020BE3C42EE0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x0000020BB3E8F430>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {}
                 │         └ <function get_gdp_data at 0x0000020BE3C42550>
                 └ Dependant(path_params=[], query_params=[], header_params=[], cookie_params=[], body_params=[], dependencies=[], security_requ...

> File "C:\proj\ELSE\SELF\py-fastapi-demo\app\routers\router.py", line 31, in get_gdp_data
    return macro_service.get_gdp_data()
           │             └ <function get_gdp_data at 0x0000020BE3A7EC10>
           └ <module 'app.services.macro_service' from 'C:\\proj\\ELSE\\SELF\\py-fastapi-demo\\app\\services\\macro_service.py'>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\app\services\macro_service.py", line 12, in get_gdp_data
    raise Exception("Testing macro_service execution")  # 强制抛出异常

Exception: Testing macro_service execution
2025-07-01 14:00:20.132 | ERROR    | app.routers.router:get_gdp_data:19 - An error has been caught in function 'get_gdp_data', process 'SpawnProcess-18' (52328), thread 'MainThread' (41348):
Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "C:\else_env\Python39\lib\multiprocessing\spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 356
               │     └ 3
               └ <function _main at 0x0000019C54666AF0>

  File "C:\else_env\Python39\lib\multiprocessing\spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 356
           │    └ <function BaseProcess._bootstrap at 0x0000019C542EB5E0>
           └ <SpawnProcess name='SpawnProcess-18' parent=36700 started>

  File "C:\else_env\Python39\lib\multiprocessing\process.py", line 315, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x0000019C542E6C10>
    └ <SpawnProcess name='SpawnProcess-18' parent=36700 started>

  File "C:\else_env\Python39\lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x0000019C5403B3D0>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-18' parent=36700 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-18' parent=36700 started>
    │    └ <function subprocess_started at 0x0000019C567FF040>
    └ <SpawnProcess name='SpawnProcess-18' parent=36700 started>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\uvicorn\_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=828, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('127.0.0.1', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x0000019C53F06CD0>>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\uvicorn\server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=828, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('127.0.0.1', 8001)>]
           │       │   │    └ <function Server.serve at 0x0000019C567C7040>
           │       │   └ <uvicorn.server.Server object at 0x0000019C53F06CD0>
           │       └ <function run at 0x0000019C5465E820>
           └ <module 'asyncio' from 'C:\\else_env\\Python39\\lib\\asyncio\\__init__.py'>

  File "C:\else_env\Python39\lib\asyncio\runners.py", line 44, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x0000019C567BDA40>
           │    └ <function BaseEventLoop.run_until_complete at 0x0000019C55FFE670>
           └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 629, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x0000019C55FFE5E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 596, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x0000019C56001160>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 1890, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x0000019C55F90DC0>
    └ <Handle <TaskStepMethWrapper object at 0x0000019C0777A430>()>

  File "C:\else_env\Python39\lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x0000019C0777A430>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x0000019C0777A430>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x0000019C0777A430>()>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\base.py", line 141, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x0000019C0776F1F0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000019C0776F0D0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x0000019C0773E790>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x0000019C0773E730>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x0000019C0776F1F0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000019C0776F0D0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x0000019C0773E6D0>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x0000019C0773E790>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
          │                            │    │    │     │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x0000019C0776F1F0>
          │                            │    │    │     │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000019C0776F0D0>
          │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │                            │    │    └ <starlette.requests.Request object at 0x0000019C07795430>
          │                            │    └ <fastapi.routing.APIRouter object at 0x0000019C578FBBB0>
          │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x0000019C0773E6D0>
          └ <function wrap_app_handling_exceptions at 0x0000019C5783A160>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000019C077A9CA0>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000019C0776F0D0>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          └ <fastapi.routing.APIRouter object at 0x0000019C578FBBB0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000019C077A9CA0>
          │    │                │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000019C0776F0D0>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0x0000019C578FBBB0>>
          └ <fastapi.routing.APIRouter object at 0x0000019C578FBBB0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 734, in app
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000019C077A9CA0>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000019C0776F0D0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x0000019C57859820>
          └ APIRoute(path='/macro/gdp', name='get_gdp_data', methods=['GET'])

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000019C077A9CA0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000019C0776F0D0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x0000019C07722DC0>
          └ APIRoute(path='/macro/gdp', name='get_gdp_data', methods=['GET'])

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
          │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000019C077A9CA0>
          │                            │    │        │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000019C0776F0D0>
          │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │                            │    └ <starlette.requests.Request object at 0x0000019C07795280>
          │                            └ <function request_response.<locals>.app.<locals>.app at 0x0000019C077A9D30>
          └ <function wrap_app_handling_exceptions at 0x0000019C5783A160>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000019C077A9DC0>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000019C0776F0D0>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          └ <function request_response.<locals>.app.<locals>.app at 0x0000019C077A9D30>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
                     │ └ <starlette.requests.Request object at 0x0000019C07795280>
                     └ <function get_request_handler.<locals>.app at 0x0000019C07722E50>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x0000019C5785F430>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'source': 'akshare'}
                 │         └ <function get_gdp_data at 0x0000019C07722310>
                 └ Dependant(path_params=[], query_params=[ModelField(field_info=Query(akshare), name='source', mode='validation')], header_para...

> File "C:\proj\ELSE\SELF\py-fastapi-demo\app\routers\router.py", line 19, in get_gdp_data
    return macro_service.get_gdp_data(source=source)
           │             │                   └ 'akshare'
           │             └ <function get_gdp_data at 0x0000019C0755AC10>
           └ <module 'app.services.macro_service' from 'C:\\proj\\ELSE\\SELF\\py-fastapi-demo\\app\\services\\macro_service.py'>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\app\services\macro_service.py", line 13, in get_gdp_data
    logger.info(f"[Bridge]获取gdp数据并标准化输出格式 from {source}")
    └ <module 'core.logger' from 'C:\\proj\\ELSE\\SELF\\py-fastapi-demo\\core\\logger.py'>

AttributeError: module 'core.logger' has no attribute 'info'
2025-07-01 14:00:26.599 | ERROR    | app.routers.router:get_gdp_data:19 - An error has been caught in function 'get_gdp_data', process 'SpawnProcess-18' (52328), thread 'MainThread' (41348):
Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "C:\else_env\Python39\lib\multiprocessing\spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 356
               │     └ 3
               └ <function _main at 0x0000019C54666AF0>

  File "C:\else_env\Python39\lib\multiprocessing\spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 356
           │    └ <function BaseProcess._bootstrap at 0x0000019C542EB5E0>
           └ <SpawnProcess name='SpawnProcess-18' parent=36700 started>

  File "C:\else_env\Python39\lib\multiprocessing\process.py", line 315, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x0000019C542E6C10>
    └ <SpawnProcess name='SpawnProcess-18' parent=36700 started>

  File "C:\else_env\Python39\lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x0000019C5403B3D0>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-18' parent=36700 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-18' parent=36700 started>
    │    └ <function subprocess_started at 0x0000019C567FF040>
    └ <SpawnProcess name='SpawnProcess-18' parent=36700 started>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\uvicorn\_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=828, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('127.0.0.1', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x0000019C53F06CD0>>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\uvicorn\server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=828, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('127.0.0.1', 8001)>]
           │       │   │    └ <function Server.serve at 0x0000019C567C7040>
           │       │   └ <uvicorn.server.Server object at 0x0000019C53F06CD0>
           │       └ <function run at 0x0000019C5465E820>
           └ <module 'asyncio' from 'C:\\else_env\\Python39\\lib\\asyncio\\__init__.py'>

  File "C:\else_env\Python39\lib\asyncio\runners.py", line 44, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x0000019C567BDA40>
           │    └ <function BaseEventLoop.run_until_complete at 0x0000019C55FFE670>
           └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 629, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x0000019C55FFE5E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 596, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x0000019C56001160>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 1890, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x0000019C55F90DC0>
    └ <Handle <TaskStepMethWrapper object at 0x0000019C0778A640>()>

  File "C:\else_env\Python39\lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x0000019C0778A640>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x0000019C0778A640>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x0000019C0778A640>()>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\base.py", line 141, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x0000019C0776F0D0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000019C0776F1F0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x0000019C0773E790>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x0000019C0773E730>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x0000019C0776F0D0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000019C0776F1F0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x0000019C0773E6D0>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x0000019C0773E790>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
          │                            │    │    │     │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x0000019C0776F0D0>
          │                            │    │    │     │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000019C0776F1F0>
          │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │                            │    │    └ <starlette.requests.Request object at 0x0000019C0778AC40>
          │                            │    └ <fastapi.routing.APIRouter object at 0x0000019C578FBBB0>
          │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x0000019C0773E6D0>
          └ <function wrap_app_handling_exceptions at 0x0000019C5783A160>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000019C07878D30>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000019C0776F1F0>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          └ <fastapi.routing.APIRouter object at 0x0000019C578FBBB0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000019C07878D30>
          │    │                │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000019C0776F1F0>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0x0000019C578FBBB0>>
          └ <fastapi.routing.APIRouter object at 0x0000019C578FBBB0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 734, in app
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000019C07878D30>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000019C0776F1F0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x0000019C57859820>
          └ APIRoute(path='/macro/gdp', name='get_gdp_data', methods=['GET'])

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000019C07878D30>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000019C0776F1F0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x0000019C07722DC0>
          └ APIRoute(path='/macro/gdp', name='get_gdp_data', methods=['GET'])

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
          │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000019C07878D30>
          │                            │    │        │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000019C0776F1F0>
          │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │                            │    └ <starlette.requests.Request object at 0x0000019C0778A760>
          │                            └ <function request_response.<locals>.app.<locals>.app at 0x0000019C07878CA0>
          └ <function wrap_app_handling_exceptions at 0x0000019C5783A160>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000019C07878E50>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000019C0776F1F0>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          └ <function request_response.<locals>.app.<locals>.app at 0x0000019C07878CA0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
                     │ └ <starlette.requests.Request object at 0x0000019C0778A760>
                     └ <function get_request_handler.<locals>.app at 0x0000019C07722E50>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x0000019C5785F430>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'source': 'akshare'}
                 │         └ <function get_gdp_data at 0x0000019C07722310>
                 └ Dependant(path_params=[], query_params=[ModelField(field_info=Query(akshare), name='source', mode='validation')], header_para...

> File "C:\proj\ELSE\SELF\py-fastapi-demo\app\routers\router.py", line 19, in get_gdp_data
    return macro_service.get_gdp_data(source=source)
           │             │                   └ 'akshare'
           │             └ <function get_gdp_data at 0x0000019C0755AC10>
           └ <module 'app.services.macro_service' from 'C:\\proj\\ELSE\\SELF\\py-fastapi-demo\\app\\services\\macro_service.py'>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\app\services\macro_service.py", line 13, in get_gdp_data
    logger.info(f"[Bridge]获取gdp数据并标准化输出格式 from {source}")
    └ <module 'core.logger' from 'C:\\proj\\ELSE\\SELF\\py-fastapi-demo\\core\\logger.py'>

AttributeError: module 'core.logger' has no attribute 'info'
2025-07-01 14:01:30.628 | INFO     | app.services.macro_service:get_gdp_data:13 - [Bridge]获取gdp数据并标准化输出格式 from akshare
2025-07-01 14:06:15.624 | INFO     | app.services.macro_service:get_gdp_data:13 - [Bridge]获取gdp数据并标准化输出格式 from tushare
2025-07-01 14:06:15.624 | ERROR    | app.routers.router:get_gdp_data:19 - An error has been caught in function 'get_gdp_data', process 'SpawnProcess-23' (31436), thread 'MainThread' (41664):
Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "C:\else_env\Python39\lib\multiprocessing\spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 340
               │     └ 3
               └ <function _main at 0x0000024706066AF0>

  File "C:\else_env\Python39\lib\multiprocessing\spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 340
           │    └ <function BaseProcess._bootstrap at 0x0000024705CEB5E0>
           └ <SpawnProcess name='SpawnProcess-23' parent=36700 started>

  File "C:\else_env\Python39\lib\multiprocessing\process.py", line 315, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x0000024705CE6C10>
    └ <SpawnProcess name='SpawnProcess-23' parent=36700 started>

  File "C:\else_env\Python39\lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x000002470563B3D0>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-23' parent=36700 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-23' parent=36700 started>
    │    └ <function subprocess_started at 0x00000247081FF040>
    └ <SpawnProcess name='SpawnProcess-23' parent=36700 started>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\uvicorn\_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=568, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('127.0.0.1', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x00000247055B6CD0>>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\uvicorn\server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=568, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('127.0.0.1', 8001)>]
           │       │   │    └ <function Server.serve at 0x00000247081C7040>
           │       │   └ <uvicorn.server.Server object at 0x00000247055B6CD0>
           │       └ <function run at 0x000002470606B820>
           └ <module 'asyncio' from 'C:\\else_env\\Python39\\lib\\asyncio\\__init__.py'>

  File "C:\else_env\Python39\lib\asyncio\runners.py", line 44, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x00000247081BDA40>
           │    └ <function BaseEventLoop.run_until_complete at 0x0000024707A0E670>
           └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 629, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x0000024707A0E5E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 596, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x0000024707A11160>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 1890, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x00000247079ACDC0>
    └ <Handle <TaskStepMethWrapper object at 0x000002473906A580>()>

  File "C:\else_env\Python39\lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x000002473906A580>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x000002473906A580>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x000002473906A580>()>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\base.py", line 141, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000002473905D280>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002473905D160>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x000002473902F8E0>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x000002473902F880>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000002473905D280>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002473905D160>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000002473902F820>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x000002473902F8E0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
          │                            │    │    │     │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000002473905D280>
          │                            │    │    │     │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002473905D160>
          │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │                            │    │    └ <starlette.requests.Request object at 0x00000247390864C0>
          │                            │    └ <fastapi.routing.APIRouter object at 0x00000247092FBBB0>
          │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000002473902F820>
          └ <function wrap_app_handling_exceptions at 0x000002470923A160>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000024739099D30>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002473905D160>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          └ <fastapi.routing.APIRouter object at 0x00000247092FBBB0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000024739099D30>
          │    │                │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002473905D160>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0x00000247092FBBB0>>
          └ <fastapi.routing.APIRouter object at 0x00000247092FBBB0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 734, in app
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000024739099D30>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002473905D160>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x0000024709259820>
          └ APIRoute(path='/macro/gdp', name='get_gdp_data', methods=['GET'])

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000024739099D30>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002473905D160>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x0000024739012E50>
          └ APIRoute(path='/macro/gdp', name='get_gdp_data', methods=['GET'])

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
          │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000024739099D30>
          │                            │    │        │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002473905D160>
          │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │                            │    └ <starlette.requests.Request object at 0x0000024739086310>
          │                            └ <function request_response.<locals>.app.<locals>.app at 0x0000024739099DC0>
          └ <function wrap_app_handling_exceptions at 0x000002470923A160>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000024739099E50>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002473905D160>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          └ <function request_response.<locals>.app.<locals>.app at 0x0000024739099DC0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
                     │ └ <starlette.requests.Request object at 0x0000024739086310>
                     └ <function get_request_handler.<locals>.app at 0x0000024739012EE0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x000002470925F430>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'source': 'tushare'}
                 │         └ <function get_gdp_data at 0x00000247390123A0>
                 └ Dependant(path_params=[], query_params=[ModelField(field_info=Query(akshare), name='source', mode='validation')], header_para...

> File "C:\proj\ELSE\SELF\py-fastapi-demo\app\routers\router.py", line 19, in get_gdp_data
    return macro_service.get_gdp_data(source=source)
           │             │                   └ 'tushare'
           │             └ <function get_gdp_data at 0x0000024738E50EE0>
           └ <module 'app.services.macro_service' from 'C:\\proj\\ELSE\\SELF\\py-fastapi-demo\\app\\services\\macro_service.py'>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\app\services\macro_service.py", line 15, in get_gdp_data
    df = data_provider.get_macro_gdp_data()
         │             └ <function AkShareProvider.get_macro_gdp_data at 0x0000024719E2CD30>
         └ <data_providers.akshare.AkShareProvider object at 0x0000024709303220>

TypeError: get_macro_gdp_data() missing 1 required positional argument: 'source'
2025-07-01 14:06:59.739 | INFO     | app.services.macro_service:get_gdp_data:13 - [Bridge]获取gdp数据并标准化输出格式 from tushare
2025-07-01 14:06:59.740 | ERROR    | app.routers.router:get_gdp_data:19 - An error has been caught in function 'get_gdp_data', process 'SpawnProcess-23' (31436), thread 'MainThread' (41664):
Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "C:\else_env\Python39\lib\multiprocessing\spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 340
               │     └ 3
               └ <function _main at 0x0000024706066AF0>

  File "C:\else_env\Python39\lib\multiprocessing\spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 340
           │    └ <function BaseProcess._bootstrap at 0x0000024705CEB5E0>
           └ <SpawnProcess name='SpawnProcess-23' parent=36700 started>

  File "C:\else_env\Python39\lib\multiprocessing\process.py", line 315, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x0000024705CE6C10>
    └ <SpawnProcess name='SpawnProcess-23' parent=36700 started>

  File "C:\else_env\Python39\lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x000002470563B3D0>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-23' parent=36700 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-23' parent=36700 started>
    │    └ <function subprocess_started at 0x00000247081FF040>
    └ <SpawnProcess name='SpawnProcess-23' parent=36700 started>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\uvicorn\_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=568, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('127.0.0.1', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x00000247055B6CD0>>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\uvicorn\server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=568, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('127.0.0.1', 8001)>]
           │       │   │    └ <function Server.serve at 0x00000247081C7040>
           │       │   └ <uvicorn.server.Server object at 0x00000247055B6CD0>
           │       └ <function run at 0x000002470606B820>
           └ <module 'asyncio' from 'C:\\else_env\\Python39\\lib\\asyncio\\__init__.py'>

  File "C:\else_env\Python39\lib\asyncio\runners.py", line 44, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x00000247081BDA40>
           │    └ <function BaseEventLoop.run_until_complete at 0x0000024707A0E670>
           └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 629, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x0000024707A0E5E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 596, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x0000024707A11160>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 1890, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x00000247079ACDC0>
    └ <Handle <TaskStepMethWrapper object at 0x0000024739078610>()>

  File "C:\else_env\Python39\lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x0000024739078610>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x0000024739078610>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x0000024739078610>()>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\base.py", line 141, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x0000024739099E50>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000024739099DC0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x000002473902F8E0>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x000002473902F880>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x0000024739099E50>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000024739099DC0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000002473902F820>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x000002473902F8E0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
          │                            │    │    │     │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x0000024739099E50>
          │                            │    │    │     │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000024739099DC0>
          │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │                            │    │    └ <starlette.requests.Request object at 0x0000024739078F70>
          │                            │    └ <fastapi.routing.APIRouter object at 0x00000247092FBBB0>
          │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000002473902F820>
          └ <function wrap_app_handling_exceptions at 0x000002470923A160>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000002473905D820>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000024739099DC0>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          └ <fastapi.routing.APIRouter object at 0x00000247092FBBB0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000002473905D820>
          │    │                │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000024739099DC0>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0x00000247092FBBB0>>
          └ <fastapi.routing.APIRouter object at 0x00000247092FBBB0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 734, in app
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000002473905D820>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000024739099DC0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x0000024709259820>
          └ APIRoute(path='/macro/gdp', name='get_gdp_data', methods=['GET'])

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000002473905D820>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000024739099DC0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x0000024739012E50>
          └ APIRoute(path='/macro/gdp', name='get_gdp_data', methods=['GET'])

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
          │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000002473905D820>
          │                            │    │        │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000024739099DC0>
          │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │                            │    └ <starlette.requests.Request object at 0x0000024739078640>
          │                            └ <function request_response.<locals>.app.<locals>.app at 0x00000247390A4EE0>
          └ <function wrap_app_handling_exceptions at 0x000002470923A160>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x00000247390A4F70>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000024739099DC0>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          └ <function request_response.<locals>.app.<locals>.app at 0x00000247390A4EE0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
                     │ └ <starlette.requests.Request object at 0x0000024739078640>
                     └ <function get_request_handler.<locals>.app at 0x0000024739012EE0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x000002470925F430>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'source': 'tushare'}
                 │         └ <function get_gdp_data at 0x00000247390123A0>
                 └ Dependant(path_params=[], query_params=[ModelField(field_info=Query(akshare), name='source', mode='validation')], header_para...

> File "C:\proj\ELSE\SELF\py-fastapi-demo\app\routers\router.py", line 19, in get_gdp_data
    return macro_service.get_gdp_data(source=source)
           │             │                   └ 'tushare'
           │             └ <function get_gdp_data at 0x0000024738E50EE0>
           └ <module 'app.services.macro_service' from 'C:\\proj\\ELSE\\SELF\\py-fastapi-demo\\app\\services\\macro_service.py'>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\app\services\macro_service.py", line 15, in get_gdp_data
    df = data_provider.get_macro_gdp_data()
         │             └ <function AkShareProvider.get_macro_gdp_data at 0x0000024719E2CD30>
         └ <data_providers.akshare.AkShareProvider object at 0x0000024709303220>

TypeError: get_macro_gdp_data() missing 1 required positional argument: 'source'
2025-07-01 14:11:28.934 | INFO     | app.services.macro_service:get_gdp_data:13 - [Bridge]获取gdp数据并标准化输出格式 from tushare
2025-07-01 14:11:29.095 | ERROR    | app.routers.router:get_gdp_data:19 - An error has been caught in function 'get_gdp_data', process 'SpawnProcess-26' (37428), thread 'MainThread' (38496):
Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "C:\else_env\Python39\lib\multiprocessing\spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 344
               │     └ 3
               └ <function _main at 0x0000020931248AF0>

  File "C:\else_env\Python39\lib\multiprocessing\spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 344
           │    └ <function BaseProcess._bootstrap at 0x0000020930EDB5E0>
           └ <SpawnProcess name='SpawnProcess-26' parent=36700 started>

  File "C:\else_env\Python39\lib\multiprocessing\process.py", line 315, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x0000020930ED6C10>
    └ <SpawnProcess name='SpawnProcess-26' parent=36700 started>

  File "C:\else_env\Python39\lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x0000020930C2B3D0>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-26' parent=36700 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-26' parent=36700 started>
    │    └ <function subprocess_started at 0x00000209333DF040>
    └ <SpawnProcess name='SpawnProcess-26' parent=36700 started>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\uvicorn\_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=800, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('127.0.0.1', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x00000209307A6CD0>>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\uvicorn\server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=800, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('127.0.0.1', 8001)>]
           │       │   │    └ <function Server.serve at 0x00000209333A7040>
           │       │   └ <uvicorn.server.Server object at 0x00000209307A6CD0>
           │       └ <function run at 0x000002093123E820>
           └ <module 'asyncio' from 'C:\\else_env\\Python39\\lib\\asyncio\\__init__.py'>

  File "C:\else_env\Python39\lib\asyncio\runners.py", line 44, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x000002093339DA40>
           │    └ <function BaseEventLoop.run_until_complete at 0x0000020932BDE670>
           └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 629, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x0000020932BDE5E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 596, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x0000020932BE1160>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 1890, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x0000020932B6FDC0>
    └ <Handle <TaskStepMethWrapper object at 0x000002096424D2E0>()>

  File "C:\else_env\Python39\lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x000002096424D2E0>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x000002096424D2E0>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x000002096424D2E0>()>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\base.py", line 141, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000002096423C3A0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002096423C280>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x0000020964213640>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x00000209642135E0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000002096423C3A0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002096423C280>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x0000020964213580>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x0000020964213640>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
          │                            │    │    │     │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000002096423C3A0>
          │                            │    │    │     │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002096423C280>
          │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │                            │    │    └ <starlette.requests.Request object at 0x0000020964265700>
          │                            │    └ <fastapi.routing.APIRouter object at 0x00000209344DBBB0>
          │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x0000020964213580>
          └ <function wrap_app_handling_exceptions at 0x000002093441A160>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000002096427AE50>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002096423C280>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          └ <fastapi.routing.APIRouter object at 0x00000209344DBBB0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000002096427AE50>
          │    │                │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002096423C280>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0x00000209344DBBB0>>
          └ <fastapi.routing.APIRouter object at 0x00000209344DBBB0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 734, in app
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000002096427AE50>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002096423C280>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x0000020934439820>
          └ APIRoute(path='/macro/gdp', name='get_gdp_data', methods=['GET'])

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000002096427AE50>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002096423C280>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x000002096420C040>
          └ APIRoute(path='/macro/gdp', name='get_gdp_data', methods=['GET'])

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
          │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000002096427AE50>
          │                            │    │        │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002096423C280>
          │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │                            │    └ <starlette.requests.Request object at 0x0000020964265280>
          │                            └ <function request_response.<locals>.app.<locals>.app at 0x000002096427AEE0>
          └ <function wrap_app_handling_exceptions at 0x000002093441A160>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000002096427AF70>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002096423C280>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          └ <function request_response.<locals>.app.<locals>.app at 0x000002096427AEE0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
                     │ └ <starlette.requests.Request object at 0x0000020964265280>
                     └ <function get_request_handler.<locals>.app at 0x00000209641F1F70>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x000002093443F430>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'source': 'tushare'}
                 │         └ <function get_gdp_data at 0x00000209641F14C0>
                 └ Dependant(path_params=[], query_params=[ModelField(field_info=Query(akshare), name='source', mode='validation')], header_para...

> File "C:\proj\ELSE\SELF\py-fastapi-demo\app\routers\router.py", line 19, in get_gdp_data
    return macro_service.get_gdp_data(source=source)
           │             │                   └ 'tushare'
           │             └ <function get_gdp_data at 0x0000020964035DC0>
           └ <module 'app.services.macro_service' from 'C:\\proj\\ELSE\\SELF\\py-fastapi-demo\\app\\services\\macro_service.py'>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\app\services\macro_service.py", line 16, in get_gdp_data
    df = data_provider.get_macro_gdp_data(source=source)
         │             │                         └ 'tushare'
         │             └ <function TushareProvider.get_macro_gdp_data at 0x000002094500CB80>
         └ <data_providers.tushare.TushareProvider object at 0x000002096425EFA0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\data_providers\tushare.py", line 32, in get_macro_gdp_data
    df = self.pro.cn_gdp(year="", field="")
         │    └ <tushare.pro.client.DataApi object at 0x000002096425EBE0>
         └ <data_providers.tushare.TushareProvider object at 0x000002096425EFA0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\tushare\pro\client.py", line 45, in query
    raise Exception(result['msg'])
                    └ {'request_id': '45320794-b70e-4ae6-85cc-26145f5b8b82', 'code': 40203, 'data': None, 'msg': '抱歉，您没有接口访问权限，权限的具体详情访问：https://tu...

Exception: 抱歉，您没有接口访问权限，权限的具体详情访问：https://tushare.pro/document/1?doc_id=108。
2025-07-01 14:15:52.588 | INFO     | app.services.macro_service:get_gdp_data:13 - [Bridge]获取gdp数据并标准化输出格式 from tushare
2025-07-01 14:16:07.729 | INFO     | app.services.macro_service:get_gdp_data:13 - [Bridge]获取gdp数据并标准化输出格式 from tushare
2025-07-01 14:16:07.909 | ERROR    | app.routers.router:get_gdp_data:20 - An error has been caught in function 'get_gdp_data', process 'SpawnProcess-27' (26896), thread 'MainThread' (33168):
Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "C:\else_env\Python39\lib\multiprocessing\spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 344
               │     └ 3
               └ <function _main at 0x0000023A3FA58AF0>

  File "C:\else_env\Python39\lib\multiprocessing\spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 344
           │    └ <function BaseProcess._bootstrap at 0x0000023A3F6DB5E0>
           └ <SpawnProcess name='SpawnProcess-27' parent=36700 started>

  File "C:\else_env\Python39\lib\multiprocessing\process.py", line 315, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x0000023A3F6D6C10>
    └ <SpawnProcess name='SpawnProcess-27' parent=36700 started>

  File "C:\else_env\Python39\lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x0000023A3F02B3D0>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-27' parent=36700 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-27' parent=36700 started>
    │    └ <function subprocess_started at 0x0000023A41BEF040>
    └ <SpawnProcess name='SpawnProcess-27' parent=36700 started>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\uvicorn\_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=432, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('127.0.0.1', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x0000023A3EFA6CD0>>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\uvicorn\server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=432, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('127.0.0.1', 8001)>]
           │       │   │    └ <function Server.serve at 0x0000023A41BB7040>
           │       │   └ <uvicorn.server.Server object at 0x0000023A3EFA6CD0>
           │       └ <function run at 0x0000023A3FA4D820>
           └ <module 'asyncio' from 'C:\\else_env\\Python39\\lib\\asyncio\\__init__.py'>

  File "C:\else_env\Python39\lib\asyncio\runners.py", line 44, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x0000023A41BADA40>
           │    └ <function BaseEventLoop.run_until_complete at 0x0000023A413EE670>
           └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 629, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x0000023A413EE5E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 596, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x0000023A413F1160>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 1890, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x0000023A41380DC0>
    └ <Handle <TaskStepMethWrapper object at 0x0000023A72A5A790>()>

  File "C:\else_env\Python39\lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x0000023A72A5A790>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x0000023A72A5A790>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x0000023A72A5A790>()>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\base.py", line 141, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x0000023A72A464C0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000023A72A463A0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x0000023A72A1FAF0>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x0000023A72A1FA90>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x0000023A72A464C0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000023A72A463A0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x0000023A72A1FA30>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x0000023A72A1FAF0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
          │                            │    │    │     │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x0000023A72A464C0>
          │                            │    │    │     │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000023A72A463A0>
          │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │                            │    │    └ <starlette.requests.Request object at 0x0000023A72A79550>
          │                            │    └ <fastapi.routing.APIRouter object at 0x0000023A42CEBBB0>
          │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x0000023A72A1FA30>
          └ <function wrap_app_handling_exceptions at 0x0000023A42C2A160>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000023A72A8BF70>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000023A72A463A0>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          └ <fastapi.routing.APIRouter object at 0x0000023A42CEBBB0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000023A72A8BF70>
          │    │                │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000023A72A463A0>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0x0000023A42CEBBB0>>
          └ <fastapi.routing.APIRouter object at 0x0000023A42CEBBB0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 734, in app
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000023A72A8BF70>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000023A72A463A0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x0000023A42C49820>
          └ APIRoute(path='/macro/gdp', name='get_gdp_data', methods=['GET'])

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000023A72A8BF70>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000023A72A463A0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x0000023A72A1C0D0>
          └ APIRoute(path='/macro/gdp', name='get_gdp_data', methods=['GET'])

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
          │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000023A72A8BF70>
          │                            │    │        │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000023A72A463A0>
          │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │                            │    └ <starlette.requests.Request object at 0x0000023A72A793A0>
          │                            └ <function request_response.<locals>.app.<locals>.app at 0x0000023A72A90040>
          └ <function wrap_app_handling_exceptions at 0x0000023A42C2A160>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000023A72A900D0>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000023A72A463A0>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          └ <function request_response.<locals>.app.<locals>.app at 0x0000023A72A90040>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
                     │ └ <starlette.requests.Request object at 0x0000023A72A793A0>
                     └ <function get_request_handler.<locals>.app at 0x0000023A72A1C160>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x0000023A42C4F430>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'source': 'tushare'}
                 │         └ <function get_gdp_data at 0x0000023A72A025E0>
                 └ Dependant(path_params=[], query_params=[ModelField(field_info=Query(akshare), name='source', mode='validation')], header_para...

> File "C:\proj\ELSE\SELF\py-fastapi-demo\app\routers\router.py", line 20, in get_gdp_data
    data = macro_service.get_gdp_data(source=source)
           │             │                   └ 'tushare'
           │             └ <function get_gdp_data at 0x0000023A72841040>
           └ <module 'app.services.macro_service' from 'C:\\proj\\ELSE\\SELF\\py-fastapi-demo\\app\\services\\macro_service.py'>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\app\services\macro_service.py", line 16, in get_gdp_data
    df = data_provider.get_macro_gdp_data(source=source)
         │             │                         └ 'tushare'
         │             └ <function TushareProvider.get_macro_gdp_data at 0x0000023A5381DB80>
         └ <data_providers.tushare.TushareProvider object at 0x0000023A72A69970>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\data_providers\tushare.py", line 32, in get_macro_gdp_data
    df = self.pro.cn_gdp(year="", field="")
         │    └ <tushare.pro.client.DataApi object at 0x0000023A72A69A90>
         └ <data_providers.tushare.TushareProvider object at 0x0000023A72A69970>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\tushare\pro\client.py", line 45, in query
    raise Exception(result['msg'])
                    └ {'request_id': 'f936309a-4cb9-4391-b74f-8956f9e273b7', 'code': 40203, 'data': None, 'msg': '抱歉，您没有接口访问权限，权限的具体详情访问：https://tu...

Exception: 抱歉，您没有接口访问权限，权限的具体详情访问：https://tushare.pro/document/1?doc_id=108。
2025-07-01 14:16:18.090 | INFO     | app.services.data_service:get_stock_history:21 - [Bridge]获取股票历史行情数据并标准化输出格式 for 000001.SH from qstock
2025-07-01 14:21:07.320 | INFO     | app.services.macro_service:get_gdp_data:13 - [Bridge]获取gdp数据并标准化输出格式 from tushare
2025-07-01 14:21:07.524 | ERROR    | app.routers.router:get_gdp_data:20 - An error has been caught in function 'get_gdp_data', process 'SpawnProcess-30' (49980), thread 'MainThread' (11388):
Traceback (most recent call last):

  File "C:\proj\ELSE\SELF\py-fastapi-demo\data_providers\tushare.py", line 39, in get_macro_gdp_data
    df = self.pro.cn_gdp(year="", field="")
         │    └ <tushare.pro.client.DataApi object at 0x0000021C8A8D9850>
         └ <data_providers.tushare.TushareProvider object at 0x0000021C8A8D9880>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\tushare\pro\client.py", line 45, in query
    raise Exception(result['msg'])
                    └ {'request_id': '4af76589-c452-4330-92a6-b6ce3ed07b5e', 'code': 40203, 'data': None, 'msg': '抱歉，您没有接口访问权限，权限的具体详情访问：https://tu...

Exception: 抱歉，您没有接口访问权限，权限的具体详情访问：https://tushare.pro/document/1?doc_id=108。


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "C:\else_env\Python39\lib\multiprocessing\spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 324
               │     └ 3
               └ <function _main at 0x0000021CD77D6AF0>

  File "C:\else_env\Python39\lib\multiprocessing\spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 324
           │    └ <function BaseProcess._bootstrap at 0x0000021CD746B5E0>
           └ <SpawnProcess name='SpawnProcess-30' parent=36700 started>

  File "C:\else_env\Python39\lib\multiprocessing\process.py", line 315, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x0000021CD7466C10>
    └ <SpawnProcess name='SpawnProcess-30' parent=36700 started>

  File "C:\else_env\Python39\lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x0000021CD71BB3D0>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-30' parent=36700 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-30' parent=36700 started>
    │    └ <function subprocess_started at 0x0000021CD996F040>
    └ <SpawnProcess name='SpawnProcess-30' parent=36700 started>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\uvicorn\_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=624, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('127.0.0.1', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x0000021CD7086CD0>>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\uvicorn\server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=624, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('127.0.0.1', 8001)>]
           │       │   │    └ <function Server.serve at 0x0000021CD9937040>
           │       │   └ <uvicorn.server.Server object at 0x0000021CD7086CD0>
           │       └ <function run at 0x0000021CD77DB820>
           └ <module 'asyncio' from 'C:\\else_env\\Python39\\lib\\asyncio\\__init__.py'>

  File "C:\else_env\Python39\lib\asyncio\runners.py", line 44, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x0000021CD992DA40>
           │    └ <function BaseEventLoop.run_until_complete at 0x0000021CD916E670>
           └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 629, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x0000021CD916E5E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 596, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x0000021CD9171160>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 1890, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x0000021CD9100DC0>
    └ <Handle <TaskStepMethWrapper object at 0x0000021C8A8CB6A0>()>

  File "C:\else_env\Python39\lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x0000021C8A8CB6A0>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x0000021C8A8CB6A0>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x0000021C8A8CB6A0>()>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\base.py", line 141, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x0000021C8A8B0670>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000021C8A8B0550>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x0000021C8A88CA00>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x0000021C8A88C9A0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x0000021C8A8B0670>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000021C8A8B0550>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x0000021C8A88C940>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x0000021C8A88CA00>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
          │                            │    │    │     │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x0000021C8A8B0670>
          │                            │    │    │     │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000021C8A8B0550>
          │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │                            │    │    └ <starlette.requests.Request object at 0x0000021C8A8E8550>
          │                            │    └ <fastapi.routing.APIRouter object at 0x0000021CDAA6BBB0>
          │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x0000021C8A88C940>
          └ <function wrap_app_handling_exceptions at 0x0000021CDA9AA160>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000021C8A900160>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000021C8A8B0550>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          └ <fastapi.routing.APIRouter object at 0x0000021CDAA6BBB0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000021C8A900160>
          │    │                │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000021C8A8B0550>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0x0000021CDAA6BBB0>>
          └ <fastapi.routing.APIRouter object at 0x0000021CDAA6BBB0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 734, in app
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000021C8A900160>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000021C8A8B0550>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x0000021CDA9C9820>
          └ APIRoute(path='/macro/gdp', name='get_gdp_data', methods=['GET'])

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000021C8A900160>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000021C8A8B0550>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x0000021C8A886280>
          └ APIRoute(path='/macro/gdp', name='get_gdp_data', methods=['GET'])

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
          │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000021C8A900160>
          │                            │    │        │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000021C8A8B0550>
          │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │                            │    └ <starlette.requests.Request object at 0x0000021C8A8E83A0>
          │                            └ <function request_response.<locals>.app.<locals>.app at 0x0000021C8A9001F0>
          └ <function wrap_app_handling_exceptions at 0x0000021CDA9AA160>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000021C8A900280>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000021C8A8B0550>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          └ <function request_response.<locals>.app.<locals>.app at 0x0000021C8A9001F0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
                     │ └ <starlette.requests.Request object at 0x0000021C8A8E83A0>
                     └ <function get_request_handler.<locals>.app at 0x0000021C8A886310>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x0000021CDA9CF430>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'source': 'tushare'}
                 │         └ <function get_gdp_data at 0x0000021C8A872790>
                 └ Dependant(path_params=[], query_params=[ModelField(field_info=Query(akshare), name='source', mode='validation')], header_para...

> File "C:\proj\ELSE\SELF\py-fastapi-demo\app\routers\router.py", line 20, in get_gdp_data
    data = macro_service.get_gdp_data(source=source)
           │             │                   └ 'tushare'
           │             └ <function get_gdp_data at 0x0000021C8A6AD1F0>
           └ <module 'app.services.macro_service' from 'C:\\proj\\ELSE\\SELF\\py-fastapi-demo\\app\\services\\macro_service.py'>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\app\services\macro_service.py", line 16, in get_gdp_data
    df = data_provider.get_macro_gdp_data(source=source)
         │             │                         └ 'tushare'
         │             └ <function TushareProvider.get_macro_gdp_data at 0x0000021CEB59CC10>
         └ <data_providers.tushare.TushareProvider object at 0x0000021C8A8D9880>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\data_providers\tushare.py", line 44, in get_macro_gdp_data
    raise RuntimeError(f"从 tushare 获取 GDP 数据失败: {str(e)}") from e

RuntimeError: 从 tushare 获取 GDP 数据失败: 抱歉，您没有接口访问权限，权限的具体详情访问：https://tushare.pro/document/1?doc_id=108。
2025-07-01 14:23:28.854 | INFO     | app.services.macro_service:get_gdp_data:13 - [Bridge]获取gdp数据并标准化输出格式 from tushare
2025-07-01 14:23:29.066 | ERROR    | app.services.macro_service:get_gdp_data:30 - 获取宏观GDP数据失败: 从 tushare 获取 GDP 数据失败: 抱歉，您没有接口访问权限，权限的具体详情访问：https://tushare.pro/document/1?doc_id=108。
2025-07-01 14:23:29.066 | ERROR    | app.routers.router:get_gdp_data:20 - An error has been caught in function 'get_gdp_data', process 'SpawnProcess-31' (48004), thread 'MainThread' (49052):
Traceback (most recent call last):

  File "C:\proj\ELSE\SELF\py-fastapi-demo\data_providers\tushare.py", line 39, in get_macro_gdp_data
    df = self.pro.cn_gdp(year="", field="")
         │    └ <tushare.pro.client.DataApi object at 0x00000224AEDABA00>
         └ <data_providers.tushare.TushareProvider object at 0x00000224AEDAB5E0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\tushare\pro\client.py", line 45, in query
    raise Exception(result['msg'])
                    └ {'request_id': 'f41c5395-e856-48cb-8006-8fa6a55473c0', 'code': 40203, 'data': None, 'msg': '抱歉，您没有接口访问权限，权限的具体详情访问：https://tu...

Exception: 抱歉，您没有接口访问权限，权限的具体详情访问：https://tushare.pro/document/1?doc_id=108。


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "C:\else_env\Python39\lib\multiprocessing\spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 336
               │     └ 3
               └ <function _main at 0x00000224FBC47AF0>

  File "C:\else_env\Python39\lib\multiprocessing\spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 336
           │    └ <function BaseProcess._bootstrap at 0x00000224FB8EB5E0>
           └ <SpawnProcess name='SpawnProcess-31' parent=36700 started>

  File "C:\else_env\Python39\lib\multiprocessing\process.py", line 315, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x00000224FB8E6C10>
    └ <SpawnProcess name='SpawnProcess-31' parent=36700 started>

  File "C:\else_env\Python39\lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x00000224FB63B3D0>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-31' parent=36700 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-31' parent=36700 started>
    │    └ <function subprocess_started at 0x00000224FDDDF040>
    └ <SpawnProcess name='SpawnProcess-31' parent=36700 started>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\uvicorn\_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=352, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('127.0.0.1', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x00000224FB196CD0>>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\uvicorn\server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=352, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('127.0.0.1', 8001)>]
           │       │   │    └ <function Server.serve at 0x00000224FDDA7040>
           │       │   └ <uvicorn.server.Server object at 0x00000224FB196CD0>
           │       └ <function run at 0x00000224FBC3E820>
           └ <module 'asyncio' from 'C:\\else_env\\Python39\\lib\\asyncio\\__init__.py'>

  File "C:\else_env\Python39\lib\asyncio\runners.py", line 44, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x00000224FDD9DA40>
           │    └ <function BaseEventLoop.run_until_complete at 0x00000224FD60E670>
           └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 629, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x00000224FD60E5E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 596, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x00000224FD611160>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 1890, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x00000224FD5B0DC0>
    └ <Handle <TaskStepMethWrapper object at 0x00000224AED9D5B0>()>

  File "C:\else_env\Python39\lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x00000224AED9D5B0>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x00000224AED9D5B0>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x00000224AED9D5B0>()>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\base.py", line 141, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x00000224AED80670>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000224AED80550>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x00000224AED60910>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x00000224AED608B0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x00000224AED80670>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000224AED80550>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x00000224AED60850>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x00000224AED60910>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
          │                            │    │    │     │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x00000224AED80670>
          │                            │    │    │     │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000224AED80550>
          │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │                            │    │    └ <starlette.requests.Request object at 0x00000224AEDB94C0>
          │                            │    └ <fastapi.routing.APIRouter object at 0x00000224FEEDBBB0>
          │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x00000224AED60850>
          └ <function wrap_app_handling_exceptions at 0x00000224FEE1D160>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x00000224AEDCF160>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000224AED80550>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          └ <fastapi.routing.APIRouter object at 0x00000224FEEDBBB0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x00000224AEDCF160>
          │    │                │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000224AED80550>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0x00000224FEEDBBB0>>
          └ <fastapi.routing.APIRouter object at 0x00000224FEEDBBB0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 734, in app
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x00000224AEDCF160>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000224AED80550>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x00000224FEE39820>
          └ APIRoute(path='/macro/gdp', name='get_gdp_data', methods=['GET'])

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x00000224AEDCF160>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000224AED80550>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x00000224AED55280>
          └ APIRoute(path='/macro/gdp', name='get_gdp_data', methods=['GET'])

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
          │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x00000224AEDCF160>
          │                            │    │        │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000224AED80550>
          │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │                            │    └ <starlette.requests.Request object at 0x00000224AEDB9310>
          │                            └ <function request_response.<locals>.app.<locals>.app at 0x00000224AEDCF1F0>
          └ <function wrap_app_handling_exceptions at 0x00000224FEE1D160>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x00000224AEDCF280>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000224AED80550>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          └ <function request_response.<locals>.app.<locals>.app at 0x00000224AEDCF1F0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
                     │ └ <starlette.requests.Request object at 0x00000224AEDB9310>
                     └ <function get_request_handler.<locals>.app at 0x00000224AED55310>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x00000224FEE3F430>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'source': 'tushare'}
                 │         └ <function get_gdp_data at 0x00000224AED42790>
                 └ Dependant(path_params=[], query_params=[ModelField(field_info=Query(akshare), name='source', mode='validation')], header_para...

> File "C:\proj\ELSE\SELF\py-fastapi-demo\app\routers\router.py", line 20, in get_gdp_data
    data = macro_service.get_gdp_data(source=source)
           │             │                   └ 'tushare'
           │             └ <function get_gdp_data at 0x00000224AEB860D0>
           └ <module 'app.services.macro_service' from 'C:\\proj\\ELSE\\SELF\\py-fastapi-demo\\app\\services\\macro_service.py'>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\app\services\macro_service.py", line 17, in get_gdp_data
    df = data_provider.get_macro_gdp_data(source=source)
         │             │                         └ 'tushare'
         │             └ <function TushareProvider.get_macro_gdp_data at 0x000002248FB5CC10>
         └ <data_providers.tushare.TushareProvider object at 0x00000224AEDAB5E0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\data_providers\tushare.py", line 44, in get_macro_gdp_data
    raise RuntimeError(f"从 tushare 获取 GDP 数据失败: {str(e)}") from e

RuntimeError: 从 tushare 获取 GDP 数据失败: 抱歉，您没有接口访问权限，权限的具体详情访问：https://tushare.pro/document/1?doc_id=108。
2025-07-01 14:23:31.388 | INFO     | app.services.macro_service:get_gdp_data:13 - [Bridge]获取gdp数据并标准化输出格式 from tushare
2025-07-01 14:23:31.651 | ERROR    | app.services.macro_service:get_gdp_data:30 - 获取宏观GDP数据失败: 从 tushare 获取 GDP 数据失败: 抱歉，您没有接口访问权限，权限的具体详情访问：https://tushare.pro/document/1?doc_id=108。
2025-07-01 14:23:31.651 | ERROR    | app.routers.router:get_gdp_data:20 - An error has been caught in function 'get_gdp_data', process 'SpawnProcess-31' (48004), thread 'MainThread' (49052):
Traceback (most recent call last):

  File "C:\proj\ELSE\SELF\py-fastapi-demo\data_providers\tushare.py", line 39, in get_macro_gdp_data
    df = self.pro.cn_gdp(year="", field="")
         │    └ <tushare.pro.client.DataApi object at 0x00000224AEDDC5B0>
         └ <data_providers.tushare.TushareProvider object at 0x00000224AEDDC520>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\tushare\pro\client.py", line 45, in query
    raise Exception(result['msg'])
                    └ {'request_id': '747f50ae-96b3-4f56-bae2-2a76f24963f3', 'code': 40203, 'data': None, 'msg': '抱歉，您没有接口访问权限，权限的具体详情访问：https://tu...

Exception: 抱歉，您没有接口访问权限，权限的具体详情访问：https://tushare.pro/document/1?doc_id=108。


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "C:\else_env\Python39\lib\multiprocessing\spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 336
               │     └ 3
               └ <function _main at 0x00000224FBC47AF0>

  File "C:\else_env\Python39\lib\multiprocessing\spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 336
           │    └ <function BaseProcess._bootstrap at 0x00000224FB8EB5E0>
           └ <SpawnProcess name='SpawnProcess-31' parent=36700 started>

  File "C:\else_env\Python39\lib\multiprocessing\process.py", line 315, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x00000224FB8E6C10>
    └ <SpawnProcess name='SpawnProcess-31' parent=36700 started>

  File "C:\else_env\Python39\lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x00000224FB63B3D0>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-31' parent=36700 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-31' parent=36700 started>
    │    └ <function subprocess_started at 0x00000224FDDDF040>
    └ <SpawnProcess name='SpawnProcess-31' parent=36700 started>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\uvicorn\_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=352, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('127.0.0.1', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x00000224FB196CD0>>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\uvicorn\server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=352, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('127.0.0.1', 8001)>]
           │       │   │    └ <function Server.serve at 0x00000224FDDA7040>
           │       │   └ <uvicorn.server.Server object at 0x00000224FB196CD0>
           │       └ <function run at 0x00000224FBC3E820>
           └ <module 'asyncio' from 'C:\\else_env\\Python39\\lib\\asyncio\\__init__.py'>

  File "C:\else_env\Python39\lib\asyncio\runners.py", line 44, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x00000224FDD9DA40>
           │    └ <function BaseEventLoop.run_until_complete at 0x00000224FD60E670>
           └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 629, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x00000224FD60E5E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 596, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x00000224FD611160>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 1890, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x00000224FD5B0DC0>
    └ <Handle <TaskStepMethWrapper object at 0x00000224AEDB9250>()>

  File "C:\else_env\Python39\lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x00000224AEDB9250>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x00000224AEDB9250>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x00000224AEDB9250>()>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\base.py", line 141, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x00000224AED80670>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000224AED80EE0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x00000224AED60910>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x00000224AED608B0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x00000224AED80670>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000224AED80EE0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x00000224AED60850>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x00000224AED60910>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
          │                            │    │    │     │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x00000224AED80670>
          │                            │    │    │     │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000224AED80EE0>
          │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │                            │    │    └ <starlette.requests.Request object at 0x00000224AEDB92E0>
          │                            │    └ <fastapi.routing.APIRouter object at 0x00000224FEEDBBB0>
          │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x00000224AED60850>
          └ <function wrap_app_handling_exceptions at 0x00000224FEE1D160>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x00000224AEDCF1F0>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000224AED80EE0>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          └ <fastapi.routing.APIRouter object at 0x00000224FEEDBBB0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x00000224AEDCF1F0>
          │    │                │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000224AED80EE0>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0x00000224FEEDBBB0>>
          └ <fastapi.routing.APIRouter object at 0x00000224FEEDBBB0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 734, in app
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x00000224AEDCF1F0>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000224AED80EE0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x00000224FEE39820>
          └ APIRoute(path='/macro/gdp', name='get_gdp_data', methods=['GET'])

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x00000224AEDCF1F0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000224AED80EE0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x00000224AED55280>
          └ APIRoute(path='/macro/gdp', name='get_gdp_data', methods=['GET'])

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
          │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x00000224AEDCF1F0>
          │                            │    │        │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000224AED80EE0>
          │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │                            │    └ <starlette.requests.Request object at 0x00000224AEDDCBB0>
          │                            └ <function request_response.<locals>.app.<locals>.app at 0x00000224AEDCF280>
          └ <function wrap_app_handling_exceptions at 0x00000224FEE1D160>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x00000224AEDCFC10>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000224AED80EE0>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          └ <function request_response.<locals>.app.<locals>.app at 0x00000224AEDCF280>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
                     │ └ <starlette.requests.Request object at 0x00000224AEDDCBB0>
                     └ <function get_request_handler.<locals>.app at 0x00000224AED55310>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x00000224FEE3F430>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'source': 'tushare'}
                 │         └ <function get_gdp_data at 0x00000224AED42790>
                 └ Dependant(path_params=[], query_params=[ModelField(field_info=Query(akshare), name='source', mode='validation')], header_para...

> File "C:\proj\ELSE\SELF\py-fastapi-demo\app\routers\router.py", line 20, in get_gdp_data
    data = macro_service.get_gdp_data(source=source)
           │             │                   └ 'tushare'
           │             └ <function get_gdp_data at 0x00000224AEB860D0>
           └ <module 'app.services.macro_service' from 'C:\\proj\\ELSE\\SELF\\py-fastapi-demo\\app\\services\\macro_service.py'>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\app\services\macro_service.py", line 17, in get_gdp_data
    df = data_provider.get_macro_gdp_data(source=source)
         │             │                         └ 'tushare'
         │             └ <function TushareProvider.get_macro_gdp_data at 0x000002248FB5CC10>
         └ <data_providers.tushare.TushareProvider object at 0x00000224AEDDC520>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\data_providers\tushare.py", line 44, in get_macro_gdp_data
    raise RuntimeError(f"从 tushare 获取 GDP 数据失败: {str(e)}") from e

RuntimeError: 从 tushare 获取 GDP 数据失败: 抱歉，您没有接口访问权限，权限的具体详情访问：https://tushare.pro/document/1?doc_id=108。
2025-07-01 14:25:49.757 | INFO     | app.services.macro_service:get_gdp_data:13 - [Bridge]获取gdp数据并标准化输出格式 from tushare
2025-07-01 14:25:49.947 | ERROR    | app.services.macro_service:get_gdp_data:30 - 获取宏观GDP数据失败: 从 tushare 获取 GDP 数据失败: 抱歉，您没有接口访问权限，权限的具体详情访问：https://tushare.pro/document/1?doc_id=108。
2025-07-01 14:25:49.947 | ERROR    | app.routers.router:get_gdp_data:24 - An error has been caught in function 'get_gdp_data', process 'SpawnProcess-32' (40504), thread 'MainThread' (51700):
Traceback (most recent call last):

  File "C:\proj\ELSE\SELF\py-fastapi-demo\data_providers\tushare.py", line 39, in get_macro_gdp_data
    df = self.pro.cn_gdp(year="", field="")
         │    └ <tushare.pro.client.DataApi object at 0x000002094FA08880>
         └ <data_providers.tushare.TushareProvider object at 0x000002094FA08700>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\tushare\pro\client.py", line 45, in query
    raise Exception(result['msg'])
                    └ {'request_id': 'bbf98a39-12b1-4bb4-b315-441da3f06d7b', 'code': 40203, 'data': None, 'msg': '抱歉，您没有接口访问权限，权限的具体详情访问：https://tu...

Exception: 抱歉，您没有接口访问权限，权限的具体详情访问：https://tushare.pro/document/1?doc_id=108。


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "C:\else_env\Python39\lib\multiprocessing\spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 360
               │     └ 3
               └ <function _main at 0x000002091C9F7AF0>

  File "C:\else_env\Python39\lib\multiprocessing\spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 360
           │    └ <function BaseProcess._bootstrap at 0x000002091C6945E0>
           └ <SpawnProcess name='SpawnProcess-32' parent=36700 started>

  File "C:\else_env\Python39\lib\multiprocessing\process.py", line 315, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x000002091C696C10>
    └ <SpawnProcess name='SpawnProcess-32' parent=36700 started>

  File "C:\else_env\Python39\lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x000002091BFCB3D0>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-32' parent=36700 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-32' parent=36700 started>
    │    └ <function subprocess_started at 0x000002091EB90040>
    └ <SpawnProcess name='SpawnProcess-32' parent=36700 started>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\uvicorn\_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=376, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('127.0.0.1', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x000002091BF46CD0>>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\uvicorn\server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=376, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('127.0.0.1', 8001)>]
           │       │   │    └ <function Server.serve at 0x000002091EB57040>
           │       │   └ <uvicorn.server.Server object at 0x000002091BF46CD0>
           │       └ <function run at 0x000002091C9ED820>
           └ <module 'asyncio' from 'C:\\else_env\\Python39\\lib\\asyncio\\__init__.py'>

  File "C:\else_env\Python39\lib\asyncio\runners.py", line 44, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x000002091EB4DA40>
           │    └ <function BaseEventLoop.run_until_complete at 0x000002091E38E670>
           └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 629, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x000002091E38E5E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 596, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x000002091E3A1160>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 1890, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x000002091E320DC0>
    └ <Handle <TaskStepMethWrapper object at 0x000002094F9FA6D0>()>

  File "C:\else_env\Python39\lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x000002094F9FA6D0>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x000002094F9FA6D0>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x000002094F9FA6D0>()>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\base.py", line 141, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000002094F9E0700>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002094F9E05E0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x000002094F9C0A30>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x000002094F9C09D0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000002094F9E0700>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002094F9E05E0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000002094F9C0970>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x000002094F9C0A30>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
          │                            │    │    │     │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000002094F9E0700>
          │                            │    │    │     │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002094F9E05E0>
          │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │                            │    │    └ <starlette.requests.Request object at 0x000002094FA19580>
          │                            │    └ <fastapi.routing.APIRouter object at 0x000002091FC8BBB0>
          │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000002094F9C0970>
          └ <function wrap_app_handling_exceptions at 0x000002091FBCA160>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000002094FA2F1F0>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002094F9E05E0>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          └ <fastapi.routing.APIRouter object at 0x000002091FC8BBB0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000002094FA2F1F0>
          │    │                │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002094F9E05E0>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0x000002091FC8BBB0>>
          └ <fastapi.routing.APIRouter object at 0x000002091FC8BBB0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 734, in app
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000002094FA2F1F0>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002094F9E05E0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x000002091FBE9820>
          └ APIRoute(path='/macro/gdp', name='get_gdp_data', methods=['GET'])

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000002094FA2F1F0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002094F9E05E0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x000002094F9B6310>
          └ APIRoute(path='/macro/gdp', name='get_gdp_data', methods=['GET'])

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
          │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000002094FA2F1F0>
          │                            │    │        │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002094F9E05E0>
          │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │                            │    └ <starlette.requests.Request object at 0x000002094FA193D0>
          │                            └ <function request_response.<locals>.app.<locals>.app at 0x000002094FA2F280>
          └ <function wrap_app_handling_exceptions at 0x000002091FBCA160>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000002094FA2F310>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002094F9E05E0>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          └ <function request_response.<locals>.app.<locals>.app at 0x000002094FA2F280>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
                     │ └ <starlette.requests.Request object at 0x000002094FA193D0>
                     └ <function get_request_handler.<locals>.app at 0x000002094F9B63A0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x000002091FBEF430>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'source': 'tushare'}
                 │         └ <function get_gdp_data at 0x000002094F9A3820>
                 └ Dependant(path_params=[], query_params=[ModelField(field_info=Query(akshare), name='source', mode='validation')], header_para...

> File "C:\proj\ELSE\SELF\py-fastapi-demo\app\routers\router.py", line 24, in get_gdp_data
    data = macro_service.get_gdp_data(source=source)
           │             │                   └ 'tushare'
           │             └ <function get_gdp_data at 0x000002094F7E2280>
           └ <module 'app.services.macro_service' from 'C:\\proj\\ELSE\\SELF\\py-fastapi-demo\\app\\services\\macro_service.py'>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\app\services\macro_service.py", line 17, in get_gdp_data
    df = data_provider.get_macro_gdp_data(source=source)
         │             │                         └ 'tushare'
         │             └ <function TushareProvider.get_macro_gdp_data at 0x00000209307BDCA0>
         └ <data_providers.tushare.TushareProvider object at 0x000002094FA08700>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\data_providers\tushare.py", line 44, in get_macro_gdp_data
    raise RuntimeError(f"从 tushare 获取 GDP 数据失败: {str(e)}") from e

RuntimeError: 从 tushare 获取 GDP 数据失败: 抱歉，您没有接口访问权限，权限的具体详情访问：https://tushare.pro/document/1?doc_id=108。
2025-07-01 14:34:57.450 | INFO     | app.services.macro_service:get_gdp_data:13 - [Bridge]获取gdp数据并标准化输出格式 from tushare
2025-07-01 14:34:57.727 | ERROR    | app.services.macro_service:get_gdp_data:30 - 获取宏观GDP数据失败: 从 tushare 获取 GDP 数据失败: 抱歉，您没有接口访问权限，权限的具体详情访问：https://tushare.pro/document/1?doc_id=108。
2025-07-01 14:34:57.729 | ERROR    | app.routers.router:get_gdp_data:24 - An error has been caught in function 'get_gdp_data', process 'SpawnProcess-32' (40504), thread 'MainThread' (51700):
Traceback (most recent call last):

  File "C:\proj\ELSE\SELF\py-fastapi-demo\data_providers\tushare.py", line 39, in get_macro_gdp_data
    df = self.pro.cn_gdp(year="", field="")
         │    └ <tushare.pro.client.DataApi object at 0x000002094FA3BA30>
         └ <data_providers.tushare.TushareProvider object at 0x000002094FA3BFA0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\tushare\pro\client.py", line 45, in query
    raise Exception(result['msg'])
                    └ {'request_id': '94049227-a614-4837-9dce-2cf042cdeac3', 'code': 40203, 'data': None, 'msg': '抱歉，您没有接口访问权限，权限的具体详情访问：https://tu...

Exception: 抱歉，您没有接口访问权限，权限的具体详情访问：https://tushare.pro/document/1?doc_id=108。


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "C:\else_env\Python39\lib\multiprocessing\spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 360
               │     └ 3
               └ <function _main at 0x000002091C9F7AF0>

  File "C:\else_env\Python39\lib\multiprocessing\spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 360
           │    └ <function BaseProcess._bootstrap at 0x000002091C6945E0>
           └ <SpawnProcess name='SpawnProcess-32' parent=36700 started>

  File "C:\else_env\Python39\lib\multiprocessing\process.py", line 315, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x000002091C696C10>
    └ <SpawnProcess name='SpawnProcess-32' parent=36700 started>

  File "C:\else_env\Python39\lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x000002091BFCB3D0>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-32' parent=36700 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-32' parent=36700 started>
    │    └ <function subprocess_started at 0x000002091EB90040>
    └ <SpawnProcess name='SpawnProcess-32' parent=36700 started>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\uvicorn\_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=376, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('127.0.0.1', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x000002091BF46CD0>>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\uvicorn\server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=376, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('127.0.0.1', 8001)>]
           │       │   │    └ <function Server.serve at 0x000002091EB57040>
           │       │   └ <uvicorn.server.Server object at 0x000002091BF46CD0>
           │       └ <function run at 0x000002091C9ED820>
           └ <module 'asyncio' from 'C:\\else_env\\Python39\\lib\\asyncio\\__init__.py'>

  File "C:\else_env\Python39\lib\asyncio\runners.py", line 44, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x000002091EB4DA40>
           │    └ <function BaseEventLoop.run_until_complete at 0x000002091E38E670>
           └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 629, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x000002091E38E5E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 596, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x000002091E3A1160>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 1890, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x000002091E320DC0>
    └ <Handle <TaskStepMethWrapper object at 0x000002094FA3B6D0>()>

  File "C:\else_env\Python39\lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x000002094FA3B6D0>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x000002094FA3B6D0>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x000002094FA3B6D0>()>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\base.py", line 141, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000002094F9E0700>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002094F9E0F70>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x000002094F9C0A30>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x000002094F9C09D0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000002094F9E0700>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002094F9E0F70>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000002094F9C0970>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x000002094F9C0A30>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
          │                            │    │    │     │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000002094F9E0700>
          │                            │    │    │     │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002094F9E0F70>
          │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │                            │    │    └ <starlette.requests.Request object at 0x000002094FA3B9A0>
          │                            │    └ <fastapi.routing.APIRouter object at 0x000002091FC8BBB0>
          │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000002094F9C0970>
          └ <function wrap_app_handling_exceptions at 0x000002091FBCA160>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000002094FA2F280>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002094F9E0F70>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          └ <fastapi.routing.APIRouter object at 0x000002091FC8BBB0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000002094FA2F280>
          │    │                │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002094F9E0F70>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0x000002091FC8BBB0>>
          └ <fastapi.routing.APIRouter object at 0x000002091FC8BBB0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 734, in app
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000002094FA2F280>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002094F9E0F70>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x000002091FBE9820>
          └ APIRoute(path='/macro/gdp', name='get_gdp_data', methods=['GET'])

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000002094FA2F280>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002094F9E0F70>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x000002094F9B6310>
          └ APIRoute(path='/macro/gdp', name='get_gdp_data', methods=['GET'])

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
          │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000002094FA2F280>
          │                            │    │        │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002094F9E0F70>
          │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │                            │    └ <starlette.requests.Request object at 0x000002094FA3B430>
          │                            └ <function request_response.<locals>.app.<locals>.app at 0x000002094FA2F310>
          └ <function wrap_app_handling_exceptions at 0x000002091FBCA160>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000002094FA2FB80>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002094F9E0F70>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          └ <function request_response.<locals>.app.<locals>.app at 0x000002094FA2F310>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
                     │ └ <starlette.requests.Request object at 0x000002094FA3B430>
                     └ <function get_request_handler.<locals>.app at 0x000002094F9B63A0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x000002091FBEF430>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'source': 'tushare'}
                 │         └ <function get_gdp_data at 0x000002094F9A3820>
                 └ Dependant(path_params=[], query_params=[ModelField(field_info=Query(akshare), name='source', mode='validation')], header_para...

> File "C:\proj\ELSE\SELF\py-fastapi-demo\app\routers\router.py", line 24, in get_gdp_data
    data = macro_service.get_gdp_data(source=source)
           │             │                   └ 'tushare'
           │             └ <function get_gdp_data at 0x000002094F7E2280>
           └ <module 'app.services.macro_service' from 'C:\\proj\\ELSE\\SELF\\py-fastapi-demo\\app\\services\\macro_service.py'>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\app\services\macro_service.py", line 17, in get_gdp_data
    df = data_provider.get_macro_gdp_data(source=source)
         │             │                         └ 'tushare'
         │             └ <function TushareProvider.get_macro_gdp_data at 0x00000209307BDCA0>
         └ <data_providers.tushare.TushareProvider object at 0x000002094FA3BFA0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\data_providers\tushare.py", line 44, in get_macro_gdp_data
    raise RuntimeError(f"从 tushare 获取 GDP 数据失败: {str(e)}") from e

RuntimeError: 从 tushare 获取 GDP 数据失败: 抱歉，您没有接口访问权限，权限的具体详情访问：https://tushare.pro/document/1?doc_id=108。
2025-07-01 14:41:46.733 | INFO     | app.services.macro_service:get_gdp_data:13 - [Bridge]获取gdp数据并标准化输出格式 from tushare
2025-07-01 14:41:46.946 | ERROR    | app.services.macro_service:get_gdp_data:30 - 获取宏观GDP数据失败: 从 tushare 获取 GDP 数据失败: 抱歉，您没有接口访问权限，权限的具体详情访问：https://tushare.pro/document/1?doc_id=108。
2025-07-01 14:41:46.947 | ERROR    | app.routers.router:get_gdp_data:24 - An error has been caught in function 'get_gdp_data', process 'SpawnProcess-33' (34340), thread 'MainThread' (46284):
Traceback (most recent call last):

  File "C:\proj\ELSE\SELF\py-fastapi-demo\data_providers\tushare.py", line 39, in get_macro_gdp_data
    df = self.pro.cn_gdp(year="", field="")
         │    └ <tushare.pro.client.DataApi object at 0x000002275EFCBEE0>
         └ <data_providers.tushare.TushareProvider object at 0x000002275EFCB670>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\tushare\pro\client.py", line 45, in query
    raise Exception(result['msg'])
                    └ {'request_id': '60ab5fdd-108b-4b87-9a0a-30a268e122a3', 'code': 40203, 'data': None, 'msg': '抱歉，您没有接口访问权限，权限的具体详情访问：https://tu...

Exception: 抱歉，您没有接口访问权限，权限的具体详情访问：https://tushare.pro/document/1?doc_id=108。


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "C:\else_env\Python39\lib\multiprocessing\spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 316
               │     └ 3
               └ <function _main at 0x000002272BFB7AF0>

  File "C:\else_env\Python39\lib\multiprocessing\spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 316
           │    └ <function BaseProcess._bootstrap at 0x000002272BC4B5E0>
           └ <SpawnProcess name='SpawnProcess-33' parent=36700 started>

  File "C:\else_env\Python39\lib\multiprocessing\process.py", line 315, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x000002272BC46C10>
    └ <SpawnProcess name='SpawnProcess-33' parent=36700 started>

  File "C:\else_env\Python39\lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x000002272B58B3D0>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-33' parent=36700 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-33' parent=36700 started>
    │    └ <function subprocess_started at 0x000002272E14E040>
    └ <SpawnProcess name='SpawnProcess-33' parent=36700 started>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\uvicorn\_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=352, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('127.0.0.1', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x000002272B506CD0>>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\uvicorn\server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=352, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('127.0.0.1', 8001)>]
           │       │   │    └ <function Server.serve at 0x000002272E117040>
           │       │   └ <uvicorn.server.Server object at 0x000002272B506CD0>
           │       └ <function run at 0x000002272BFBB820>
           └ <module 'asyncio' from 'C:\\else_env\\Python39\\lib\\asyncio\\__init__.py'>

  File "C:\else_env\Python39\lib\asyncio\runners.py", line 44, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x000002272E10DA40>
           │    └ <function BaseEventLoop.run_until_complete at 0x000002272D94E670>
           └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 629, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x000002272D94E5E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 596, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x000002272D951160>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 1890, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x000002272D8DCDC0>
    └ <Handle <TaskStepMethWrapper object at 0x000002275EFBD550>()>

  File "C:\else_env\Python39\lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x000002275EFBD550>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x000002275EFBD550>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x000002275EFBD550>()>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\base.py", line 141, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000002275EFA7550>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002275EFA7430>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x000002275EF818B0>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x000002275EF81850>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000002275EFA7550>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002275EFA7430>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000002275EF817F0>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x000002275EF818B0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
          │                            │    │    │     │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000002275EFA7550>
          │                            │    │    │     │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002275EFA7430>
          │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │                            │    │    └ <starlette.requests.Request object at 0x000002275EFDA490>
          │                            │    └ <fastapi.routing.APIRouter object at 0x000002272F24BBB0>
          │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000002275EF817F0>
          └ <function wrap_app_handling_exceptions at 0x000002272F18A160>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000002275EFE1040>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002275EFA7430>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          └ <fastapi.routing.APIRouter object at 0x000002272F24BBB0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000002275EFE1040>
          │    │                │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002275EFA7430>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0x000002272F24BBB0>>
          └ <fastapi.routing.APIRouter object at 0x000002272F24BBB0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 734, in app
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000002275EFE1040>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002275EFA7430>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x000002272F1A9820>
          └ APIRoute(path='/macro/gdp', name='get_gdp_data', methods=['GET'])

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000002275EFE1040>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002275EFA7430>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x000002275EF76160>
          └ APIRoute(path='/macro/gdp', name='get_gdp_data', methods=['GET'])

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
          │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000002275EFE1040>
          │                            │    │        │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002275EFA7430>
          │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │                            │    └ <starlette.requests.Request object at 0x000002275EFDA2E0>
          │                            └ <function request_response.<locals>.app.<locals>.app at 0x000002275EFE10D0>
          └ <function wrap_app_handling_exceptions at 0x000002272F18A160>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000002275EFE1160>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002275EFA7430>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          └ <function request_response.<locals>.app.<locals>.app at 0x000002275EFE10D0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
                     │ └ <starlette.requests.Request object at 0x000002275EFDA2E0>
                     └ <function get_request_handler.<locals>.app at 0x000002275EF761F0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x000002272F1AF430>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'source': 'tushare'}
                 │         └ <function get_gdp_data at 0x000002275EF63670>
                 └ Dependant(path_params=[], query_params=[ModelField(field_info=Query(akshare), name='source', mode='validation')], header_para...

> File "C:\proj\ELSE\SELF\py-fastapi-demo\app\routers\router.py", line 24, in get_gdp_data
    data = macro_service.get_gdp_data(source=source)
           │             │                   └ 'tushare'
           │             └ <function get_gdp_data at 0x000002275EDA20D0>
           └ <module 'app.services.macro_service' from 'C:\\proj\\ELSE\\SELF\\py-fastapi-demo\\app\\services\\macro_service.py'>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\app\services\macro_service.py", line 17, in get_gdp_data
    df = data_provider.get_macro_gdp_data(source=source)
         │             │                         └ 'tushare'
         │             └ <function TushareProvider.get_macro_gdp_data at 0x000002273FD7BAF0>
         └ <data_providers.tushare.TushareProvider object at 0x000002275EFCB670>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\data_providers\tushare.py", line 44, in get_macro_gdp_data
    raise RuntimeError(f"从 tushare 获取 GDP 数据失败: {str(e)}") from e

RuntimeError: 从 tushare 获取 GDP 数据失败: 抱歉，您没有接口访问权限，权限的具体详情访问：https://tushare.pro/document/1?doc_id=108。
2025-07-01 14:54:11.272 | INFO     | app.services.macro_service:get_gdp_data:13 - [Bridge]获取gdp数据并标准化输出格式 from tushare
2025-07-01 14:54:11.470 | ERROR    | app.services.macro_service:get_gdp_data:30 - 获取宏观GDP数据失败: 从 tushare 获取 GDP 数据失败: 抱歉，您没有接口访问权限，权限的具体详情访问：https://tushare.pro/document/1?doc_id=108。
2025-07-01 14:54:11.470 | ERROR    | app.routers.router:get_gdp_data:24 - An error has been caught in function 'get_gdp_data', process 'SpawnProcess-34' (48092), thread 'MainThread' (38816):
Traceback (most recent call last):

  File "C:\proj\ELSE\SELF\py-fastapi-demo\data_providers\tushare.py", line 39, in get_macro_gdp_data
    df = self.pro.cn_gdp(year="", field="")
         │    └ <tushare.pro.client.DataApi object at 0x000002026DE07B20>
         └ <data_providers.tushare.TushareProvider object at 0x000002026DE07D00>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\tushare\pro\client.py", line 45, in query
    raise Exception(result['msg'])
                    └ {'request_id': 'f7113cf4-a0ba-4287-a7c2-2ab5b7c56854', 'code': 40203, 'data': None, 'msg': '抱歉，您没有接口访问权限，权限的具体详情访问：https://tu...

Exception: 抱歉，您没有接口访问权限，权限的具体详情访问：https://tushare.pro/document/1?doc_id=108。


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "C:\else_env\Python39\lib\multiprocessing\spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 352
               │     └ 3
               └ <function _main at 0x000002023ADF6AF0>

  File "C:\else_env\Python39\lib\multiprocessing\spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 352
           │    └ <function BaseProcess._bootstrap at 0x000002023AA845E0>
           └ <SpawnProcess name='SpawnProcess-34' parent=36700 started>

  File "C:\else_env\Python39\lib\multiprocessing\process.py", line 315, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x000002023AA86C10>
    └ <SpawnProcess name='SpawnProcess-34' parent=36700 started>

  File "C:\else_env\Python39\lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x000002023A7DB3D0>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-34' parent=36700 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-34' parent=36700 started>
    │    └ <function subprocess_started at 0x000002023CF8F040>
    └ <SpawnProcess name='SpawnProcess-34' parent=36700 started>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\uvicorn\_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=588, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('127.0.0.1', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x000002023A6A6CD0>>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\uvicorn\server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=588, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('127.0.0.1', 8001)>]
           │       │   │    └ <function Server.serve at 0x000002023CF57040>
           │       │   └ <uvicorn.server.Server object at 0x000002023A6A6CD0>
           │       └ <function run at 0x000002023ADEF820>
           └ <module 'asyncio' from 'C:\\else_env\\Python39\\lib\\asyncio\\__init__.py'>

  File "C:\else_env\Python39\lib\asyncio\runners.py", line 44, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x000002023CF4DA40>
           │    └ <function BaseEventLoop.run_until_complete at 0x000002023C79E670>
           └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 629, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x000002023C79E5E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 596, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x000002023C7A1160>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 1890, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x000002023C730DC0>
    └ <Handle <TaskStepMethWrapper object at 0x000002026DDFA850>()>

  File "C:\else_env\Python39\lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x000002026DDFA850>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x000002026DDFA850>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x000002026DDFA850>()>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\base.py", line 141, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000002026DDE0670>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002026DDE0550>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x000002026DDBFBB0>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x000002026DDBFB50>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000002026DDE0670>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002026DDE0550>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000002026DDBFAF0>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x000002026DDBFBB0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
          │                            │    │    │     │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000002026DDE0670>
          │                            │    │    │     │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002026DDE0550>
          │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │                            │    │    └ <starlette.requests.Request object at 0x000002026DE18580>
          │                            │    └ <fastapi.routing.APIRouter object at 0x000002023E08BBB0>
          │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000002026DDBFAF0>
          └ <function wrap_app_handling_exceptions at 0x000002023DFCA160>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000002026DE2F160>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002026DDE0550>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          └ <fastapi.routing.APIRouter object at 0x000002023E08BBB0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000002026DE2F160>
          │    │                │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002026DDE0550>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0x000002023E08BBB0>>
          └ <fastapi.routing.APIRouter object at 0x000002023E08BBB0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 734, in app
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000002026DE2F160>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002026DDE0550>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x000002023DFE9820>
          └ APIRoute(path='/macro/gdp', name='get_gdp_data', methods=['GET'])

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000002026DE2F160>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002026DDE0550>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x000002026DDB7280>
          └ APIRoute(path='/macro/gdp', name='get_gdp_data', methods=['GET'])

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
          │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000002026DE2F160>
          │                            │    │        │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002026DDE0550>
          │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │                            │    └ <starlette.requests.Request object at 0x000002026DE183D0>
          │                            └ <function request_response.<locals>.app.<locals>.app at 0x000002026DE2F1F0>
          └ <function wrap_app_handling_exceptions at 0x000002023DFCA160>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000002026DE2F280>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002026DDE0550>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          └ <function request_response.<locals>.app.<locals>.app at 0x000002026DE2F1F0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
                     │ └ <starlette.requests.Request object at 0x000002026DE183D0>
                     └ <function get_request_handler.<locals>.app at 0x000002026DDB7310>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x000002023DFEF430>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'source': 'tushare'}
                 │         └ <function get_gdp_data at 0x000002026DDA3790>
                 └ Dependant(path_params=[], query_params=[ModelField(field_info=Query(akshare), name='source', mode='validation')], header_para...

> File "C:\proj\ELSE\SELF\py-fastapi-demo\app\routers\router.py", line 24, in get_gdp_data
    data = macro_service.get_gdp_data(source=source)
           │             │                   └ 'tushare'
           │             └ <function get_gdp_data at 0x000002026DBE01F0>
           └ <module 'app.services.macro_service' from 'C:\\proj\\ELSE\\SELF\\py-fastapi-demo\\app\\services\\macro_service.py'>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\app\services\macro_service.py", line 17, in get_gdp_data
    df = data_provider.get_macro_gdp_data(source=source)
         │             │                         └ 'tushare'
         │             └ <function TushareProvider.get_macro_gdp_data at 0x000002024EBBBC10>
         └ <data_providers.tushare.TushareProvider object at 0x000002026DE07D00>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\data_providers\tushare.py", line 44, in get_macro_gdp_data
    raise RuntimeError(f"从 tushare 获取 GDP 数据失败: {str(e)}") from e

RuntimeError: 从 tushare 获取 GDP 数据失败: 抱歉，您没有接口访问权限，权限的具体详情访问：https://tushare.pro/document/1?doc_id=108。
2025-07-01 14:56:57.396 | INFO     | app.services.macro_service:get_gdp_data:12 - [Bridge]获取gdp数据并标准化输出格式 from tushare
2025-07-01 14:56:57.509 | ERROR    | app.services.macro_service:get_gdp_data:29 - 获取宏观GDP数据失败: 从 tushare 获取 GDP 数据失败: 抱歉，您没有接口访问权限，权限的具体详情访问：https://tushare.pro/document/1?doc_id=108。
2025-07-01 15:15:49.103 | INFO     | app.services.macro_service:get_gdp_data:12 - [Bridge]获取gdp数据并标准化输出格式 from tushare
2025-07-01 15:15:49.230 | ERROR    | app.services.macro_service:get_gdp_data:29 - 获取宏观GDP数据失败: 从 tushare 获取 GDP 数据失败: 抱歉，您没有接口访问权限，权限的具体详情访问：https://tushare.pro/document/1?doc_id=108。
2025-07-01 15:16:13.514 | INFO     | app.services.macro_service:get_gdp_data:12 - [Bridge]获取gdp数据并标准化输出格式 from tushare
2025-07-01 15:16:13.689 | ERROR    | app.services.macro_service:get_gdp_data:29 - 获取宏观GDP数据失败: 从 tushare 获取 GDP 数据失败: 抱歉，您没有接口访问权限，权限的具体详情访问：https://tushare.pro/document/1?doc_id=108。
2025-07-01 15:16:40.890 | INFO     | app.services.macro_service:get_gdp_data:12 - [Bridge]获取gdp数据并标准化输出格式 from tushare
2025-07-01 15:16:41.007 | ERROR    | app.services.macro_service:get_gdp_data:29 - 获取宏观GDP数据失败: 从 tushare 获取 GDP 数据失败: 抱歉，您没有接口访问权限，权限的具体详情访问：https://tushare.pro/document/1?doc_id=108。
2025-07-01 15:17:23.550 | INFO     | app.services.macro_service:get_gdp_data:12 - [Bridge]获取gdp数据并标准化输出格式 from tushare
2025-07-01 15:17:23.716 | ERROR    | app.services.macro_service:get_gdp_data:29 - 获取宏观GDP数据失败: 从 tushare 获取 GDP 数据失败: 抱歉，您没有接口访问权限，权限的具体详情访问：https://tushare.pro/document/1?doc_id=108。
2025-07-01 16:52:56.515 | INFO     | app.services.macro_service:get_gdp_data:12 - [Bridge]获取gdp数据并标准化输出格式 from qstock
2025-07-01 16:52:56.519 | ERROR    | app.services.macro_service:get_gdp_data:29 - 获取宏观GDP数据失败: QStock does not provide direct macro GDP data.
2025-07-01 17:29:23.413 | INFO     | app.services.macro_service:get_gdp_data:13 - [Bridge]获取gdp数据并标准化输出格式 from qstock
2025-07-01 17:29:23.414 | ERROR    | app.services.macro_service:get_gdp_data:30 - 获取宏观GDP数据失败: 从 QStock 获取 GDP 数据失败: QStock暂不支持获取宏观GDP数据
2025-07-01 17:29:30.606 | INFO     | app.services.data_service:get_stock_history:18 - [Bridge]获取股票历史行情数据并标准化输出格式 for 000001.SH from qstock
2025-07-01 17:29:30.708 | ERROR    | app.services.data_service:get_stock_history:38 - Missing '日期' column from qstock data
2025-07-02 14:26:40.145 | INFO     | app.services.data_service:get_stock_history:18 - [Bridge]获取股票历史行情数据并标准化输出格式 for 000001.SH from qstock
2025-07-02 14:26:40.275 | ERROR    | app.services.data_service:get_stock_history:51 - Error fetching stock history data
Traceback (most recent call last):

  File "C:\proj\ELSE\SELF\py-fastapi-demo\data_providers\qstock.py", line 20, in get_stock_history
    if isinstance(df, dict):

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\qstock\data\trade.py", line 662, in get_data
    df = pd.concat(data_list, axis=0)
         │  │      └ []
         │  └ <function concat at 0x00000244C2D70F70>
         └ <module 'pandas' from 'C:\\proj\\ELSE\\SELF\\py-fastapi-demo\\.venv\\lib\\site-packages\\pandas\\__init__.py'>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\pandas\core\reshape\concat.py", line 382, in concat
    op = _Concatenator(
         └ <class 'pandas.core.reshape.concat._Concatenator'>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\pandas\core\reshape\concat.py", line 445, in __init__
    objs, keys = self._clean_keys_and_objs(objs, keys)
    │            │    │                    │     └ None
    │            │    │                    └ []
    │            │    └ <function _Concatenator._clean_keys_and_objs at 0x00000244C2D783A0>
    │            └ <pandas.core.reshape.concat._Concatenator object at 0x00000244E2BDCAF0>
    └ []

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\pandas\core\reshape\concat.py", line 507, in _clean_keys_and_objs
    raise ValueError("No objects to concatenate")

ValueError: No objects to concatenate


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "C:\else_env\Python39\lib\multiprocessing\spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 348
               │     └ 3
               └ <function _main at 0x00000244AFB66AF0>

  File "C:\else_env\Python39\lib\multiprocessing\spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 348
           │    └ <function BaseProcess._bootstrap at 0x00000244AF8145E0>
           └ <SpawnProcess name='SpawnProcess-53' parent=36700 started>

  File "C:\else_env\Python39\lib\multiprocessing\process.py", line 315, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x00000244AF816C10>
    └ <SpawnProcess name='SpawnProcess-53' parent=36700 started>

  File "C:\else_env\Python39\lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x00000244AF56B3D0>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-53' parent=36700 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-53' parent=36700 started>
    │    └ <function subprocess_started at 0x00000244B1D00040>
    └ <SpawnProcess name='SpawnProcess-53' parent=36700 started>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\uvicorn\_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=560, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('127.0.0.1', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x00000244AF436CD0>>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\uvicorn\server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=560, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('127.0.0.1', 8001)>]
           │       │   │    └ <function Server.serve at 0x00000244B1CC7040>
           │       │   └ <uvicorn.server.Server object at 0x00000244AF436CD0>
           │       └ <function run at 0x00000244AFB63820>
           └ <module 'asyncio' from 'C:\\else_env\\Python39\\lib\\asyncio\\__init__.py'>

  File "C:\else_env\Python39\lib\asyncio\runners.py", line 44, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x00000244B1CBDA40>
           │    └ <function BaseEventLoop.run_until_complete at 0x00000244B14FE670>
           └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 629, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x00000244B14FE5E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 596, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x00000244B1501160>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 1890, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x00000244B1490DC0>
    └ <Handle <TaskStepMethWrapper object at 0x00000244E2B82700>()>

  File "C:\else_env\Python39\lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x00000244E2B82700>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x00000244E2B82700>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x00000244E2B82700>()>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\base.py", line 141, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x00000244E2BA5E50>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000244E2BA5AF0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x00000244E2B35430>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x00000244E2B353D0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x00000244E2BA5E50>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000244E2BA5AF0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x00000244E2B35370>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x00000244E2B35430>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
          │                            │    │    │     │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x00000244E2BA5E50>
          │                            │    │    │     │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000244E2BA5AF0>
          │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │                            │    │    └ <starlette.requests.Request object at 0x00000244E2B82D90>
          │                            │    └ <fastapi.routing.APIRouter object at 0x00000244E2A87430>
          │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x00000244E2B35370>
          └ <function wrap_app_handling_exceptions at 0x00000244B2D3A160>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x00000244E2BA5D30>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000244E2BA5AF0>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          └ <fastapi.routing.APIRouter object at 0x00000244E2A87430>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x00000244E2BA5D30>
          │    │                │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000244E2BA5AF0>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0x00000244E2A87430>>
          └ <fastapi.routing.APIRouter object at 0x00000244E2A87430>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 734, in app
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x00000244E2BA5D30>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000244E2BA5AF0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x00000244B2D59820>
          └ APIRoute(path='/data/index', name='get_history_data', methods=['GET'])

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x00000244E2BA5D30>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000244E2BA5AF0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x00000244E2B169D0>
          └ APIRoute(path='/data/index', name='get_history_data', methods=['GET'])

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
          │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x00000244E2BA5D30>
          │                            │    │        │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000244E2BA5AF0>
          │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │                            │    └ <starlette.requests.Request object at 0x00000244E2BB7670>
          │                            └ <function request_response.<locals>.app.<locals>.app at 0x00000244E2BA5A60>
          └ <function wrap_app_handling_exceptions at 0x00000244B2D3A160>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x00000244E2BA5B80>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000244E2BA5AF0>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          └ <function request_response.<locals>.app.<locals>.app at 0x00000244E2BA5A60>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
                     │ └ <starlette.requests.Request object at 0x00000244E2BB7670>
                     └ <function get_request_handler.<locals>.app at 0x00000244E2B16C10>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x00000244B2D5F430>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'source': 'qstock', 'market': 'SH', 'code': '000001', 'start_date': '20050501', 'end_date': '20050520'}
                 │         └ <function get_history_data at 0x00000244E2B16040>
                 └ Dependant(path_params=[], query_params=[ModelField(field_info=Query(akshare), name='source', mode='validation'), ModelField(f...

  File "C:\proj\ELSE\SELF\py-fastapi-demo\app\routers\router.py", line 15, in get_history_data
    df = data_service.get_stock_history(source=source, code=code, market=market, start_date=start_date, end_date=end_date)
         │            │                        │            │            │                  │                    └ '20050520'
         │            │                        │            │            │                  └ '20050501'
         │            │                        │            │            └ 'SH'
         │            │                        │            └ '000001'
         │            │                        └ 'qstock'
         │            └ <function get_stock_history at 0x00000244B2E00280>
         └ <module 'app.services.data_service' from 'C:\\proj\\ELSE\\SELF\\py-fastapi-demo\\app\\services\\data_service.py'>

> File "C:\proj\ELSE\SELF\py-fastapi-demo\app\services\data_service.py", line 21, in get_stock_history
    df = data_provider.get_stock_history(source=source, code=code, market=market, start_date=start_date, end_date=end_date)
         │             │                        │            │            │                  │                    └ '20050520'
         │             │                        │            │            │                  └ '20050501'
         │             │                        │            │            └ 'SH'
         │             │                        │            └ '000001'
         │             │                        └ 'qstock'
         │             └ <function QStockProvider.get_stock_history at 0x00000244DD04A3A0>
         └ <data_providers.qstock.QStockProvider object at 0x00000244E2BB7E50>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\data_providers\qstock.py", line 27, in get_stock_history
    def get_macro_gdp_data(self, source):
                           │     └ 'qstock'
                           └ <data_providers.qstock.QStockProvider object at 0x00000244E2BB7E50>

RuntimeError: 从 qstock 获取股票 000001 数据失败: No objects to concatenate
2025-07-02 14:26:58.169 | INFO     | app.services.data_service:get_stock_history:18 - [Bridge]获取股票历史行情数据并标准化输出格式 for 000001.SH from akshare
2025-07-02 14:26:58.211 | ERROR    | app.services.data_service:get_stock_history:51 - Error fetching stock history data
Traceback (most recent call last):

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\urllib3\connectionpool.py", line 773, in urlopen
    self._prepare_proxy(conn)
    │    │              └ None
    │    └ <function HTTPSConnectionPool._prepare_proxy at 0x00000244C330B940>
    └ <urllib3.connectionpool.HTTPSConnectionPool object at 0x00000244E2B61640>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\urllib3\connectionpool.py", line 1042, in _prepare_proxy
    conn.connect()
    │    └ <function HTTPSConnection.connect at 0x00000244C3330DC0>
    └ <urllib3.connection.HTTPSConnection object at 0x00000244E2B3CE20>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\urllib3\connection.py", line 762, in connect
    self.sock = sock = self._connect_tls_proxy(self.host, sock)
    │    │             │    │                  │    │     └ <socket.socket [closed] fd=-1, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0>
    │    │             │    │                  │    └ <property object at 0x00000244C332EA40>
    │    │             │    │                  └ <urllib3.connection.HTTPSConnection object at 0x00000244E2B3CE20>
    │    │             │    └ <function HTTPSConnection._connect_tls_proxy at 0x00000244C3330E50>
    │    │             └ <urllib3.connection.HTTPSConnection object at 0x00000244E2B3CE20>
    │    └ None
    └ <urllib3.connection.HTTPSConnection object at 0x00000244E2B3CE20>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\urllib3\connection.py", line 862, in _connect_tls_proxy
    sock_and_verified = _ssl_wrap_socket_and_match_hostname(
                        └ <function _ssl_wrap_socket_and_match_hostname at 0x00000244C33265E0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\urllib3\connection.py", line 969, in _ssl_wrap_socket_and_match_hostname
    ssl_sock = ssl_wrap_socket(
               └ <function ssl_wrap_socket at 0x00000244C32F5430>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\urllib3\util\ssl_.py", line 480, in ssl_wrap_socket
    ssl_sock = _ssl_wrap_socket_impl(sock, context, tls_in_tls, server_hostname)
               │                     │     │        │           └ '127.0.0.1'
               │                     │     │        └ False
               │                     │     └ <ssl.SSLContext object at 0x00000244E2D1B2C0>
               │                     └ <socket.socket [closed] fd=-1, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0>
               └ <function _ssl_wrap_socket_impl at 0x00000244C32F55E0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\urllib3\util\ssl_.py", line 524, in _ssl_wrap_socket_impl
    return ssl_context.wrap_socket(sock, server_hostname=server_hostname)
           │           │           │                     └ '127.0.0.1'
           │           │           └ <socket.socket [closed] fd=-1, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0>
           │           └ <function SSLContext.wrap_socket at 0x00000244B1413CA0>
           └ <ssl.SSLContext object at 0x00000244E2D1B2C0>

  File "C:\else_env\Python39\lib\ssl.py", line 500, in wrap_socket
    return self.sslsocket_class._create(
           │    │               └ <classmethod object at 0x00000244B1417130>
           │    └ <class 'ssl.SSLSocket'>
           └ <ssl.SSLContext object at 0x00000244E2D1B2C0>

  File "C:\else_env\Python39\lib\ssl.py", line 1040, in _create
    self.do_handshake()
    │    └ <function SSLSocket.do_handshake at 0x00000244B141AB80>
    └ <ssl.SSLSocket [closed] fd=-1, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0>

  File "C:\else_env\Python39\lib\ssl.py", line 1309, in do_handshake
    self._sslobj.do_handshake()
    │    └ None
    └ <ssl.SSLSocket [closed] fd=-1, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0>

FileNotFoundError: [Errno 2] No such file or directory


The above exception was the direct cause of the following exception:


urllib3.exceptions.ProxyError: ('Unable to connect to proxy', FileNotFoundError(2, 'No such file or directory'))


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\requests\adapters.py", line 667, in send
    resp = conn.urlopen(
           │    └ <function HTTPConnectionPool.urlopen at 0x00000244C330B820>
           └ <urllib3.connectionpool.HTTPSConnectionPool object at 0x00000244E2B61640>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\urllib3\connectionpool.py", line 841, in urlopen
    retries = retries.increment(
              │       └ <function Retry.increment at 0x00000244C32C4EE0>
              └ Retry(total=0, connect=None, read=False, redirect=None, status=None)

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\urllib3\util\retry.py", line 519, in increment
    raise MaxRetryError(_pool, url, reason) from reason  # type: ignore[arg-type]
          │             │      │    │            └ ProxyError('Unable to connect to proxy', FileNotFoundError(2, 'No such file or directory'))
          │             │      │    └ ProxyError('Unable to connect to proxy', FileNotFoundError(2, 'No such file or directory'))
          │             │      └ '/api/qt/stock/kline/get?fields1=f1%2Cf2%2Cf3%2Cf4%2Cf5%2Cf6&fields2=f51%2Cf52%2Cf53%2Cf54%2Cf55%2Cf56%2Cf57%2Cf58%2Cf59%2Cf6...
          │             └ <urllib3.connectionpool.HTTPSConnectionPool object at 0x00000244E2B61640>
          └ <class 'urllib3.exceptions.MaxRetryError'>

urllib3.exceptions.MaxRetryError: HTTPSConnectionPool(host='push2his.eastmoney.com', port=443): Max retries exceeded with url: /api/qt/stock/kline/get?fields1=f1%2Cf2%2Cf3%2Cf4%2Cf5%2Cf6&fields2=f51%2Cf52%2Cf53%2Cf54%2Cf55%2Cf56%2Cf57%2Cf58%2Cf59%2Cf60%2Cf61%2Cf116&ut=7eea3edcaed734bea9cbfc24409ed989&klt=101&fqt=2&secid=0.000001&beg=20050501&end=20050520 (Caused by ProxyError('Unable to connect to proxy', FileNotFoundError(2, 'No such file or directory')))


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\proj\ELSE\SELF\py-fastapi-demo\data_providers\akshare.py", line 10, in get_stock_history
    :param code: 股票代码，如 '000001'
           └ '000001'

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\akshare\stock_feature\stock_hist_em.py", line 927, in stock_zh_a_hist
    r = requests.get(url, params=params, timeout=timeout)
        │        │   │           │               └ None
        │        │   │           └ {'fields1': 'f1,f2,f3,f4,f5,f6', 'fields2': 'f51,f52,f53,f54,f55,f56,f57,f58,f59,f60,f61,f116', 'ut': '7eea3edcaed734bea9cbfc...
        │        │   └ 'https://push2his.eastmoney.com/api/qt/stock/kline/get'
        │        └ <function get at 0x00000244C34BA160>
        └ <module 'requests' from 'C:\\proj\\ELSE\\SELF\\py-fastapi-demo\\.venv\\lib\\site-packages\\requests\\__init__.py'>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\requests\api.py", line 73, in get
    return request("get", url, params=params, **kwargs)
           │              │           │         └ {'timeout': None}
           │              │           └ {'fields1': 'f1,f2,f3,f4,f5,f6', 'fields2': 'f51,f52,f53,f54,f55,f56,f57,f58,f59,f60,f61,f116', 'ut': '7eea3edcaed734bea9cbfc...
           │              └ 'https://push2his.eastmoney.com/api/qt/stock/kline/get'
           └ <function request at 0x00000244C3467790>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\requests\api.py", line 59, in request
    return session.request(method=method, url=url, **kwargs)
           │       │              │           │      └ {'params': {'fields1': 'f1,f2,f3,f4,f5,f6', 'fields2': 'f51,f52,f53,f54,f55,f56,f57,f58,f59,f60,f61,f116', 'ut': '7eea3edcaed...
           │       │              │           └ 'https://push2his.eastmoney.com/api/qt/stock/kline/get'
           │       │              └ 'get'
           │       └ <function Session.request at 0x00000244C34B98B0>
           └ <requests.sessions.Session object at 0x00000244E2B82850>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\requests\sessions.py", line 589, in request
    resp = self.send(prep, **send_kwargs)
           │    │    │       └ {'timeout': None, 'allow_redirects': True, 'proxies': OrderedDict([('http', 'http://127.0.0.1:10809'), ('https', 'https://127...
           │    │    └ <PreparedRequest [GET]>
           │    └ <function Session.send at 0x00000244C34B9D30>
           └ <requests.sessions.Session object at 0x00000244E2B82850>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\requests\sessions.py", line 703, in send
    r = adapter.send(request, **kwargs)
        │       │    │          └ {'timeout': None, 'proxies': OrderedDict([('http', 'http://127.0.0.1:10809'), ('https', 'https://127.0.0.1:10809'), ('ftp', '...
        │       │    └ <PreparedRequest [GET]>
        │       └ <function HTTPAdapter.send at 0x00000244C34B9280>
        └ <requests.adapters.HTTPAdapter object at 0x00000244E2B82B80>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\requests\adapters.py", line 694, in send
    raise ProxyError(e, request=request)
          │                     └ <PreparedRequest [GET]>
          └ <class 'requests.exceptions.ProxyError'>

requests.exceptions.ProxyError: HTTPSConnectionPool(host='push2his.eastmoney.com', port=443): Max retries exceeded with url: /api/qt/stock/kline/get?fields1=f1%2Cf2%2Cf3%2Cf4%2Cf5%2Cf6&fields2=f51%2Cf52%2Cf53%2Cf54%2Cf55%2Cf56%2Cf57%2Cf58%2Cf59%2Cf60%2Cf61%2Cf116&ut=7eea3edcaed734bea9cbfc24409ed989&klt=101&fqt=2&secid=0.000001&beg=20050501&end=20050520 (Caused by ProxyError('Unable to connect to proxy', FileNotFoundError(2, 'No such file or directory')))


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "C:\else_env\Python39\lib\multiprocessing\spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 348
               │     └ 3
               └ <function _main at 0x00000244AFB66AF0>

  File "C:\else_env\Python39\lib\multiprocessing\spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 348
           │    └ <function BaseProcess._bootstrap at 0x00000244AF8145E0>
           └ <SpawnProcess name='SpawnProcess-53' parent=36700 started>

  File "C:\else_env\Python39\lib\multiprocessing\process.py", line 315, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x00000244AF816C10>
    └ <SpawnProcess name='SpawnProcess-53' parent=36700 started>

  File "C:\else_env\Python39\lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x00000244AF56B3D0>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-53' parent=36700 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-53' parent=36700 started>
    │    └ <function subprocess_started at 0x00000244B1D00040>
    └ <SpawnProcess name='SpawnProcess-53' parent=36700 started>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\uvicorn\_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=560, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('127.0.0.1', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x00000244AF436CD0>>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\uvicorn\server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=560, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('127.0.0.1', 8001)>]
           │       │   │    └ <function Server.serve at 0x00000244B1CC7040>
           │       │   └ <uvicorn.server.Server object at 0x00000244AF436CD0>
           │       └ <function run at 0x00000244AFB63820>
           └ <module 'asyncio' from 'C:\\else_env\\Python39\\lib\\asyncio\\__init__.py'>

  File "C:\else_env\Python39\lib\asyncio\runners.py", line 44, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x00000244B1CBDA40>
           │    └ <function BaseEventLoop.run_until_complete at 0x00000244B14FE670>
           └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 629, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x00000244B14FE5E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 596, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x00000244B1501160>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 1890, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x00000244B1490DC0>
    └ <Handle <TaskStepMethWrapper object at 0x00000244E2BDCF10>()>

  File "C:\else_env\Python39\lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x00000244E2BDCF10>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x00000244E2BDCF10>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x00000244E2BDCF10>()>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\base.py", line 141, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x00000244E2BA5DC0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000244E2BA5EE0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x00000244E2B35430>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x00000244E2B353D0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x00000244E2BA5DC0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000244E2BA5EE0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x00000244E2B35370>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x00000244E2B35430>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
          │                            │    │    │     │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x00000244E2BA5DC0>
          │                            │    │    │     │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000244E2BA5EE0>
          │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │                            │    │    └ <starlette.requests.Request object at 0x00000244E2BDCEB0>
          │                            │    └ <fastapi.routing.APIRouter object at 0x00000244E2A87430>
          │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x00000244E2B35370>
          └ <function wrap_app_handling_exceptions at 0x00000244B2D3A160>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x00000244E2BA5A60>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000244E2BA5EE0>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          └ <fastapi.routing.APIRouter object at 0x00000244E2A87430>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x00000244E2BA5A60>
          │    │                │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000244E2BA5EE0>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0x00000244E2A87430>>
          └ <fastapi.routing.APIRouter object at 0x00000244E2A87430>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 734, in app
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x00000244E2BA5A60>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000244E2BA5EE0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x00000244B2D59820>
          └ APIRoute(path='/data/index', name='get_history_data', methods=['GET'])

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x00000244E2BA5A60>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000244E2BA5EE0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x00000244E2B169D0>
          └ APIRoute(path='/data/index', name='get_history_data', methods=['GET'])

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
          │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x00000244E2BA5A60>
          │                            │    │        │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000244E2BA5EE0>
          │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │                            │    └ <starlette.requests.Request object at 0x00000244E2B82F40>
          │                            └ <function request_response.<locals>.app.<locals>.app at 0x00000244E2BA5B80>
          └ <function wrap_app_handling_exceptions at 0x00000244B2D3A160>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x00000244E2BA5F70>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000244E2BA5EE0>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          └ <function request_response.<locals>.app.<locals>.app at 0x00000244E2BA5B80>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
                     │ └ <starlette.requests.Request object at 0x00000244E2B82F40>
                     └ <function get_request_handler.<locals>.app at 0x00000244E2B16C10>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x00000244B2D5F430>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'source': 'akshare', 'market': 'SH', 'code': '000001', 'start_date': '20050501', 'end_date': '20050520'}
                 │         └ <function get_history_data at 0x00000244E2B16040>
                 └ Dependant(path_params=[], query_params=[ModelField(field_info=Query(akshare), name='source', mode='validation'), ModelField(f...

  File "C:\proj\ELSE\SELF\py-fastapi-demo\app\routers\router.py", line 15, in get_history_data
    df = data_service.get_stock_history(source=source, code=code, market=market, start_date=start_date, end_date=end_date)
         │            │                        │            │            │                  │                    └ '20050520'
         │            │                        │            │            │                  └ '20050501'
         │            │                        │            │            └ 'SH'
         │            │                        │            └ '000001'
         │            │                        └ 'akshare'
         │            └ <function get_stock_history at 0x00000244B2E00280>
         └ <module 'app.services.data_service' from 'C:\\proj\\ELSE\\SELF\\py-fastapi-demo\\app\\services\\data_service.py'>

> File "C:\proj\ELSE\SELF\py-fastapi-demo\app\services\data_service.py", line 21, in get_stock_history
    df = data_provider.get_stock_history(source=source, code=code, market=market, start_date=start_date, end_date=end_date)
         │             │                        │            │            │                  │                    └ '20050520'
         │             │                        │            │            │                  └ '20050501'
         │             │                        │            │            └ 'SH'
         │             │                        │            └ '000001'
         │             │                        └ 'akshare'
         │             └ <function AkShareProvider.get_stock_history at 0x00000244C392BD30>
         └ <data_providers.akshare.AkShareProvider object at 0x00000244E2B82D60>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\data_providers\akshare.py", line 15, in get_stock_history
    """

RuntimeError: 从 akshare 获取股票 000001 数据失败: HTTPSConnectionPool(host='push2his.eastmoney.com', port=443): Max retries exceeded with url: /api/qt/stock/kline/get?fields1=f1%2Cf2%2Cf3%2Cf4%2Cf5%2Cf6&fields2=f51%2Cf52%2Cf53%2Cf54%2Cf55%2Cf56%2Cf57%2Cf58%2Cf59%2Cf60%2Cf61%2Cf116&ut=7eea3edcaed734bea9cbfc24409ed989&klt=101&fqt=2&secid=0.000001&beg=20050501&end=20050520 (Caused by ProxyError('Unable to connect to proxy', FileNotFoundError(2, 'No such file or directory')))
2025-07-02 14:27:32.100 | INFO     | app.services.data_service:get_stock_history:18 - [Bridge]获取股票历史行情数据并标准化输出格式 for 000001.SH from akshare
2025-07-02 14:28:19.641 | INFO     | app.services.data_service:get_stock_history:18 - [Bridge]获取股票历史行情数据并标准化输出格式 for 000001.SH from qstock
2025-07-02 14:28:19.767 | ERROR    | app.services.data_service:get_stock_history:38 - Missing '日期' column from qstock data
2025-07-02 14:31:13.932 | INFO     | app.services.data_service:get_stock_history:18 - [Bridge]获取股票历史行情数据并标准化输出格式 for 000001.SH from qstock
2025-07-02 14:31:14.104 | ERROR    | app.services.data_service:get_stock_history:38 - Missing '日期' column from qstock data
2025-07-02 14:52:30.193 | INFO     | app.services.data_service:get_stock_history:18 - [Bridge]获取股票历史行情数据并标准化输出格式 for 000001.SH from qstock
2025-07-02 14:52:30.323 | ERROR    | app.services.data_service:get_stock_history:38 - Missing '日期' column from qstock data
2025-07-02 14:53:34.576 | INFO     | app.services.data_service:get_stock_history:18 - [Bridge]获取股票历史行情数据并标准化输出格式 for 000001.SH from qstock
2025-07-02 14:53:34.903 | ERROR    | app.services.data_service:get_stock_history:38 - Missing '日期' column from qstock data
2025-07-02 15:11:18.696 | INFO     | app.services.data_service:get_stock_history:18 - [Bridge]获取股票历史行情数据并标准化输出格式 for 000001.SH from qstock
2025-07-02 15:11:18.825 | ERROR    | app.services.data_service:get_stock_history:38 - Missing '日期' column from qstock data
2025-07-02 15:11:42.729 | INFO     | app.services.data_service:get_stock_history:18 - [Bridge]获取股票历史行情数据并标准化输出格式 for 000001.SH from qstock
2025-07-02 15:11:42.780 | ERROR    | app.services.data_service:get_stock_history:38 - Missing '日期' column from qstock data
2025-07-02 15:12:36.322 | INFO     | app.services.data_service:get_stock_history:18 - [Bridge]获取股票历史行情数据并标准化输出格式 for 000001.SH from qstock
2025-07-02 15:12:36.493 | ERROR    | app.services.data_service:get_stock_history:38 - Missing '日期' column from qstock data
2025-07-02 15:12:43.252 | INFO     | app.services.data_service:get_stock_history:18 - [Bridge]获取股票历史行情数据并标准化输出格式 for 000001.SH from qstock
2025-07-02 15:12:43.338 | ERROR    | app.services.data_service:get_stock_history:38 - Missing '日期' column from qstock data
2025-07-02 15:13:12.749 | INFO     | app.services.data_service:get_stock_history:20 - [Bridge]获取股票历史行情数据并标准化输出格式 for 000001.SH from qstock
2025-07-02 15:13:12.833 | ERROR    | app.services.data_service:get_stock_history:38 - Missing '日期' column from qstock data
2025-07-02 15:20:45.311 | INFO     | app.services.data_service:get_stock_history:20 - [Bridge]获取股票历史行情数据并标准化输出格式 for 000001.SH from qstock
2025-07-02 15:20:45.438 | ERROR    | app.services.data_service:get_stock_history:83 - Error fetching stock history data
Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "C:\else_env\Python39\lib\multiprocessing\spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 324
               │     └ 3
               └ <function _main at 0x000001CDAFBD6AF0>

  File "C:\else_env\Python39\lib\multiprocessing\spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 324
           │    └ <function BaseProcess._bootstrap at 0x000001CDAF88B5E0>
           └ <SpawnProcess name='SpawnProcess-3' parent=58752 started>

  File "C:\else_env\Python39\lib\multiprocessing\process.py", line 315, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x000001CDAF886C10>
    └ <SpawnProcess name='SpawnProcess-3' parent=58752 started>

  File "C:\else_env\Python39\lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x000001CDAF5DB3D0>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-3' parent=58752 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-3' parent=58752 started>
    │    └ <function subprocess_started at 0x000001CDB1D5F040>
    └ <SpawnProcess name='SpawnProcess-3' parent=58752 started>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\uvicorn\_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=392, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('127.0.0.1', 8002)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x000001CDAF126CD0>>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\uvicorn\server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=392, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('127.0.0.1', 8002)>]
           │       │   │    └ <function Server.serve at 0x000001CDB1D27040>
           │       │   └ <uvicorn.server.Server object at 0x000001CDAF126CD0>
           │       └ <function run at 0x000001CDAFBCE820>
           └ <module 'asyncio' from 'C:\\else_env\\Python39\\lib\\asyncio\\__init__.py'>

  File "C:\else_env\Python39\lib\asyncio\runners.py", line 44, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x000001CDB1D1DA40>
           │    └ <function BaseEventLoop.run_until_complete at 0x000001CDB155E670>
           └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 629, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x000001CDB155E5E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 596, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x000001CDB1561160>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 1890, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x000001CDB14F0DC0>
    └ <Handle <TaskStepMethWrapper object at 0x000001CDE2BC3F40>()>

  File "C:\else_env\Python39\lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x000001CDE2BC3F40>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x000001CDE2BC3F40>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x000001CDE2BC3F40>()>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\base.py", line 141, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000001CDE2B96F70>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001CDE2B96E50>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x000001CDE2B95370>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x000001CDE2B95310>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000001CDE2B96F70>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001CDE2B96E50>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000001CDE2B952B0>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x000001CDE2B95370>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
          │                            │    │    │     │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000001CDE2B96F70>
          │                            │    │    │     │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001CDE2B96E50>
          │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │                            │    │    └ <starlette.requests.Request object at 0x000001CDE2BED6D0>
          │                            │    └ <fastapi.routing.APIRouter object at 0x000001CDE2AE93D0>
          │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000001CDE2B952B0>
          └ <function wrap_app_handling_exceptions at 0x000001CDB2D9D160>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001CDE2BFFA60>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001CDE2B96E50>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          └ <fastapi.routing.APIRouter object at 0x000001CDE2AE93D0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001CDE2BFFA60>
          │    │                │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001CDE2B96E50>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0x000001CDE2AE93D0>>
          └ <fastapi.routing.APIRouter object at 0x000001CDE2AE93D0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 734, in app
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001CDE2BFFA60>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001CDE2B96E50>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │     └ <function Route.handle at 0x000001CDB2DB9820>
          └ APIRoute(path='/data/index', name='get_history_data', methods=['GET'])

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001CDE2BFFA60>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001CDE2B96E50>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <function request_response.<locals>.app at 0x000001CDE2B7D8B0>
          └ APIRoute(path='/data/index', name='get_history_data', methods=['GET'])

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
          │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001CDE2BFFA60>
          │                            │    │        │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001CDE2B96E50>
          │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │                            │    └ <starlette.requests.Request object at 0x000001CDE2BED520>
          │                            └ <function request_response.<locals>.app.<locals>.app at 0x000001CDE2BFFAF0>
          └ <function wrap_app_handling_exceptions at 0x000001CDB2D9D160>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001CDE2BFFB80>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001CDE2B96E50>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          └ <function request_response.<locals>.app.<locals>.app at 0x000001CDE2BFFAF0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
                     │ └ <starlette.requests.Request object at 0x000001CDE2BED520>
                     └ <function get_request_handler.<locals>.app at 0x000001CDE2B7DAF0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x000001CDB2DBF430>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'source': 'qstock', 'market': 'SH', 'code': '000001', 'start_date': '20050501', 'end_date': '20050520'}
                 │         └ <function get_history_data at 0x000001CDE2B72EE0>
                 └ Dependant(path_params=[], query_params=[ModelField(field_info=Query(akshare), name='source', mode='validation'), ModelField(f...

  File "C:\proj\ELSE\SELF\py-fastapi-demo\app\routers\router.py", line 15, in get_history_data
    df = data_service.get_stock_history(source=source, code=code, market=market, start_date=start_date, end_date=end_date)
         │            │                        │            │            │                  │                    └ '20050520'
         │            │                        │            │            │                  └ '20050501'
         │            │                        │            │            └ 'SH'
         │            │                        │            └ '000001'
         │            │                        └ 'qstock'
         │            └ <function get_stock_history at 0x000001CDB2E61280>
         └ <module 'app.services.data_service' from 'C:\\proj\\ELSE\\SELF\\py-fastapi-demo\\app\\services\\data_service.py'>

> File "C:\proj\ELSE\SELF\py-fastapi-demo\app\services\data_service.py", line 69, in get_stock_history
    raise KeyError(f"数据源 {source} 返回的数据缺少字段: {', '.join(missing_cols)}")

KeyError: '数据源 qstock 返回的数据缺少字段: date'
2025-07-02 15:36:25.750 | INFO     | app.services.data_service:get_stock_history:20 - [Bridge]获取股票历史行情数据并标准化输出格式 for 000001.SH from akshare
2025-07-02 15:36:46.044 | INFO     | app.services.data_service:get_stock_history:20 - [Bridge]获取股票历史行情数据并标准化输出格式 for 000001.SH from tushare
2025-07-02 15:36:46.234 | ERROR    | app.services.data_service:get_stock_history:74 - Error fetching stock history data
Traceback (most recent call last):

  File "C:\proj\ELSE\SELF\py-fastapi-demo\data_providers\tushare.py", line 24, in get_stock_history
    raise ValueError(f"从 tushare 获取股票 {code} 的数据为空")

ValueError: 从 tushare 获取股票 000001 的数据为空


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "C:\else_env\Python39\lib\multiprocessing\spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 340
               │     └ 3
               └ <function _main at 0x000001BA2D7B6AF0>

  File "C:\else_env\Python39\lib\multiprocessing\spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 340
           │    └ <function BaseProcess._bootstrap at 0x000001BA2D46B5E0>
           └ <SpawnProcess name='SpawnProcess-4' parent=58752 started>

  File "C:\else_env\Python39\lib\multiprocessing\process.py", line 315, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x000001BA2D466C10>
    └ <SpawnProcess name='SpawnProcess-4' parent=58752 started>

  File "C:\else_env\Python39\lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x000001BA2D1BB3D0>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-4' parent=58752 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-4' parent=58752 started>
    │    └ <function subprocess_started at 0x000001BA2F94F040>
    └ <SpawnProcess name='SpawnProcess-4' parent=58752 started>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\uvicorn\_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=768, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('127.0.0.1', 8002)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x000001BA2CD06CD0>>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\uvicorn\server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=768, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('127.0.0.1', 8002)>]
           │       │   │    └ <function Server.serve at 0x000001BA2F917040>
           │       │   └ <uvicorn.server.Server object at 0x000001BA2CD06CD0>
           │       └ <function run at 0x000001BA2D7BB820>
           └ <module 'asyncio' from 'C:\\else_env\\Python39\\lib\\asyncio\\__init__.py'>

  File "C:\else_env\Python39\lib\asyncio\runners.py", line 44, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x000001BA2F90DA40>
           │    └ <function BaseEventLoop.run_until_complete at 0x000001BA2F14E670>
           └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 629, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x000001BA2F14E5E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 596, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x000001BA2F151160>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 1890, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x000001BA2F0E0DC0>
    └ <Handle <TaskStepMethWrapper object at 0x000001BA607CD370>()>

  File "C:\else_env\Python39\lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x000001BA607CD370>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x000001BA607CD370>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x000001BA607CD370>()>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\base.py", line 141, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000001BA607B4040>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001BA607B48B0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x000001BA60780760>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x000001BA60780700>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000001BA607B4040>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001BA607B48B0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000001BA607806A0>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x000001BA60780760>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
          │                            │    │    │     │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000001BA607B4040>
          │                            │    │    │     │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001BA607B48B0>
          │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │                            │    │    └ <starlette.requests.Request object at 0x000001BA607CDD60>
          │                            │    └ <fastapi.routing.APIRouter object at 0x000001BA6075AF70>
          │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000001BA607806A0>
          └ <function wrap_app_handling_exceptions at 0x000001BA3098A160>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001BA607F7D30>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001BA607B48B0>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          └ <fastapi.routing.APIRouter object at 0x000001BA6075AF70>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001BA607F7D30>
          │    │                │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001BA607B48B0>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0x000001BA6075AF70>>
          └ <fastapi.routing.APIRouter object at 0x000001BA6075AF70>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 734, in app
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001BA607F7D30>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001BA607B48B0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │     └ <function Route.handle at 0x000001BA309A9820>
          └ APIRoute(path='/data/index', name='get_history_data', methods=['GET'])

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001BA607F7D30>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001BA607B48B0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <function request_response.<locals>.app at 0x000001BA6076A940>
          └ APIRoute(path='/data/index', name='get_history_data', methods=['GET'])

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
          │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001BA607F7D30>
          │                            │    │        │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001BA607B48B0>
          │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │                            │    └ <starlette.requests.Request object at 0x000001BA607CD880>
          │                            └ <function request_response.<locals>.app.<locals>.app at 0x000001BA607F7CA0>
          └ <function wrap_app_handling_exceptions at 0x000001BA3098A160>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001BA607F7C10>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001BA607B48B0>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          └ <function request_response.<locals>.app.<locals>.app at 0x000001BA607F7CA0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
                     │ └ <starlette.requests.Request object at 0x000001BA607CD880>
                     └ <function get_request_handler.<locals>.app at 0x000001BA6076AB80>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x000001BA309AF430>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'source': 'tushare', 'market': 'SH', 'code': '000001', 'start_date': '20050501', 'end_date': '20050520'}
                 │         └ <function get_history_data at 0x000001BA60762F70>
                 └ Dependant(path_params=[], query_params=[ModelField(field_info=Query(akshare), name='source', mode='validation'), ModelField(f...

  File "C:\proj\ELSE\SELF\py-fastapi-demo\app\routers\router.py", line 15, in get_history_data
    df = data_service.get_stock_history(source=source, code=code, market=market, start_date=start_date, end_date=end_date)
         │            │                        │            │            │                  │                    └ '20050520'
         │            │                        │            │            │                  └ '20050501'
         │            │                        │            │            └ 'SH'
         │            │                        │            └ '000001'
         │            │                        └ 'tushare'
         │            └ <function get_stock_history at 0x000001BA30AC1670>
         └ <module 'app.services.data_service' from 'C:\\proj\\ELSE\\SELF\\py-fastapi-demo\\app\\services\\data_service.py'>

> File "C:\proj\ELSE\SELF\py-fastapi-demo\app\services\data_service.py", line 23, in get_stock_history
    df = data_provider.get_stock_history(source=source, code=code, market=market, start_date=start_date, end_date=end_date)
         │             │                        │            │            │                  │                    └ '20050520'
         │             │                        │            │            │                  └ '20050501'
         │             │                        │            │            └ 'SH'
         │             │                        │            └ '000001'
         │             │                        └ 'tushare'
         │             └ <function TushareProvider.get_stock_history at 0x000001BA4157BA60>
         └ <data_providers.tushare.TushareProvider object at 0x000001BA607CDAF0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\data_providers\tushare.py", line 27, in get_stock_history
    raise RuntimeError(f"从 tushare 获取股票 {code} 数据失败: {str(e)}") from e

RuntimeError: 从 tushare 获取股票 000001 数据失败: 从 tushare 获取股票 000001 的数据为空
2025-07-02 15:42:49.571 | INFO     | app.services.data_service:get_stock_history:20 - [Bridge]获取股票历史行情数据并标准化输出格式 for 000001.SH from tushare
2025-07-02 15:42:49.720 | ERROR    | app.services.data_service:get_stock_history:74 - Error fetching stock history data
Traceback (most recent call last):

  File "C:\proj\ELSE\SELF\py-fastapi-demo\data_providers\tushare.py", line 24, in get_stock_history
    raise ValueError(f"从 tushare 获取股票 {code} 的数据为空")

ValueError: 从 tushare 获取股票 000001 的数据为空


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "C:\else_env\Python39\lib\multiprocessing\spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 336
               │     └ 3
               └ <function _main at 0x000001E74A9C6AF0>

  File "C:\else_env\Python39\lib\multiprocessing\spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 336
           │    └ <function BaseProcess._bootstrap at 0x000001E74A6445E0>
           └ <SpawnProcess name='SpawnProcess-5' parent=58752 started>

  File "C:\else_env\Python39\lib\multiprocessing\process.py", line 315, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x000001E74A646C10>
    └ <SpawnProcess name='SpawnProcess-5' parent=58752 started>

  File "C:\else_env\Python39\lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x000001E749F9B3D0>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-5' parent=58752 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-5' parent=58752 started>
    │    └ <function subprocess_started at 0x000001E74CB62040>
    └ <SpawnProcess name='SpawnProcess-5' parent=58752 started>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\uvicorn\_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=880, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('127.0.0.1', 8002)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x000001E749F16CD0>>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\uvicorn\server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=880, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('127.0.0.1', 8002)>]
           │       │   │    └ <function Server.serve at 0x000001E74CB27040>
           │       │   └ <uvicorn.server.Server object at 0x000001E749F16CD0>
           │       └ <function run at 0x000001E74A9C0820>
           └ <module 'asyncio' from 'C:\\else_env\\Python39\\lib\\asyncio\\__init__.py'>

  File "C:\else_env\Python39\lib\asyncio\runners.py", line 44, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x000001E74CB1DA40>
           │    └ <function BaseEventLoop.run_until_complete at 0x000001E74C35E670>
           └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 629, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x000001E74C35E5E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 596, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x000001E74C361160>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 1890, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x000001E74C2F0DC0>
    └ <Handle <TaskStepMethWrapper object at 0x000001E77D9C5DF0>()>

  File "C:\else_env\Python39\lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x000001E77D9C5DF0>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x000001E77D9C5DF0>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x000001E77D9C5DF0>()>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\base.py", line 141, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000001E77D9C20D0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001E77D993F70>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x000001E77D994250>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x000001E77D9941F0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000001E77D9C20D0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001E77D993F70>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000001E77D994190>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x000001E77D994250>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
          │                            │    │    │     │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000001E77D9C20D0>
          │                            │    │    │     │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001E77D993F70>
          │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │                            │    │    └ <starlette.requests.Request object at 0x000001E77D9E2130>
          │                            │    └ <fastapi.routing.APIRouter object at 0x000001E77D8E6850>
          │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000001E77D994190>
          └ <function wrap_app_handling_exceptions at 0x000001E74DB9A160>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001E77D9FCB80>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001E77D993F70>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          └ <fastapi.routing.APIRouter object at 0x000001E77D8E6850>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001E77D9FCB80>
          │    │                │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001E77D993F70>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0x000001E77D8E6850>>
          └ <fastapi.routing.APIRouter object at 0x000001E77D8E6850>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 734, in app
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001E77D9FCB80>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001E77D993F70>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │     └ <function Route.handle at 0x000001E74DBB9820>
          └ APIRoute(path='/data/index', name='get_history_data', methods=['GET'])

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001E77D9FCB80>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001E77D993F70>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <function request_response.<locals>.app at 0x000001E77D9759D0>
          └ APIRoute(path='/data/index', name='get_history_data', methods=['GET'])

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
          │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001E77D9FCB80>
          │                            │    │        │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001E77D993F70>
          │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │                            │    └ <starlette.requests.Request object at 0x000001E77D9E28B0>
          │                            └ <function request_response.<locals>.app.<locals>.app at 0x000001E77D9FCC10>
          └ <function wrap_app_handling_exceptions at 0x000001E74DB9A160>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001E77D9FCCA0>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001E77D993F70>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          └ <function request_response.<locals>.app.<locals>.app at 0x000001E77D9FCC10>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
                     │ └ <starlette.requests.Request object at 0x000001E77D9E28B0>
                     └ <function get_request_handler.<locals>.app at 0x000001E77D975C10>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x000001E74DBBF430>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'source': 'tushare', 'market': 'SH', 'code': '000001', 'start_date': '20050501', 'end_date': '20050520'}
                 │         └ <function get_history_data at 0x000001E77D975040>
                 └ Dependant(path_params=[], query_params=[ModelField(field_info=Query(akshare), name='source', mode='validation'), ModelField(f...

  File "C:\proj\ELSE\SELF\py-fastapi-demo\app\routers\router.py", line 15, in get_history_data
    df = data_service.get_stock_history(source=source, code=code, market=market, start_date=start_date, end_date=end_date)
         │            │                        │            │            │                  │                    └ '20050520'
         │            │                        │            │            │                  └ '20050501'
         │            │                        │            │            └ 'SH'
         │            │                        │            └ '000001'
         │            │                        └ 'tushare'
         │            └ <function get_stock_history at 0x000001E74DCD1670>
         └ <module 'app.services.data_service' from 'C:\\proj\\ELSE\\SELF\\py-fastapi-demo\\app\\services\\data_service.py'>

> File "C:\proj\ELSE\SELF\py-fastapi-demo\app\services\data_service.py", line 23, in get_stock_history
    df = data_provider.get_stock_history(source=source, code=code, market=market, start_date=start_date, end_date=end_date)
         │             │                        │            │            │                  │                    └ '20050520'
         │             │                        │            │            │                  └ '20050501'
         │             │                        │            │            └ 'SH'
         │             │                        │            └ '000001'
         │             │                        └ 'tushare'
         │             └ <function TushareProvider.get_stock_history at 0x000001E75E78DAF0>
         └ <data_providers.tushare.TushareProvider object at 0x000001E77DA03160>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\data_providers\tushare.py", line 27, in get_stock_history
    raise RuntimeError(f"从 tushare 获取股票 {code} 数据失败: {str(e)}") from e

RuntimeError: 从 tushare 获取股票 000001 数据失败: 从 tushare 获取股票 000001 的数据为空
2025-07-02 15:44:00.457 | INFO     | app.services.data_service:get_stock_history:20 - [Bridge]获取股票历史行情数据并标准化输出格式 for 000001.SH from yfinance
2025-07-02 15:44:08.495 | ERROR    | app.services.data_service:get_stock_history:74 - Error fetching stock history data
Traceback (most recent call last):

  File "C:\proj\ELSE\SELF\py-fastapi-demo\data_providers\yfinance.py", line 22, in get_stock_history
    raise ValueError(f"从 yfinance 获取股票 {code} 的数据为空")

ValueError: 从 yfinance 获取股票 000001 的数据为空


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "C:\else_env\Python39\lib\multiprocessing\spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 336
               │     └ 3
               └ <function _main at 0x000001E74A9C6AF0>

  File "C:\else_env\Python39\lib\multiprocessing\spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 336
           │    └ <function BaseProcess._bootstrap at 0x000001E74A6445E0>
           └ <SpawnProcess name='SpawnProcess-5' parent=58752 started>

  File "C:\else_env\Python39\lib\multiprocessing\process.py", line 315, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x000001E74A646C10>
    └ <SpawnProcess name='SpawnProcess-5' parent=58752 started>

  File "C:\else_env\Python39\lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x000001E749F9B3D0>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-5' parent=58752 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-5' parent=58752 started>
    │    └ <function subprocess_started at 0x000001E74CB62040>
    └ <SpawnProcess name='SpawnProcess-5' parent=58752 started>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\uvicorn\_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=880, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('127.0.0.1', 8002)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x000001E749F16CD0>>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\uvicorn\server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=880, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('127.0.0.1', 8002)>]
           │       │   │    └ <function Server.serve at 0x000001E74CB27040>
           │       │   └ <uvicorn.server.Server object at 0x000001E749F16CD0>
           │       └ <function run at 0x000001E74A9C0820>
           └ <module 'asyncio' from 'C:\\else_env\\Python39\\lib\\asyncio\\__init__.py'>

  File "C:\else_env\Python39\lib\asyncio\runners.py", line 44, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x000001E74CB1DA40>
           │    └ <function BaseEventLoop.run_until_complete at 0x000001E74C35E670>
           └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 629, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x000001E74C35E5E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 596, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x000001E74C361160>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 1890, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x000001E74C2F0DC0>
    └ <Handle <TaskStepMethWrapper object at 0x000001E77D9E2430>()>

  File "C:\else_env\Python39\lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x000001E77D9E2430>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x000001E77D9E2430>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x000001E77D9E2430>()>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\base.py", line 141, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000001E77D9FCB80>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001E77D993F70>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x000001E77D994250>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x000001E77D9941F0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000001E77D9FCB80>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001E77D993F70>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000001E77D994190>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x000001E77D994250>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
          │                            │    │    │     │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000001E77D9FCB80>
          │                            │    │    │     │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001E77D993F70>
          │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │                            │    │    └ <starlette.requests.Request object at 0x000001E77D9E2A30>
          │                            │    └ <fastapi.routing.APIRouter object at 0x000001E77D8E6850>
          │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000001E77D994190>
          └ <function wrap_app_handling_exceptions at 0x000001E74DB9A160>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001E77D9C20D0>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001E77D993F70>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          └ <fastapi.routing.APIRouter object at 0x000001E77D8E6850>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001E77D9C20D0>
          │    │                │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001E77D993F70>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0x000001E77D8E6850>>
          └ <fastapi.routing.APIRouter object at 0x000001E77D8E6850>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 734, in app
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001E77D9C20D0>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001E77D993F70>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │     └ <function Route.handle at 0x000001E74DBB9820>
          └ APIRoute(path='/data/index', name='get_history_data', methods=['GET'])

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001E77D9C20D0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001E77D993F70>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <function request_response.<locals>.app at 0x000001E77D9759D0>
          └ APIRoute(path='/data/index', name='get_history_data', methods=['GET'])

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
          │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001E77D9C20D0>
          │                            │    │        │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001E77D993F70>
          │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │                            │    └ <starlette.requests.Request object at 0x000001E77DA03FD0>
          │                            └ <function request_response.<locals>.app.<locals>.app at 0x000001E77D9C2670>
          └ <function wrap_app_handling_exceptions at 0x000001E74DB9A160>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001E77DA05D30>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001E77D993F70>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          └ <function request_response.<locals>.app.<locals>.app at 0x000001E77D9C2670>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
                     │ └ <starlette.requests.Request object at 0x000001E77DA03FD0>
                     └ <function get_request_handler.<locals>.app at 0x000001E77D975C10>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x000001E74DBBF430>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'source': 'yfinance', 'market': 'SH', 'code': '000001', 'start_date': '20050501', 'end_date': '20050520'}
                 │         └ <function get_history_data at 0x000001E77D975040>
                 └ Dependant(path_params=[], query_params=[ModelField(field_info=Query(akshare), name='source', mode='validation'), ModelField(f...

  File "C:\proj\ELSE\SELF\py-fastapi-demo\app\routers\router.py", line 15, in get_history_data
    df = data_service.get_stock_history(source=source, code=code, market=market, start_date=start_date, end_date=end_date)
         │            │                        │            │            │                  │                    └ '20050520'
         │            │                        │            │            │                  └ '20050501'
         │            │                        │            │            └ 'SH'
         │            │                        │            └ '000001'
         │            │                        └ 'yfinance'
         │            └ <function get_stock_history at 0x000001E74DCD1670>
         └ <module 'app.services.data_service' from 'C:\\proj\\ELSE\\SELF\\py-fastapi-demo\\app\\services\\data_service.py'>

> File "C:\proj\ELSE\SELF\py-fastapi-demo\app\services\data_service.py", line 23, in get_stock_history
    df = data_provider.get_stock_history(source=source, code=code, market=market, start_date=start_date, end_date=end_date)
         │             │                        │            │            │                  │                    └ '20050520'
         │             │                        │            │            │                  └ '20050501'
         │             │                        │            │            └ 'SH'
         │             │                        │            └ '000001'
         │             │                        └ 'yfinance'
         │             └ <function YFinanceProvider.get_stock_history at 0x000001E77D7AFB80>
         └ <data_providers.yfinance.YFinanceProvider object at 0x000001E77DA03DF0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\data_providers\yfinance.py", line 27, in get_stock_history
    raise RuntimeError(f"从 yfinance 获取股票 {code} 数据失败: {str(e)}") from e

RuntimeError: 从 yfinance 获取股票 000001 数据失败: 从 yfinance 获取股票 000001 的数据为空
2025-07-02 15:45:25.521 | INFO     | app.services.data_service:get_stock_history:20 - [Bridge]获取股票历史行情数据并标准化输出格式 for 000001.SH from qstock
2025-07-02 15:45:25.644 | ERROR    | app.services.data_service:get_stock_history:74 - Error fetching stock history data
Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "C:\else_env\Python39\lib\multiprocessing\spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 336
               │     └ 3
               └ <function _main at 0x000001E74A9C6AF0>

  File "C:\else_env\Python39\lib\multiprocessing\spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 336
           │    └ <function BaseProcess._bootstrap at 0x000001E74A6445E0>
           └ <SpawnProcess name='SpawnProcess-5' parent=58752 started>

  File "C:\else_env\Python39\lib\multiprocessing\process.py", line 315, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x000001E74A646C10>
    └ <SpawnProcess name='SpawnProcess-5' parent=58752 started>

  File "C:\else_env\Python39\lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x000001E749F9B3D0>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-5' parent=58752 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-5' parent=58752 started>
    │    └ <function subprocess_started at 0x000001E74CB62040>
    └ <SpawnProcess name='SpawnProcess-5' parent=58752 started>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\uvicorn\_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=880, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('127.0.0.1', 8002)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x000001E749F16CD0>>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\uvicorn\server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=880, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('127.0.0.1', 8002)>]
           │       │   │    └ <function Server.serve at 0x000001E74CB27040>
           │       │   └ <uvicorn.server.Server object at 0x000001E749F16CD0>
           │       └ <function run at 0x000001E74A9C0820>
           └ <module 'asyncio' from 'C:\\else_env\\Python39\\lib\\asyncio\\__init__.py'>

  File "C:\else_env\Python39\lib\asyncio\runners.py", line 44, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x000001E74CB1DA40>
           │    └ <function BaseEventLoop.run_until_complete at 0x000001E74C35E670>
           └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 629, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x000001E74C35E5E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 596, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x000001E74C361160>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 1890, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x000001E74C2F0DC0>
    └ <Handle <TaskStepMethWrapper object at 0x000001E77DA2D730>()>

  File "C:\else_env\Python39\lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x000001E77DA2D730>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x000001E77DA2D730>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x000001E77DA2D730>()>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\base.py", line 141, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000001E77D9C20D0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001E77D9C2940>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x000001E77D994250>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x000001E77D9941F0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000001E77D9C20D0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001E77D9C2940>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000001E77D994190>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x000001E77D994250>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
          │                            │    │    │     │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000001E77D9C20D0>
          │                            │    │    │     │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001E77D9C2940>
          │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │                            │    │    └ <starlette.requests.Request object at 0x000001E77DA2DE80>
          │                            │    └ <fastapi.routing.APIRouter object at 0x000001E77D8E6850>
          │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000001E77D994190>
          └ <function wrap_app_handling_exceptions at 0x000001E74DB9A160>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001E77D9FCB80>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001E77D9C2940>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          └ <fastapi.routing.APIRouter object at 0x000001E77D8E6850>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001E77D9FCB80>
          │    │                │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001E77D9C2940>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0x000001E77D8E6850>>
          └ <fastapi.routing.APIRouter object at 0x000001E77D8E6850>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 734, in app
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001E77D9FCB80>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001E77D9C2940>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │     └ <function Route.handle at 0x000001E74DBB9820>
          └ APIRoute(path='/data/index', name='get_history_data', methods=['GET'])

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001E77D9FCB80>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001E77D9C2940>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <function request_response.<locals>.app at 0x000001E77D9759D0>
          └ APIRoute(path='/data/index', name='get_history_data', methods=['GET'])

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
          │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001E77D9FCB80>
          │                            │    │        │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001E77D9C2940>
          │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │                            │    └ <starlette.requests.Request object at 0x000001E77DA2D5E0>
          │                            └ <function request_response.<locals>.app.<locals>.app at 0x000001E77D9FCC10>
          └ <function wrap_app_handling_exceptions at 0x000001E74DB9A160>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001E77DBC41F0>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001E77D9C2940>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          └ <function request_response.<locals>.app.<locals>.app at 0x000001E77D9FCC10>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
                     │ └ <starlette.requests.Request object at 0x000001E77DA2D5E0>
                     └ <function get_request_handler.<locals>.app at 0x000001E77D975C10>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x000001E74DBBF430>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'source': 'qstock', 'market': 'SH', 'code': '000001', 'start_date': '20050501', 'end_date': '20050520'}
                 │         └ <function get_history_data at 0x000001E77D975040>
                 └ Dependant(path_params=[], query_params=[ModelField(field_info=Query(akshare), name='source', mode='validation'), ModelField(f...

  File "C:\proj\ELSE\SELF\py-fastapi-demo\app\routers\router.py", line 15, in get_history_data
    df = data_service.get_stock_history(source=source, code=code, market=market, start_date=start_date, end_date=end_date)
         │            │                        │            │            │                  │                    └ '20050520'
         │            │                        │            │            │                  └ '20050501'
         │            │                        │            │            └ 'SH'
         │            │                        │            └ '000001'
         │            │                        └ 'qstock'
         │            └ <function get_stock_history at 0x000001E74DCD1670>
         └ <module 'app.services.data_service' from 'C:\\proj\\ELSE\\SELF\\py-fastapi-demo\\app\\services\\data_service.py'>

> File "C:\proj\ELSE\SELF\py-fastapi-demo\app\services\data_service.py", line 69, in get_stock_history
    raise KeyError(f"数据源 {source} 返回的数据缺少字段: {', '.join(missing_cols)}")

KeyError: '数据源 qstock 返回的数据缺少字段: date'
2025-07-02 15:48:22.176 | INFO     | app.services.data_service:get_stock_history:20 - [Bridge]获取股票历史行情数据并标准化输出格式 for 000001.SH from akshare
2025-07-02 15:50:32.970 | INFO     | app.services.data_service:get_stock_history:20 - [Bridge]获取股票历史行情数据并标准化输出格式 for 000001.SH from tushare
2025-07-02 15:50:33.167 | ERROR    | app.services.data_service:get_stock_history:74 - Error fetching stock history data
Traceback (most recent call last):

  File "C:\proj\ELSE\SELF\py-fastapi-demo\data_providers\tushare.py", line 24, in get_stock_history
    raise ValueError(f"从 tushare 获取股票 {code} 的数据为空")

ValueError: 从 tushare 获取股票 000001 的数据为空


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "C:\else_env\Python39\lib\multiprocessing\spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 328
               │     └ 3
               └ <function _main at 0x0000021929266AF0>

  File "C:\else_env\Python39\lib\multiprocessing\spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 328
           │    └ <function BaseProcess._bootstrap at 0x0000021928EE45E0>
           └ <SpawnProcess name='SpawnProcess-6' parent=58752 started>

  File "C:\else_env\Python39\lib\multiprocessing\process.py", line 315, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x0000021928EE6C10>
    └ <SpawnProcess name='SpawnProcess-6' parent=58752 started>

  File "C:\else_env\Python39\lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x000002192883B3D0>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-6' parent=58752 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-6' parent=58752 started>
    │    └ <function subprocess_started at 0x000002192B400040>
    └ <SpawnProcess name='SpawnProcess-6' parent=58752 started>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\uvicorn\_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=628, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('127.0.0.1', 8002)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x00000219287B6CD0>>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\uvicorn\server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=628, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('127.0.0.1', 8002)>]
           │       │   │    └ <function Server.serve at 0x000002192B3C7040>
           │       │   └ <uvicorn.server.Server object at 0x00000219287B6CD0>
           │       └ <function run at 0x0000021929260820>
           └ <module 'asyncio' from 'C:\\else_env\\Python39\\lib\\asyncio\\__init__.py'>

  File "C:\else_env\Python39\lib\asyncio\runners.py", line 44, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x000002192B3BDA40>
           │    └ <function BaseEventLoop.run_until_complete at 0x000002192AC0E670>
           └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 629, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x000002192AC0E5E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 596, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x000002192AC11160>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 1890, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x000002192AB90DC0>
    └ <Handle <TaskStepMethWrapper object at 0x000002195C2830A0>()>

  File "C:\else_env\Python39\lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x000002195C2830A0>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x000002195C2830A0>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x000002195C2830A0>()>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\base.py", line 141, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000002195C2630D0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002195C263940>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x000002195C2344C0>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x000002195C234460>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000002195C2630D0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002195C263940>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000002195C234400>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x000002195C2344C0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
          │                            │    │    │     │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000002195C2630D0>
          │                            │    │    │     │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002195C263940>
          │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │                            │    │    └ <starlette.requests.Request object at 0x000002195C2832B0>
          │                            │    └ <fastapi.routing.APIRouter object at 0x000002195C184430>
          │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000002195C234400>
          └ <function wrap_app_handling_exceptions at 0x000002192C43A160>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000002195C2A5D30>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002195C263940>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          └ <fastapi.routing.APIRouter object at 0x000002195C184430>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000002195C2A5D30>
          │    │                │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002195C263940>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0x000002195C184430>>
          └ <fastapi.routing.APIRouter object at 0x000002195C184430>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 734, in app
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000002195C2A5D30>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002195C263940>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │     └ <function Route.handle at 0x000002192C459820>
          └ APIRoute(path='/data/index', name='get_history_data', methods=['GET'])

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000002195C2A5D30>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002195C263940>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <function request_response.<locals>.app at 0x000002195C2169D0>
          └ APIRoute(path='/data/index', name='get_history_data', methods=['GET'])

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
          │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000002195C2A5D30>
          │                            │    │        │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002195C263940>
          │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │                            │    └ <starlette.requests.Request object at 0x000002195C283BE0>
          │                            └ <function request_response.<locals>.app.<locals>.app at 0x000002195C2A5CA0>
          └ <function wrap_app_handling_exceptions at 0x000002192C43A160>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000002195C2A5C10>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002195C263940>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          └ <function request_response.<locals>.app.<locals>.app at 0x000002195C2A5CA0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
                     │ └ <starlette.requests.Request object at 0x000002195C283BE0>
                     └ <function get_request_handler.<locals>.app at 0x000002195C216C10>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x000002192C45F430>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'source': 'tushare', 'market': 'SH', 'code': '000001', 'start_date': '20050501', 'end_date': '20050520'}
                 │         └ <function get_history_data at 0x000002195C216040>
                 └ Dependant(path_params=[], query_params=[ModelField(field_info=Query(akshare), name='source', mode='validation'), ModelField(f...

  File "C:\proj\ELSE\SELF\py-fastapi-demo\app\routers\router.py", line 15, in get_history_data
    df = data_service.get_stock_history(source=source, code=code, market=market, start_date=start_date, end_date=end_date)
         │            │                        │            │            │                  │                    └ '20050520'
         │            │                        │            │            │                  └ '20050501'
         │            │                        │            │            └ 'SH'
         │            │                        │            └ '000001'
         │            │                        └ 'tushare'
         │            └ <function get_stock_history at 0x000002192C571670>
         └ <module 'app.services.data_service' from 'C:\\proj\\ELSE\\SELF\\py-fastapi-demo\\app\\services\\data_service.py'>

> File "C:\proj\ELSE\SELF\py-fastapi-demo\app\services\data_service.py", line 23, in get_stock_history
    df = data_provider.get_stock_history(source=source, code=code, market=market, start_date=start_date, end_date=end_date)
         │             │                        │            │            │                  │                    └ '20050520'
         │             │                        │            │            │                  └ '20050501'
         │             │                        │            │            └ 'SH'
         │             │                        │            └ '000001'
         │             │                        └ 'tushare'
         │             └ <function TushareProvider.get_stock_history at 0x000002193D02CAF0>
         └ <data_providers.tushare.TushareProvider object at 0x000002195C283820>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\data_providers\tushare.py", line 27, in get_stock_history
    raise RuntimeError(f"从 tushare 获取股票 {code} 数据失败: {str(e)}") from e

RuntimeError: 从 tushare 获取股票 000001 数据失败: 从 tushare 获取股票 000001 的数据为空
2025-07-02 15:51:30.893 | INFO     | app.services.data_service:get_stock_history:20 - [Bridge]获取股票历史行情数据并标准化输出格式 for 000001.SH from tushare
2025-07-02 15:51:31.008 | ERROR    | app.services.data_service:get_stock_history:74 - Error fetching stock history data
Traceback (most recent call last):

  File "C:\proj\ELSE\SELF\py-fastapi-demo\data_providers\tushare.py", line 25, in get_stock_history
    raise ValueError(f"从 tushare 获取股票 {code} 的数据为空")

ValueError: 从 tushare 获取股票 000001 的数据为空


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "C:\else_env\Python39\lib\multiprocessing\spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 332
               │     └ 3
               └ <function _main at 0x0000020309D96AF0>

  File "C:\else_env\Python39\lib\multiprocessing\spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 332
           │    └ <function BaseProcess._bootstrap at 0x0000020309A4B5E0>
           └ <SpawnProcess name='SpawnProcess-7' parent=58752 started>

  File "C:\else_env\Python39\lib\multiprocessing\process.py", line 315, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x0000020309A46C10>
    └ <SpawnProcess name='SpawnProcess-7' parent=58752 started>

  File "C:\else_env\Python39\lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x000002030979B3D0>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-7' parent=58752 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-7' parent=58752 started>
    │    └ <function subprocess_started at 0x000002030BF1F040>
    └ <SpawnProcess name='SpawnProcess-7' parent=58752 started>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\uvicorn\_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=804, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('127.0.0.1', 8002)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x00000203092E6CD0>>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\uvicorn\server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=804, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('127.0.0.1', 8002)>]
           │       │   │    └ <function Server.serve at 0x000002030BEE7040>
           │       │   └ <uvicorn.server.Server object at 0x00000203092E6CD0>
           │       └ <function run at 0x0000020309D8D820>
           └ <module 'asyncio' from 'C:\\else_env\\Python39\\lib\\asyncio\\__init__.py'>

  File "C:\else_env\Python39\lib\asyncio\runners.py", line 44, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x000002030BEDDA40>
           │    └ <function BaseEventLoop.run_until_complete at 0x000002030B71E670>
           └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 629, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x000002030B71E5E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 596, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x000002030B721160>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 1890, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x000002030B6B0DC0>
    └ <Handle <TaskStepMethWrapper object at 0x000002033CD92EE0>()>

  File "C:\else_env\Python39\lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x000002033CD92EE0>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x000002033CD92EE0>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x000002033CD92EE0>()>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\base.py", line 141, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000002033CD930D0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002033CD63F70>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x000002033CD64340>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x000002033CD642E0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000002033CD930D0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002033CD63F70>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000002033CD64280>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x000002033CD64340>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
          │                            │    │    │     │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000002033CD930D0>
          │                            │    │    │     │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002033CD63F70>
          │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │                            │    │    └ <starlette.requests.Request object at 0x000002033CDBA940>
          │                            │    └ <fastapi.routing.APIRouter object at 0x000002033CCB7400>
          │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000002033CD64280>
          └ <function wrap_app_handling_exceptions at 0x000002030CF5A160>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000002033CDCDB80>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002033CD63F70>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          └ <fastapi.routing.APIRouter object at 0x000002033CCB7400>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000002033CDCDB80>
          │    │                │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002033CD63F70>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0x000002033CCB7400>>
          └ <fastapi.routing.APIRouter object at 0x000002033CCB7400>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 734, in app
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000002033CDCDB80>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002033CD63F70>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │     └ <function Route.handle at 0x000002030CF79820>
          └ APIRoute(path='/data/index', name='get_history_data', methods=['GET'])

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000002033CDCDB80>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002033CD63F70>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <function request_response.<locals>.app at 0x000002033CD469D0>
          └ APIRoute(path='/data/index', name='get_history_data', methods=['GET'])

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
          │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000002033CDCDB80>
          │                            │    │        │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002033CD63F70>
          │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │                            │    └ <starlette.requests.Request object at 0x000002033CDBA6A0>
          │                            └ <function request_response.<locals>.app.<locals>.app at 0x000002033CDCDC10>
          └ <function wrap_app_handling_exceptions at 0x000002030CF5A160>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000002033CDCDCA0>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002033CD63F70>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          └ <function request_response.<locals>.app.<locals>.app at 0x000002033CDCDC10>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
                     │ └ <starlette.requests.Request object at 0x000002033CDBA6A0>
                     └ <function get_request_handler.<locals>.app at 0x000002033CD46C10>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x000002030CF7F430>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'source': 'tushare', 'market': 'SH', 'code': '000001', 'start_date': '20050501', 'end_date': '20050520'}
                 │         └ <function get_history_data at 0x000002033CD46040>
                 └ Dependant(path_params=[], query_params=[ModelField(field_info=Query(akshare), name='source', mode='validation'), ModelField(f...

  File "C:\proj\ELSE\SELF\py-fastapi-demo\app\routers\router.py", line 15, in get_history_data
    df = data_service.get_stock_history(source=source, code=code, market=market, start_date=start_date, end_date=end_date)
         │            │                        │            │            │                  │                    └ '20050520'
         │            │                        │            │            │                  └ '20050501'
         │            │                        │            │            └ 'SH'
         │            │                        │            └ '000001'
         │            │                        └ 'tushare'
         │            └ <function get_stock_history at 0x000002030D091670>
         └ <module 'app.services.data_service' from 'C:\\proj\\ELSE\\SELF\\py-fastapi-demo\\app\\services\\data_service.py'>

> File "C:\proj\ELSE\SELF\py-fastapi-demo\app\services\data_service.py", line 23, in get_stock_history
    df = data_provider.get_stock_history(source=source, code=code, market=market, start_date=start_date, end_date=end_date)
         │             │                        │            │            │                  │                    └ '20050520'
         │             │                        │            │            │                  └ '20050501'
         │             │                        │            │            └ 'SH'
         │             │                        │            └ '000001'
         │             │                        └ 'tushare'
         │             └ <function TushareProvider.get_stock_history at 0x000002031DB4BAF0>
         └ <data_providers.tushare.TushareProvider object at 0x000002033CDB2250>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\data_providers\tushare.py", line 28, in get_stock_history
    raise RuntimeError(f"从 tushare 获取股票 {code} 数据失败: {str(e)}") from e

RuntimeError: 从 tushare 获取股票 000001 数据失败: 从 tushare 获取股票 000001 的数据为空
2025-07-02 15:57:09.194 | INFO     | app.services.data_service:get_stock_history:20 - [Bridge]获取股票历史行情数据并标准化输出格式 for 000001.SH from tushare
2025-07-02 15:57:09.324 | ERROR    | app.services.data_service:get_stock_history:74 - Error fetching stock history data
Traceback (most recent call last):

  File "C:\proj\ELSE\SELF\py-fastapi-demo\data_providers\tushare.py", line 25, in get_stock_history
    raise ValueError(f"从 tushare 获取股票 {code} 的数据为空")

ValueError: 从 tushare 获取股票 000001 的数据为空


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "C:\else_env\Python39\lib\multiprocessing\spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 332
               │     └ 3
               └ <function _main at 0x0000020309D96AF0>

  File "C:\else_env\Python39\lib\multiprocessing\spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 332
           │    └ <function BaseProcess._bootstrap at 0x0000020309A4B5E0>
           └ <SpawnProcess name='SpawnProcess-7' parent=58752 started>

  File "C:\else_env\Python39\lib\multiprocessing\process.py", line 315, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x0000020309A46C10>
    └ <SpawnProcess name='SpawnProcess-7' parent=58752 started>

  File "C:\else_env\Python39\lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x000002030979B3D0>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-7' parent=58752 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-7' parent=58752 started>
    │    └ <function subprocess_started at 0x000002030BF1F040>
    └ <SpawnProcess name='SpawnProcess-7' parent=58752 started>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\uvicorn\_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=804, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('127.0.0.1', 8002)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x00000203092E6CD0>>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\uvicorn\server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=804, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('127.0.0.1', 8002)>]
           │       │   │    └ <function Server.serve at 0x000002030BEE7040>
           │       │   └ <uvicorn.server.Server object at 0x00000203092E6CD0>
           │       └ <function run at 0x0000020309D8D820>
           └ <module 'asyncio' from 'C:\\else_env\\Python39\\lib\\asyncio\\__init__.py'>

  File "C:\else_env\Python39\lib\asyncio\runners.py", line 44, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x000002030BEDDA40>
           │    └ <function BaseEventLoop.run_until_complete at 0x000002030B71E670>
           └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 629, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x000002030B71E5E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 596, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x000002030B721160>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 1890, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x000002030B6B0DC0>
    └ <Handle <TaskStepMethWrapper object at 0x000002033CDBA550>()>

  File "C:\else_env\Python39\lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x000002033CDBA550>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x000002033CDBA550>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x000002033CDBA550>()>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\base.py", line 141, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000002033CDCDC10>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002033CDCDB80>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x000002033CD64340>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x000002033CD642E0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000002033CDCDC10>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002033CDCDB80>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000002033CD64280>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x000002033CD64340>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
          │                            │    │    │     │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000002033CDCDC10>
          │                            │    │    │     │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002033CDCDB80>
          │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │                            │    │    └ <starlette.requests.Request object at 0x000002033CDB2FA0>
          │                            │    └ <fastapi.routing.APIRouter object at 0x000002033CCB7400>
          │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000002033CD64280>
          └ <function wrap_app_handling_exceptions at 0x000002030CF5A160>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000002033CD93670>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002033CDCDB80>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          └ <fastapi.routing.APIRouter object at 0x000002033CCB7400>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000002033CD93670>
          │    │                │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002033CDCDB80>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0x000002033CCB7400>>
          └ <fastapi.routing.APIRouter object at 0x000002033CCB7400>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 734, in app
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000002033CD93670>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002033CDCDB80>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │     └ <function Route.handle at 0x000002030CF79820>
          └ APIRoute(path='/data/index', name='get_history_data', methods=['GET'])

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000002033CD93670>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002033CDCDB80>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <function request_response.<locals>.app at 0x000002033CD469D0>
          └ APIRoute(path='/data/index', name='get_history_data', methods=['GET'])

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
          │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000002033CD93670>
          │                            │    │        │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002033CDCDB80>
          │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │                            │    └ <starlette.requests.Request object at 0x000002033CDB22B0>
          │                            └ <function request_response.<locals>.app.<locals>.app at 0x000002031D515A60>
          └ <function wrap_app_handling_exceptions at 0x000002030CF5A160>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000002033CDE09D0>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002033CDCDB80>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          └ <function request_response.<locals>.app.<locals>.app at 0x000002031D515A60>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
                     │ └ <starlette.requests.Request object at 0x000002033CDB22B0>
                     └ <function get_request_handler.<locals>.app at 0x000002033CD46C10>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x000002030CF7F430>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'source': 'tushare', 'market': 'SH', 'code': '000001', 'start_date': '20050501', 'end_date': '20050520'}
                 │         └ <function get_history_data at 0x000002033CD46040>
                 └ Dependant(path_params=[], query_params=[ModelField(field_info=Query(akshare), name='source', mode='validation'), ModelField(f...

  File "C:\proj\ELSE\SELF\py-fastapi-demo\app\routers\router.py", line 15, in get_history_data
    df = data_service.get_stock_history(source=source, code=code, market=market, start_date=start_date, end_date=end_date)
         │            │                        │            │            │                  │                    └ '20050520'
         │            │                        │            │            │                  └ '20050501'
         │            │                        │            │            └ 'SH'
         │            │                        │            └ '000001'
         │            │                        └ 'tushare'
         │            └ <function get_stock_history at 0x000002030D091670>
         └ <module 'app.services.data_service' from 'C:\\proj\\ELSE\\SELF\\py-fastapi-demo\\app\\services\\data_service.py'>

> File "C:\proj\ELSE\SELF\py-fastapi-demo\app\services\data_service.py", line 23, in get_stock_history
    df = data_provider.get_stock_history(source=source, code=code, market=market, start_date=start_date, end_date=end_date)
         │             │                        │            │            │                  │                    └ '20050520'
         │             │                        │            │            │                  └ '20050501'
         │             │                        │            │            └ 'SH'
         │             │                        │            └ '000001'
         │             │                        └ 'tushare'
         │             └ <function TushareProvider.get_stock_history at 0x000002031DB4BAF0>
         └ <data_providers.tushare.TushareProvider object at 0x000002033CDFC1F0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\data_providers\tushare.py", line 28, in get_stock_history
    raise RuntimeError(f"从 tushare 获取股票 {code} 数据失败: {str(e)}") from e

RuntimeError: 从 tushare 获取股票 000001 数据失败: 从 tushare 获取股票 000001 的数据为空
2025-07-02 15:59:07.689 | INFO     | app.services.data_service:get_stock_history:20 - [Bridge]获取股票历史行情数据并标准化输出格式 for 000001.SH from tushare
2025-07-02 15:59:07.803 | ERROR    | app.services.data_service:get_stock_history:74 - Error fetching stock history data
Traceback (most recent call last):

  File "C:\proj\ELSE\SELF\py-fastapi-demo\data_providers\tushare.py", line 26, in get_stock_history
    raise ValueError(f"从 tushare 获取股票 {code} 的数据为空")

ValueError: 从 tushare 获取股票 000001 的数据为空


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "C:\else_env\Python39\lib\multiprocessing\spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 328
               │     └ 3
               └ <function _main at 0x00000194DCDF7AF0>

  File "C:\else_env\Python39\lib\multiprocessing\spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 328
           │    └ <function BaseProcess._bootstrap at 0x00000194DCAA45E0>
           └ <SpawnProcess name='SpawnProcess-8' parent=58752 started>

  File "C:\else_env\Python39\lib\multiprocessing\process.py", line 315, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x00000194DCAA6C10>
    └ <SpawnProcess name='SpawnProcess-8' parent=58752 started>

  File "C:\else_env\Python39\lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x00000194DC7FB3D0>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-8' parent=58752 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-8' parent=58752 started>
    │    └ <function subprocess_started at 0x00000194DEF7F040>
    └ <SpawnProcess name='SpawnProcess-8' parent=58752 started>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\uvicorn\_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=364, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('127.0.0.1', 8002)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x00000194DC346CD0>>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\uvicorn\server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=364, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('127.0.0.1', 8002)>]
           │       │   │    └ <function Server.serve at 0x00000194DEF47040>
           │       │   └ <uvicorn.server.Server object at 0x00000194DC346CD0>
           │       └ <function run at 0x00000194DCDF3820>
           └ <module 'asyncio' from 'C:\\else_env\\Python39\\lib\\asyncio\\__init__.py'>

  File "C:\else_env\Python39\lib\asyncio\runners.py", line 44, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x00000194DEF3DA40>
           │    └ <function BaseEventLoop.run_until_complete at 0x00000194DE77E670>
           └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 629, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x00000194DE77E5E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 596, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x00000194DE781160>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 1890, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x00000194DE710DC0>
    └ <Handle <TaskStepMethWrapper object at 0x000001948FEA7D00>()>

  File "C:\else_env\Python39\lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x000001948FEA7D00>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x000001948FEA7D00>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x000001948FEA7D00>()>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\base.py", line 141, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000001948FEA20D0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001948FE73F70>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x000001948FE74160>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x000001948FE74100>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000001948FEA20D0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001948FE73F70>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000001948FE740A0>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x000001948FE74160>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
          │                            │    │    │     │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000001948FEA20D0>
          │                            │    │    │     │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001948FE73F70>
          │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │                            │    │    └ <starlette.requests.Request object at 0x000001948FEC3D90>
          │                            │    └ <fastapi.routing.APIRouter object at 0x000001948FDC61C0>
          │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000001948FE740A0>
          └ <function wrap_app_handling_exceptions at 0x00000194DFFBA160>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001948FEDDB80>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001948FE73F70>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          └ <fastapi.routing.APIRouter object at 0x000001948FDC61C0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001948FEDDB80>
          │    │                │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001948FE73F70>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0x000001948FDC61C0>>
          └ <fastapi.routing.APIRouter object at 0x000001948FDC61C0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 734, in app
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001948FEDDB80>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001948FE73F70>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │     └ <function Route.handle at 0x00000194DFFD9820>
          └ APIRoute(path='/data/index', name='get_history_data', methods=['GET'])

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001948FEDDB80>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001948FE73F70>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <function request_response.<locals>.app at 0x000001948FE559D0>
          └ APIRoute(path='/data/index', name='get_history_data', methods=['GET'])

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
          │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001948FEDDB80>
          │                            │    │        │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001948FE73F70>
          │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │                            │    └ <starlette.requests.Request object at 0x000001948FEC3A90>
          │                            └ <function request_response.<locals>.app.<locals>.app at 0x000001948FEDDC10>
          └ <function wrap_app_handling_exceptions at 0x00000194DFFBA160>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001948FEDDCA0>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001948FE73F70>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          └ <function request_response.<locals>.app.<locals>.app at 0x000001948FEDDC10>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
                     │ └ <starlette.requests.Request object at 0x000001948FEC3A90>
                     └ <function get_request_handler.<locals>.app at 0x000001948FE55C10>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x00000194DFFDF430>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'source': 'tushare', 'market': 'SH', 'code': '000001', 'start_date': '20050501', 'end_date': '20050520'}
                 │         └ <function get_history_data at 0x000001948FE55040>
                 └ Dependant(path_params=[], query_params=[ModelField(field_info=Query(akshare), name='source', mode='validation'), ModelField(f...

  File "C:\proj\ELSE\SELF\py-fastapi-demo\app\routers\router.py", line 15, in get_history_data
    df = data_service.get_stock_history(source=source, code=code, market=market, start_date=start_date, end_date=end_date)
         │            │                        │            │            │                  │                    └ '20050520'
         │            │                        │            │            │                  └ '20050501'
         │            │                        │            │            └ 'SH'
         │            │                        │            └ '000001'
         │            │                        └ 'tushare'
         │            └ <function get_stock_history at 0x00000194E00F1670>
         └ <module 'app.services.data_service' from 'C:\\proj\\ELSE\\SELF\\py-fastapi-demo\\app\\services\\data_service.py'>

> File "C:\proj\ELSE\SELF\py-fastapi-demo\app\services\data_service.py", line 23, in get_stock_history
    df = data_provider.get_stock_history(source=source, code=code, market=market, start_date=start_date, end_date=end_date)
         │             │                        │            │            │                  │                    └ '20050520'
         │             │                        │            │            │                  └ '20050501'
         │             │                        │            │            └ 'SH'
         │             │                        │            └ '000001'
         │             │                        └ 'tushare'
         │             └ <function TushareProvider.get_stock_history at 0x00000194F0BACAF0>
         └ <data_providers.tushare.TushareProvider object at 0x000001948FEB2DC0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\data_providers\tushare.py", line 29, in get_stock_history
    raise RuntimeError(f"从 tushare 获取股票 {code} 数据失败: {str(e)}") from e

RuntimeError: 从 tushare 获取股票 000001 数据失败: 从 tushare 获取股票 000001 的数据为空
2025-07-02 16:02:53.852 | INFO     | app.services.data_service:get_stock_history:18 - [Bridge]获取股票历史行情数据并标准化输出格式 for 000001.SH from tushare
2025-07-02 16:05:12.592 | INFO     | app.services.data_service:get_stock_history:20 - [Bridge]获取股票历史行情数据并标准化输出格式 for 000001.SH from tushare
2025-07-02 16:05:12.598 | INFO     | data_providers.tushare:get_stock_history:23 - [Provider]source=tushare, code=000001, market=SH, start_date=20050501, end_date=20050520
2025-07-02 16:05:12.706 | INFO     | data_providers.tushare:get_stock_history:28 - [Provider]tushare 返回的数据列名: ['ts_code', 'trade_date', 'open', 'high', 'low', 'close', 'pre_close', 'change', 'pct_chg', 'vol', 'amount']
2025-07-02 16:05:12.707 | ERROR    | app.services.data_service:get_stock_history:74 - Error fetching stock history data
Traceback (most recent call last):

  File "C:\proj\ELSE\SELF\py-fastapi-demo\data_providers\tushare.py", line 30, in get_stock_history
    raise ValueError(f"从 tushare 获取股票 {code} 的数据为空")

ValueError: 从 tushare 获取股票 000001 的数据为空


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "C:\else_env\Python39\lib\multiprocessing\spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 332
               │     └ 3
               └ <function _main at 0x0000026E96477AF0>

  File "C:\else_env\Python39\lib\multiprocessing\spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 332
           │    └ <function BaseProcess._bootstrap at 0x0000026E961145E0>
           └ <SpawnProcess name='SpawnProcess-1' parent=6964 started>

  File "C:\else_env\Python39\lib\multiprocessing\process.py", line 315, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x0000026E96116C10>
    └ <SpawnProcess name='SpawnProcess-1' parent=6964 started>

  File "C:\else_env\Python39\lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x0000026E95A4B3D0>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=6964 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=6964 started>
    │    └ <function subprocess_started at 0x0000026E98611040>
    └ <SpawnProcess name='SpawnProcess-1' parent=6964 started>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\uvicorn\_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=564, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('127.0.0.1', 8002)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x0000026E959C6CD0>>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\uvicorn\server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=564, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('127.0.0.1', 8002)>]
           │       │   │    └ <function Server.serve at 0x0000026E985D7040>
           │       │   └ <uvicorn.server.Server object at 0x0000026E959C6CD0>
           │       └ <function run at 0x0000026E9646F820>
           └ <module 'asyncio' from 'C:\\else_env\\Python39\\lib\\asyncio\\__init__.py'>

  File "C:\else_env\Python39\lib\asyncio\runners.py", line 44, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x0000026E985CDA40>
           │    └ <function BaseEventLoop.run_until_complete at 0x0000026E97E1E670>
           └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 629, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x0000026E97E1E5E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 596, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x0000026E97E21160>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 1890, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x0000026E97DB0DC0>
    └ <Handle <TaskStepMethWrapper object at 0x0000026EC9479BB0>()>

  File "C:\else_env\Python39\lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x0000026EC9479BB0>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x0000026EC9479BB0>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x0000026EC9479BB0>()>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\base.py", line 141, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x0000026EC94720D0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000026EC9444F70>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x0000026EC943EF40>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x0000026EC943EFA0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x0000026EC94720D0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000026EC9444F70>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x0000026EC943EF10>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x0000026EC943EF40>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
          │                            │    │    │     │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x0000026EC94720D0>
          │                            │    │    │     │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000026EC9444F70>
          │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │                            │    │    └ <starlette.requests.Request object at 0x0000026EC949A4F0>
          │                            │    └ <fastapi.routing.APIRouter object at 0x0000026EC9239D90>
          │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x0000026EC943EF10>
          └ <function wrap_app_handling_exceptions at 0x0000026E9964A160>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000026EC94ACB80>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000026EC9444F70>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          └ <fastapi.routing.APIRouter object at 0x0000026EC9239D90>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000026EC94ACB80>
          │    │                │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000026EC9444F70>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0x0000026EC9239D90>>
          └ <fastapi.routing.APIRouter object at 0x0000026EC9239D90>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 734, in app
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000026EC94ACB80>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000026EC9444F70>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │     └ <function Route.handle at 0x0000026E99669820>
          └ APIRoute(path='/data/index', name='get_history_data', methods=['GET'])

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000026EC94ACB80>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000026EC9444F70>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <function request_response.<locals>.app at 0x0000026EC94249D0>
          └ APIRoute(path='/data/index', name='get_history_data', methods=['GET'])

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
          │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000026EC94ACB80>
          │                            │    │        │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000026EC9444F70>
          │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │                            │    └ <starlette.requests.Request object at 0x0000026EC949A340>
          │                            └ <function request_response.<locals>.app.<locals>.app at 0x0000026EC94ACC10>
          └ <function wrap_app_handling_exceptions at 0x0000026E9964A160>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000026EC94ACCA0>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000026EC9444F70>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          └ <function request_response.<locals>.app.<locals>.app at 0x0000026EC94ACC10>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
                     │ └ <starlette.requests.Request object at 0x0000026EC949A340>
                     └ <function get_request_handler.<locals>.app at 0x0000026EC9424C10>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x0000026E9966F430>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'source': 'tushare', 'market': 'SH', 'code': '000001', 'start_date': '20050501', 'end_date': '20050520'}
                 │         └ <function get_history_data at 0x0000026EC9424040>
                 └ Dependant(path_params=[], query_params=[ModelField(field_info=Query(akshare), name='source', mode='validation'), ModelField(f...

  File "C:\proj\ELSE\SELF\py-fastapi-demo\app\routers\router.py", line 15, in get_history_data
    df = data_service.get_stock_history(source=source, code=code, market=market, start_date=start_date, end_date=end_date)
         │            │                        │            │            │                  │                    └ '20050520'
         │            │                        │            │            │                  └ '20050501'
         │            │                        │            │            └ 'SH'
         │            │                        │            └ '000001'
         │            │                        └ 'tushare'
         │            └ <function get_stock_history at 0x0000026E99781670>
         └ <module 'app.services.data_service' from 'C:\\proj\\ELSE\\SELF\\py-fastapi-demo\\app\\services\\data_service.py'>

> File "C:\proj\ELSE\SELF\py-fastapi-demo\app\services\data_service.py", line 23, in get_stock_history
    df = data_provider.get_stock_history(source=source, code=code, market=market, start_date=start_date, end_date=end_date)
         │             │                        │            │            │                  │                    └ '20050520'
         │             │                        │            │            │                  └ '20050501'
         │             │                        │            │            └ 'SH'
         │             │                        │            └ '000001'
         │             │                        └ 'tushare'
         │             └ <function TushareProvider.get_stock_history at 0x0000026EAA23CA60>
         └ <data_providers.tushare.TushareProvider object at 0x0000026EC9484F70>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\data_providers\tushare.py", line 33, in get_stock_history
    raise RuntimeError(f"从 tushare 获取股票 {code} 数据失败: {str(e)}") from e

RuntimeError: 从 tushare 获取股票 000001 数据失败: 从 tushare 获取股票 000001 的数据为空
2025-07-02 16:06:09.089 | INFO     | app.services.data_service:get_stock_history:20 - [Bridge]获取股票历史行情数据并标准化输出格式 for 000001.SH from tushare
2025-07-02 16:06:09.097 | INFO     | data_providers.tushare:get_stock_history:23 - [Provider]source=tushare, code=000001, market=SH, start_date=20050501, end_date=20050520
2025-07-02 16:06:09.202 | INFO     | data_providers.tushare:get_stock_history:28 - [Provider]tushare 返回的数据列名: ['ts_code', 'trade_date', 'open', 'high', 'low', 'close', 'pre_close', 'change', 'pct_chg', 'vol', 'amount']
2025-07-02 16:06:09.203 | ERROR    | app.services.data_service:get_stock_history:74 - Error fetching stock history data
Traceback (most recent call last):

  File "C:\proj\ELSE\SELF\py-fastapi-demo\data_providers\tushare.py", line 30, in get_stock_history
    raise RuntimeError(f"从 tushare 获取股票 {code} 的数据为空")

RuntimeError: 从 tushare 获取股票 000001 的数据为空


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "C:\else_env\Python39\lib\multiprocessing\spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 352
               │     └ 3
               └ <function _main at 0x000001AD61CA6AF0>

  File "C:\else_env\Python39\lib\multiprocessing\spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 352
           │    └ <function BaseProcess._bootstrap at 0x000001AD6193B5E0>
           └ <SpawnProcess name='SpawnProcess-2' parent=6964 started>

  File "C:\else_env\Python39\lib\multiprocessing\process.py", line 315, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x000001AD61936C10>
    └ <SpawnProcess name='SpawnProcess-2' parent=6964 started>

  File "C:\else_env\Python39\lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x000001AD6127B3D0>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-2' parent=6964 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-2' parent=6964 started>
    │    └ <function subprocess_started at 0x000001AD63E40040>
    └ <SpawnProcess name='SpawnProcess-2' parent=6964 started>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\uvicorn\_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=748, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('127.0.0.1', 8002)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x000001AD611F6CD0>>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\uvicorn\server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=748, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('127.0.0.1', 8002)>]
           │       │   │    └ <function Server.serve at 0x000001AD63E07040>
           │       │   └ <uvicorn.server.Server object at 0x000001AD611F6CD0>
           │       └ <function run at 0x000001AD61C9F820>
           └ <module 'asyncio' from 'C:\\else_env\\Python39\\lib\\asyncio\\__init__.py'>

  File "C:\else_env\Python39\lib\asyncio\runners.py", line 44, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x000001AD63DFDA40>
           │    └ <function BaseEventLoop.run_until_complete at 0x000001AD6367E670>
           └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 629, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x000001AD6367E5E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 596, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x000001AD63681160>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 1890, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x000001AD635D0DC0>
    └ <Handle <TaskStepMethWrapper object at 0x000001AD1808E2B0>()>

  File "C:\else_env\Python39\lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x000001AD1808E2B0>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x000001AD1808E2B0>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x000001AD1808E2B0>()>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\base.py", line 141, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000001AD180840D0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001AD18054F70>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x000001AD180526D0>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x000001AD18052670>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000001AD180840D0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001AD18054F70>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000001AD18052610>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x000001AD180526D0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
          │                            │    │    │     │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000001AD180840D0>
          │                            │    │    │     │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001AD18054F70>
          │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │                            │    │    └ <starlette.requests.Request object at 0x000001AD180AA6D0>
          │                            │    └ <fastapi.routing.APIRouter object at 0x000001AD64F3BBB0>
          │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000001AD18052610>
          └ <function wrap_app_handling_exceptions at 0x000001AD64E7A160>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001AD180BDB80>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001AD18054F70>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          └ <fastapi.routing.APIRouter object at 0x000001AD64F3BBB0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001AD180BDB80>
          │    │                │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001AD18054F70>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0x000001AD64F3BBB0>>
          └ <fastapi.routing.APIRouter object at 0x000001AD64F3BBB0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 734, in app
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001AD180BDB80>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001AD18054F70>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │     └ <function Route.handle at 0x000001AD64E99820>
          └ APIRoute(path='/data/index', name='get_history_data', methods=['GET'])

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001AD180BDB80>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001AD18054F70>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │    └ <function request_response.<locals>.app at 0x000001AD180359D0>
          └ APIRoute(path='/data/index', name='get_history_data', methods=['GET'])

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
          │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001AD180BDB80>
          │                            │    │        │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001AD18054F70>
          │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          │                            │    └ <starlette.requests.Request object at 0x000001AD180AA250>
          │                            └ <function request_response.<locals>.app.<locals>.app at 0x000001AD180BDC10>
          └ <function wrap_app_handling_exceptions at 0x000001AD64E7A160>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001AD180BDCA0>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001AD18054F70>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          └ <function request_response.<locals>.app.<locals>.app at 0x000001AD180BDC10>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
                     │ └ <starlette.requests.Request object at 0x000001AD180AA250>
                     └ <function get_request_handler.<locals>.app at 0x000001AD18035C10>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x000001AD64E9F430>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'source': 'tushare', 'market': 'SH', 'code': '000001', 'start_date': '20050501', 'end_date': '20050520'}
                 │         └ <function get_history_data at 0x000001AD18035040>
                 └ Dependant(path_params=[], query_params=[ModelField(field_info=Query(akshare), name='source', mode='validation'), ModelField(f...

  File "C:\proj\ELSE\SELF\py-fastapi-demo\app\routers\router.py", line 15, in get_history_data
    df = data_service.get_stock_history(source=source, code=code, market=market, start_date=start_date, end_date=end_date)
         │            │                        │            │            │                  │                    └ '20050520'
         │            │                        │            │            │                  └ '20050501'
         │            │                        │            │            └ 'SH'
         │            │                        │            └ '000001'
         │            │                        └ 'tushare'
         │            └ <function get_stock_history at 0x000001AD64FB1670>
         └ <module 'app.services.data_service' from 'C:\\proj\\ELSE\\SELF\\py-fastapi-demo\\app\\services\\data_service.py'>

> File "C:\proj\ELSE\SELF\py-fastapi-demo\app\services\data_service.py", line 23, in get_stock_history
    df = data_provider.get_stock_history(source=source, code=code, market=market, start_date=start_date, end_date=end_date)
         │             │                        │            │            │                  │                    └ '20050520'
         │             │                        │            │            │                  └ '20050501'
         │             │                        │            │            └ 'SH'
         │             │                        │            └ '000001'
         │             │                        └ 'tushare'
         │             └ <function TushareProvider.get_stock_history at 0x000001AD75A6BA60>
         └ <data_providers.tushare.TushareProvider object at 0x000001AD180A1640>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\data_providers\tushare.py", line 33, in get_stock_history
    raise RuntimeError(f"从 tushare 获取股票 {code} 数据失败: {str(e)}") from e

RuntimeError: 从 tushare 获取股票 000001 数据失败: 从 tushare 获取股票 000001 的数据为空
2025-07-02 16:15:56.242 | INFO     | app.services.data_service:get_stock_history:20 - [Bridge]获取股票历史行情数据并标准化输出格式 for 000001.SH from tushare
2025-07-02 16:15:56.250 | INFO     | data_providers.tushare:get_stock_history:25 - [Provider]source=tushare, code=000001, market=SH, start_date=20050501, end_date=20050520
2025-07-02 16:15:56.423 | INFO     | data_providers.tushare:get_stock_history:30 - [Provider]tushare 返回的数据列名: ['ts_code', 'trade_date', 'open', 'high', 'low', 'close', 'pre_close', 'change', 'pct_chg', 'vol', 'amount']
2025-07-02 16:16:36.231 | INFO     | app.services.data_service:get_stock_history:20 - [Bridge]获取股票历史行情数据并标准化输出格式 for 000001.SH from tushare
2025-07-02 16:16:36.239 | INFO     | data_providers.tushare:get_stock_history:25 - [Provider]source=tushare, code=000001, market=SH, start_date=20050501, end_date=20050520
2025-07-02 16:16:36.338 | INFO     | data_providers.tushare:get_stock_history:30 - [Provider]tushare 返回的数据列名: ['ts_code', 'trade_date', 'open', 'high', 'low', 'close', 'pre_close', 'change', 'pct_chg', 'vol', 'amount']
2025-07-02 16:16:36.340 | ERROR    | app.services.data_service:get_stock_history:74 - Error fetching stock history data
Traceback (most recent call last):

  File "C:\proj\ELSE\SELF\py-fastapi-demo\data_providers\tushare.py", line 32, in get_stock_history
    raise RuntimeError(f"从 tushare 获取股票 {code} 的数据为空")

RuntimeError: 从 tushare 获取股票 000001 的数据为空


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "C:\proj\ELSE\SELF\py-fastapi-demo\core\logger.py", line 29, in wrapper
    return func(*args, **kwargs_inner)
           │     │       └ {'source': 'tushare', 'code': '000001', 'market': 'SH', 'start_date': '20050501', 'end_date': '20050520'}
           │     └ (<data_providers.tushare.TushareProvider object at 0x000001DEF74B3490>,)
           └ <function TushareProvider.get_stock_history at 0x000001DED825CB80>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\data_providers\tushare.py", line 35, in get_stock_history
    raise RuntimeError(f"从 tushare 获取股票 {code} 数据失败: {str(e)}") from e

RuntimeError: 从 tushare 获取股票 000001 数据失败: 从 tushare 获取股票 000001 的数据为空


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "C:\else_env\Python39\lib\multiprocessing\spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 324
               │     └ 3
               └ <function _main at 0x000001DEC4496AF0>

  File "C:\else_env\Python39\lib\multiprocessing\spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 324
           │    └ <function BaseProcess._bootstrap at 0x000001DEC414B5E0>
           └ <SpawnProcess name='SpawnProcess-1' parent=56312 started>

  File "C:\else_env\Python39\lib\multiprocessing\process.py", line 315, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x000001DEC4146C10>
    └ <SpawnProcess name='SpawnProcess-1' parent=56312 started>

  File "C:\else_env\Python39\lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x000001DEC3E9B3D0>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=56312 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=56312 started>
    │    └ <function subprocess_started at 0x000001DEC662F040>
    └ <SpawnProcess name='SpawnProcess-1' parent=56312 started>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\uvicorn\_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=740, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('127.0.0.1', 8003)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x000001DEC39E6CD0>>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\uvicorn\server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=740, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('127.0.0.1', 8003)>]
           │       │   │    └ <function Server.serve at 0x000001DEC65F7040>
           │       │   └ <uvicorn.server.Server object at 0x000001DEC39E6CD0>
           │       └ <function run at 0x000001DEC448E820>
           └ <module 'asyncio' from 'C:\\else_env\\Python39\\lib\\asyncio\\__init__.py'>

  File "C:\else_env\Python39\lib\asyncio\runners.py", line 44, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x000001DEC65EDA40>
           │    └ <function BaseEventLoop.run_until_complete at 0x000001DEC5E3E670>
           └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 629, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x000001DEC5E3E5E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 596, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x000001DEC5E41160>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 1890, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x000001DEC5DC0DC0>
    └ <Handle <TaskStepMethWrapper object at 0x000001DEF74A0100>()>

  File "C:\else_env\Python39\lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x000001DEF74A0100>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x000001DEF74A0100>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x000001DEF74A0100>()>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\base.py", line 141, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000001DEF74911F0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001DEF74910D0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8003), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x000001DEF7463520>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x000001DEF74634C0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000001DEF74911F0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001DEF74910D0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8003), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000001DEF7463460>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x000001DEF7463520>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
          │                            │    │    │     │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000001DEF74911F0>
          │                            │    │    │     │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001DEF74910D0>
          │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8003), 'cl...
          │                            │    │    └ <starlette.requests.Request object at 0x000001DEF74BB730>
          │                            │    └ <fastapi.routing.APIRouter object at 0x000001DEC772BBB0>
          │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000001DEF7463460>
          └ <function wrap_app_handling_exceptions at 0x000001DEC766A160>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001DEF74CECA0>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001DEF74910D0>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8003), 'cl...
          └ <fastapi.routing.APIRouter object at 0x000001DEC772BBB0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001DEF74CECA0>
          │    │                │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001DEF74910D0>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8003), 'cl...
          │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0x000001DEC772BBB0>>
          └ <fastapi.routing.APIRouter object at 0x000001DEC772BBB0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 734, in app
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001DEF74CECA0>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001DEF74910D0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8003), 'cl...
          │     └ <function Route.handle at 0x000001DEC7689820>
          └ APIRoute(path='/data/index', name='get_history_data', methods=['GET'])

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001DEF74CECA0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001DEF74910D0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8003), 'cl...
          │    └ <function request_response.<locals>.app at 0x000001DEF7444AF0>
          └ APIRoute(path='/data/index', name='get_history_data', methods=['GET'])

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
          │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001DEF74CECA0>
          │                            │    │        │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001DEF74910D0>
          │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8003), 'cl...
          │                            │    └ <starlette.requests.Request object at 0x000001DEF74BB580>
          │                            └ <function request_response.<locals>.app.<locals>.app at 0x000001DEF74CED30>
          └ <function wrap_app_handling_exceptions at 0x000001DEC766A160>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001DEF74CEDC0>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001DEF74910D0>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8003), 'cl...
          └ <function request_response.<locals>.app.<locals>.app at 0x000001DEF74CED30>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
                     │ └ <starlette.requests.Request object at 0x000001DEF74BB580>
                     └ <function get_request_handler.<locals>.app at 0x000001DEF7444D30>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x000001DEC768F430>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'source': 'tushare', 'market': 'SH', 'code': '000001', 'start_date': '20050501', 'end_date': '20050520'}
                 │         └ <function get_history_data at 0x000001DEF7444160>
                 └ Dependant(path_params=[], query_params=[ModelField(field_info=Query(akshare), name='source', mode='validation'), ModelField(f...

  File "C:\proj\ELSE\SELF\py-fastapi-demo\app\routers\router.py", line 15, in get_history_data
    df = data_service.get_stock_history(source=source, code=code, market=market, start_date=start_date, end_date=end_date)
         │            │                        │            │            │                  │                    └ '20050520'
         │            │                        │            │            │                  └ '20050501'
         │            │                        │            │            └ 'SH'
         │            │                        │            └ '000001'
         │            │                        └ 'tushare'
         │            └ <function get_stock_history at 0x000001DEC77A2700>
         └ <module 'app.services.data_service' from 'C:\\proj\\ELSE\\SELF\\py-fastapi-demo\\app\\services\\data_service.py'>

> File "C:\proj\ELSE\SELF\py-fastapi-demo\app\services\data_service.py", line 23, in get_stock_history
    df = data_provider.get_stock_history(source=source, code=code, market=market, start_date=start_date, end_date=end_date)
         │             │                        │            │            │                  │                    └ '20050520'
         │             │                        │            │            │                  └ '20050501'
         │             │                        │            │            └ 'SH'
         │             │                        │            └ '000001'
         │             │                        └ 'tushare'
         │             └ <function catch.<locals>.decorator.<locals>.wrapper at 0x000001DED825CC10>
         └ <data_providers.tushare.TushareProvider object at 0x000001DEF74B3490>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\core\logger.py", line 34, in wrapper
    _logger.error(f"捕获异常: {str(e)}\nTraceback (最近 {depth} 层):\n{tb}")
    └ <module 'loguru._logger' from 'C:\\proj\\ELSE\\SELF\\py-fastapi-demo\\.venv\\lib\\site-packages\\loguru\\_logger.py'>

AttributeError: module 'loguru._logger' has no attribute 'error'
2025-07-02 16:19:09.481 | INFO     | app.services.data_service:get_stock_history:20 - [Bridge]获取股票历史行情数据并标准化输出格式 for 000001.SH from tushare
2025-07-02 16:19:09.488 | INFO     | data_providers.tushare:get_stock_history:25 - [Provider]source=tushare, code=000001, market=SH, start_date=20050501, end_date=20050520
2025-07-02 16:19:09.594 | INFO     | data_providers.tushare:get_stock_history:30 - [Provider]tushare 返回的数据列名: ['ts_code', 'trade_date', 'open', 'high', 'low', 'close', 'pre_close', 'change', 'pct_chg', 'vol', 'amount']
2025-07-02 16:19:09.596 | ERROR    | core.logger:wrapper:33 - 捕获异常: 从 tushare 获取股票 000001 数据失败: 从 tushare 获取股票 000001 的数据为空
Traceback (最近 2 层):
  File "C:\proj\ELSE\SELF\py-fastapi-demo\core\logger.py", line 28, in wrapper
    return func(*args, **kwargs_inner)
  File "C:\proj\ELSE\SELF\py-fastapi-demo\data_providers\tushare.py", line 35, in get_stock_history
    raise RuntimeError(f"从 tushare 获取股票 {code} 数据失败: {str(e)}") from e

2025-07-02 16:19:09.596 | ERROR    | app.services.data_service:get_stock_history:74 - Error fetching stock history data
Traceback (most recent call last):

  File "C:\proj\ELSE\SELF\py-fastapi-demo\data_providers\tushare.py", line 32, in get_stock_history
    raise RuntimeError(f"从 tushare 获取股票 {code} 的数据为空")

RuntimeError: 从 tushare 获取股票 000001 的数据为空


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "C:\else_env\Python39\lib\multiprocessing\spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 364
               │     └ 3
               └ <function _main at 0x0000020E04B46AF0>

  File "C:\else_env\Python39\lib\multiprocessing\spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 364
           │    └ <function BaseProcess._bootstrap at 0x0000020E047DB5E0>
           └ <SpawnProcess name='SpawnProcess-4' parent=56312 started>

  File "C:\else_env\Python39\lib\multiprocessing\process.py", line 315, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x0000020E047D6C10>
    └ <SpawnProcess name='SpawnProcess-4' parent=56312 started>

  File "C:\else_env\Python39\lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x0000020E0452B3D0>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-4' parent=56312 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-4' parent=56312 started>
    │    └ <function subprocess_started at 0x0000020E06CDF040>
    └ <SpawnProcess name='SpawnProcess-4' parent=56312 started>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\uvicorn\_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=804, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('127.0.0.1', 8003)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x0000020E043F6CD0>>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\uvicorn\server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=804, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('127.0.0.1', 8003)>]
           │       │   │    └ <function Server.serve at 0x0000020E06CA7040>
           │       │   └ <uvicorn.server.Server object at 0x0000020E043F6CD0>
           │       └ <function run at 0x0000020E04B43820>
           └ <module 'asyncio' from 'C:\\else_env\\Python39\\lib\\asyncio\\__init__.py'>

  File "C:\else_env\Python39\lib\asyncio\runners.py", line 44, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x0000020E06C9DA40>
           │    └ <function BaseEventLoop.run_until_complete at 0x0000020E064DE670>
           └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 629, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x0000020E064DE5E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 596, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x0000020E064E1160>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 1890, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x0000020E06470DC0>
    └ <Handle <TaskStepMethWrapper object at 0x0000020E37B4F3A0>()>

  File "C:\else_env\Python39\lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x0000020E37B4F3A0>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x0000020E37B4F3A0>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x0000020E37B4F3A0>()>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\base.py", line 141, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x0000020E37B421F0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000020E37B420D0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8003), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x0000020E37B147C0>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x0000020E37B14760>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x0000020E37B421F0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000020E37B420D0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8003), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x0000020E37B14700>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x0000020E37B147C0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
          │                            │    │    │     │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x0000020E37B421F0>
          │                            │    │    │     │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000020E37B420D0>
          │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8003), 'cl...
          │                            │    │    └ <starlette.requests.Request object at 0x0000020E37B6B400>
          │                            │    └ <fastapi.routing.APIRouter object at 0x0000020E07DDBBB0>
          │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x0000020E37B14700>
          └ <function wrap_app_handling_exceptions at 0x0000020E07D1A160>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000020E37B7ECA0>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000020E37B420D0>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8003), 'cl...
          └ <fastapi.routing.APIRouter object at 0x0000020E07DDBBB0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000020E37B7ECA0>
          │    │                │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000020E37B420D0>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8003), 'cl...
          │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0x0000020E07DDBBB0>>
          └ <fastapi.routing.APIRouter object at 0x0000020E07DDBBB0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 734, in app
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000020E37B7ECA0>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000020E37B420D0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8003), 'cl...
          │     └ <function Route.handle at 0x0000020E07D39820>
          └ APIRoute(path='/data/index', name='get_history_data', methods=['GET'])

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000020E37B7ECA0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000020E37B420D0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8003), 'cl...
          │    └ <function request_response.<locals>.app at 0x0000020E37AF4AF0>
          └ APIRoute(path='/data/index', name='get_history_data', methods=['GET'])

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
          │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000020E37B7ECA0>
          │                            │    │        │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000020E37B420D0>
          │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8003), 'cl...
          │                            │    └ <starlette.requests.Request object at 0x0000020E37B6B250>
          │                            └ <function request_response.<locals>.app.<locals>.app at 0x0000020E37B7ED30>
          └ <function wrap_app_handling_exceptions at 0x0000020E07D1A160>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000020E37B7EDC0>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000020E37B420D0>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8003), 'cl...
          └ <function request_response.<locals>.app.<locals>.app at 0x0000020E37B7ED30>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
                     │ └ <starlette.requests.Request object at 0x0000020E37B6B250>
                     └ <function get_request_handler.<locals>.app at 0x0000020E37AF4D30>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x0000020E07D3F430>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'source': 'tushare', 'market': 'SH', 'code': '000001', 'start_date': '20050501', 'end_date': '20050520'}
                 │         └ <function get_history_data at 0x0000020E37AF4160>
                 └ Dependant(path_params=[], query_params=[ModelField(field_info=Query(akshare), name='source', mode='validation'), ModelField(f...

  File "C:\proj\ELSE\SELF\py-fastapi-demo\app\routers\router.py", line 15, in get_history_data
    df = data_service.get_stock_history(source=source, code=code, market=market, start_date=start_date, end_date=end_date)
         │            │                        │            │            │                  │                    └ '20050520'
         │            │                        │            │            │                  └ '20050501'
         │            │                        │            │            └ 'SH'
         │            │                        │            └ '000001'
         │            │                        └ 'tushare'
         │            └ <function get_stock_history at 0x0000020E07E53700>
         └ <module 'app.services.data_service' from 'C:\\proj\\ELSE\\SELF\\py-fastapi-demo\\app\\services\\data_service.py'>

> File "C:\proj\ELSE\SELF\py-fastapi-demo\app\services\data_service.py", line 23, in get_stock_history
    df = data_provider.get_stock_history(source=source, code=code, market=market, start_date=start_date, end_date=end_date)
         │             │                        │            │            │                  │                    └ '20050520'
         │             │                        │            │            │                  └ '20050501'
         │             │                        │            │            └ 'SH'
         │             │                        │            └ '000001'
         │             │                        └ 'tushare'
         │             └ <function catch.<locals>.decorator.<locals>.wrapper at 0x0000020E1890BC10>
         └ <data_providers.tushare.TushareProvider object at 0x0000020E37B5FB20>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\core\logger.py", line 28, in wrapper
    return func(*args, **kwargs_inner)
           │     │       └ {'source': 'tushare', 'code': '000001', 'market': 'SH', 'start_date': '20050501', 'end_date': '20050520'}
           │     └ (<data_providers.tushare.TushareProvider object at 0x0000020E37B5FB20>,)
           └ <function TushareProvider.get_stock_history at 0x0000020E1890BB80>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\data_providers\tushare.py", line 35, in get_stock_history
    raise RuntimeError(f"从 tushare 获取股票 {code} 数据失败: {str(e)}") from e

RuntimeError: 从 tushare 获取股票 000001 数据失败: 从 tushare 获取股票 000001 的数据为空
2025-07-02 16:24:29.203 | INFO     | app.services.data_service:get_stock_history:20 - [Bridge]获取股票历史行情数据并标准化输出格式 for 000001.SH from tushare
2025-07-02 16:24:29.206 | INFO     | data_providers.tushare:get_stock_history:25 - [Provider]source=tushare, code=000001, market=SH, start_date=20050501, end_date=20050520
2025-07-02 16:24:29.341 | INFO     | data_providers.tushare:get_stock_history:30 - [Provider]tushare 返回的数据列名: ['ts_code', 'trade_date', 'open', 'high', 'low', 'close', 'pre_close', 'change', 'pct_chg', 'vol', 'amount']
2025-07-02 16:24:29.342 | ERROR    | core.logger:wrapper:33 - 捕获异常: 从 tushare 获取股票 000001 数据失败: 从 tushare 获取股票 000001 的数据为空
Traceback (最近 2 层):
  File "C:\proj\ELSE\SELF\py-fastapi-demo\core\logger.py", line 28, in wrapper
    return func(*args, **kwargs_inner)
  File "C:\proj\ELSE\SELF\py-fastapi-demo\data_providers\tushare.py", line 35, in get_stock_history
    raise RuntimeError(f"从 tushare 获取股票 {code} 数据失败: {str(e)}") from e

2025-07-02 16:24:29.342 | ERROR    | app.services.data_service:get_stock_history:74 - Error fetching stock history data
Traceback (most recent call last):

  File "C:\proj\ELSE\SELF\py-fastapi-demo\data_providers\tushare.py", line 32, in get_stock_history
    raise RuntimeError(f"从 tushare 获取股票 {code} 的数据为空")

RuntimeError: 从 tushare 获取股票 000001 的数据为空


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "C:\else_env\Python39\lib\multiprocessing\spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 364
               │     └ 3
               └ <function _main at 0x0000020E04B46AF0>

  File "C:\else_env\Python39\lib\multiprocessing\spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 364
           │    └ <function BaseProcess._bootstrap at 0x0000020E047DB5E0>
           └ <SpawnProcess name='SpawnProcess-4' parent=56312 started>

  File "C:\else_env\Python39\lib\multiprocessing\process.py", line 315, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x0000020E047D6C10>
    └ <SpawnProcess name='SpawnProcess-4' parent=56312 started>

  File "C:\else_env\Python39\lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x0000020E0452B3D0>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-4' parent=56312 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-4' parent=56312 started>
    │    └ <function subprocess_started at 0x0000020E06CDF040>
    └ <SpawnProcess name='SpawnProcess-4' parent=56312 started>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\uvicorn\_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=804, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('127.0.0.1', 8003)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x0000020E043F6CD0>>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\uvicorn\server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=804, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('127.0.0.1', 8003)>]
           │       │   │    └ <function Server.serve at 0x0000020E06CA7040>
           │       │   └ <uvicorn.server.Server object at 0x0000020E043F6CD0>
           │       └ <function run at 0x0000020E04B43820>
           └ <module 'asyncio' from 'C:\\else_env\\Python39\\lib\\asyncio\\__init__.py'>

  File "C:\else_env\Python39\lib\asyncio\runners.py", line 44, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x0000020E06C9DA40>
           │    └ <function BaseEventLoop.run_until_complete at 0x0000020E064DE670>
           └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 629, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x0000020E064DE5E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 596, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x0000020E064E1160>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 1890, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x0000020E06470DC0>
    └ <Handle <TaskStepMethWrapper object at 0x0000020E37B5F310>()>

  File "C:\else_env\Python39\lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x0000020E37B5F310>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x0000020E37B5F310>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x0000020E37B5F310>()>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\base.py", line 141, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x0000020E37B7EDC0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000020E37B7ED30>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8003), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x0000020E37B147C0>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x0000020E37B14760>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x0000020E37B7EDC0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000020E37B7ED30>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8003), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x0000020E37B14700>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x0000020E37B147C0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
          │                            │    │    │     │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x0000020E37B7EDC0>
          │                            │    │    │     │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000020E37B7ED30>
          │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8003), 'cl...
          │                            │    │    └ <starlette.requests.Request object at 0x0000020E37B5F5B0>
          │                            │    └ <fastapi.routing.APIRouter object at 0x0000020E07DDBBB0>
          │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x0000020E37B14700>
          └ <function wrap_app_handling_exceptions at 0x0000020E07D1A160>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000020E37B42790>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000020E37B7ED30>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8003), 'cl...
          └ <fastapi.routing.APIRouter object at 0x0000020E07DDBBB0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000020E37B42790>
          │    │                │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000020E37B7ED30>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8003), 'cl...
          │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0x0000020E07DDBBB0>>
          └ <fastapi.routing.APIRouter object at 0x0000020E07DDBBB0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 734, in app
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000020E37B42790>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000020E37B7ED30>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8003), 'cl...
          │     └ <function Route.handle at 0x0000020E07D39820>
          └ APIRoute(path='/data/index', name='get_history_data', methods=['GET'])

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000020E37B42790>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000020E37B7ED30>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8003), 'cl...
          │    └ <function request_response.<locals>.app at 0x0000020E37AF4AF0>
          └ APIRoute(path='/data/index', name='get_history_data', methods=['GET'])

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
          │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000020E37B42790>
          │                            │    │        │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000020E37B7ED30>
          │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8003), 'cl...
          │                            │    └ <starlette.requests.Request object at 0x0000020E37B5F9A0>
          │                            └ <function request_response.<locals>.app.<locals>.app at 0x0000020E37B92430>
          └ <function wrap_app_handling_exceptions at 0x0000020E07D1A160>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000020E37B92550>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000020E37B7ED30>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8003), 'cl...
          └ <function request_response.<locals>.app.<locals>.app at 0x0000020E37B92430>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
                     │ └ <starlette.requests.Request object at 0x0000020E37B5F9A0>
                     └ <function get_request_handler.<locals>.app at 0x0000020E37AF4D30>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x0000020E07D3F430>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'source': 'tushare', 'market': 'SH', 'code': '000001', 'start_date': '20050501', 'end_date': '20050520'}
                 │         └ <function get_history_data at 0x0000020E37AF4160>
                 └ Dependant(path_params=[], query_params=[ModelField(field_info=Query(akshare), name='source', mode='validation'), ModelField(f...

  File "C:\proj\ELSE\SELF\py-fastapi-demo\app\routers\router.py", line 15, in get_history_data
    df = data_service.get_stock_history(source=source, code=code, market=market, start_date=start_date, end_date=end_date)
         │            │                        │            │            │                  │                    └ '20050520'
         │            │                        │            │            │                  └ '20050501'
         │            │                        │            │            └ 'SH'
         │            │                        │            └ '000001'
         │            │                        └ 'tushare'
         │            └ <function get_stock_history at 0x0000020E07E53700>
         └ <module 'app.services.data_service' from 'C:\\proj\\ELSE\\SELF\\py-fastapi-demo\\app\\services\\data_service.py'>

> File "C:\proj\ELSE\SELF\py-fastapi-demo\app\services\data_service.py", line 23, in get_stock_history
    df = data_provider.get_stock_history(source=source, code=code, market=market, start_date=start_date, end_date=end_date)
         │             │                        │            │            │                  │                    └ '20050520'
         │             │                        │            │            │                  └ '20050501'
         │             │                        │            │            └ 'SH'
         │             │                        │            └ '000001'
         │             │                        └ 'tushare'
         │             └ <function catch.<locals>.decorator.<locals>.wrapper at 0x0000020E1890BC10>
         └ <data_providers.tushare.TushareProvider object at 0x0000020E37B9A5E0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\core\logger.py", line 28, in wrapper
    return func(*args, **kwargs_inner)
           │     │       └ {'source': 'tushare', 'code': '000001', 'market': 'SH', 'start_date': '20050501', 'end_date': '20050520'}
           │     └ (<data_providers.tushare.TushareProvider object at 0x0000020E37B9A5E0>,)
           └ <function TushareProvider.get_stock_history at 0x0000020E1890BB80>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\data_providers\tushare.py", line 35, in get_stock_history
    raise RuntimeError(f"从 tushare 获取股票 {code} 数据失败: {str(e)}") from e

RuntimeError: 从 tushare 获取股票 000001 数据失败: 从 tushare 获取股票 000001 的数据为空
2025-07-02 16:43:50.365 | INFO     | app.services.data_service:get_stock_history:20 - [Bridge]获取股票历史行情数据并标准化输出格式 for 000001.SH from tushare
2025-07-02 16:43:50.369 | INFO     | data_providers.tushare:get_stock_history:25 - [Provider]source=tushare, code=000001, market=SH, start_date=20050501, end_date=20050520
2025-07-02 16:43:50.577 | INFO     | data_providers.tushare:get_stock_history:30 - [Provider]tushare 返回的数据列名: ['ts_code', 'trade_date', 'open', 'high', 'low', 'close', 'pre_close', 'change', 'pct_chg', 'vol', 'amount']
2025-07-02 16:43:50.578 | ERROR    | core.logger:wrapper:33 - 捕获异常: 从 tushare 获取股票 000001 数据失败: 从 tushare 获取股票 000001 的数据为空
Traceback (最近 2 层):
  File "C:\proj\ELSE\SELF\py-fastapi-demo\core\logger.py", line 28, in wrapper
    return func(*args, **kwargs_inner)
  File "C:\proj\ELSE\SELF\py-fastapi-demo\data_providers\tushare.py", line 35, in get_stock_history
    raise RuntimeError(f"从 tushare 获取股票 {code} 数据失败: {str(e)}") from e

2025-07-02 16:43:50.579 | ERROR    | app.services.data_service:get_stock_history:74 - Error fetching stock history data
Traceback (most recent call last):

  File "C:\proj\ELSE\SELF\py-fastapi-demo\data_providers\tushare.py", line 32, in get_stock_history
    raise RuntimeError(f"从 tushare 获取股票 {code} 的数据为空")

RuntimeError: 从 tushare 获取股票 000001 的数据为空


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "C:\else_env\Python39\lib\multiprocessing\spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 364
               │     └ 3
               └ <function _main at 0x0000020E04B46AF0>

  File "C:\else_env\Python39\lib\multiprocessing\spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 364
           │    └ <function BaseProcess._bootstrap at 0x0000020E047DB5E0>
           └ <SpawnProcess name='SpawnProcess-4' parent=56312 started>

  File "C:\else_env\Python39\lib\multiprocessing\process.py", line 315, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x0000020E047D6C10>
    └ <SpawnProcess name='SpawnProcess-4' parent=56312 started>

  File "C:\else_env\Python39\lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x0000020E0452B3D0>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-4' parent=56312 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-4' parent=56312 started>
    │    └ <function subprocess_started at 0x0000020E06CDF040>
    └ <SpawnProcess name='SpawnProcess-4' parent=56312 started>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\uvicorn\_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=804, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('127.0.0.1', 8003)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x0000020E043F6CD0>>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\uvicorn\server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=804, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('127.0.0.1', 8003)>]
           │       │   │    └ <function Server.serve at 0x0000020E06CA7040>
           │       │   └ <uvicorn.server.Server object at 0x0000020E043F6CD0>
           │       └ <function run at 0x0000020E04B43820>
           └ <module 'asyncio' from 'C:\\else_env\\Python39\\lib\\asyncio\\__init__.py'>

  File "C:\else_env\Python39\lib\asyncio\runners.py", line 44, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x0000020E06C9DA40>
           │    └ <function BaseEventLoop.run_until_complete at 0x0000020E064DE670>
           └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 629, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x0000020E064DE5E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 596, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x0000020E064E1160>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 1890, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x0000020E06470DC0>
    └ <Handle <TaskStepMethWrapper object at 0x0000020E37B9A3D0>()>

  File "C:\else_env\Python39\lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x0000020E37B9A3D0>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x0000020E37B9A3D0>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x0000020E37B9A3D0>()>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\base.py", line 141, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x0000020E37B420D0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000020E37B421F0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8003), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x0000020E37B147C0>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x0000020E37B14760>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x0000020E37B420D0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000020E37B421F0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8003), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x0000020E37B14700>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x0000020E37B147C0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
          │                            │    │    │     │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x0000020E37B420D0>
          │                            │    │    │     │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000020E37B421F0>
          │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8003), 'cl...
          │                            │    │    └ <starlette.requests.Request object at 0x0000020E37B9AA00>
          │                            │    └ <fastapi.routing.APIRouter object at 0x0000020E07DDBBB0>
          │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x0000020E37B14700>
          └ <function wrap_app_handling_exceptions at 0x0000020E07D1A160>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000020E37B92550>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000020E37B421F0>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8003), 'cl...
          └ <fastapi.routing.APIRouter object at 0x0000020E07DDBBB0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000020E37B92550>
          │    │                │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000020E37B421F0>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8003), 'cl...
          │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0x0000020E07DDBBB0>>
          └ <fastapi.routing.APIRouter object at 0x0000020E07DDBBB0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 734, in app
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000020E37B92550>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000020E37B421F0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8003), 'cl...
          │     └ <function Route.handle at 0x0000020E07D39820>
          └ APIRoute(path='/data/index', name='get_history_data', methods=['GET'])

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000020E37B92550>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000020E37B421F0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8003), 'cl...
          │    └ <function request_response.<locals>.app at 0x0000020E37AF4AF0>
          └ APIRoute(path='/data/index', name='get_history_data', methods=['GET'])

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
          │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000020E37B92550>
          │                            │    │        │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000020E37B421F0>
          │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8003), 'cl...
          │                            │    └ <starlette.requests.Request object at 0x0000020E37B9AE80>
          │                            └ <function request_response.<locals>.app.<locals>.app at 0x0000020E37B925E0>
          └ <function wrap_app_handling_exceptions at 0x0000020E07D1A160>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000020E37C9ED30>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000020E37B421F0>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8003), 'cl...
          └ <function request_response.<locals>.app.<locals>.app at 0x0000020E37B925E0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
                     │ └ <starlette.requests.Request object at 0x0000020E37B9AE80>
                     └ <function get_request_handler.<locals>.app at 0x0000020E37AF4D30>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x0000020E07D3F430>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'source': 'tushare', 'market': 'SH', 'code': '000001', 'start_date': '20050501', 'end_date': '20050520'}
                 │         └ <function get_history_data at 0x0000020E37AF4160>
                 └ Dependant(path_params=[], query_params=[ModelField(field_info=Query(akshare), name='source', mode='validation'), ModelField(f...

  File "C:\proj\ELSE\SELF\py-fastapi-demo\app\routers\router.py", line 15, in get_history_data
    df = data_service.get_stock_history(source=source, code=code, market=market, start_date=start_date, end_date=end_date)
         │            │                        │            │            │                  │                    └ '20050520'
         │            │                        │            │            │                  └ '20050501'
         │            │                        │            │            └ 'SH'
         │            │                        │            └ '000001'
         │            │                        └ 'tushare'
         │            └ <function get_stock_history at 0x0000020E07E53700>
         └ <module 'app.services.data_service' from 'C:\\proj\\ELSE\\SELF\\py-fastapi-demo\\app\\services\\data_service.py'>

> File "C:\proj\ELSE\SELF\py-fastapi-demo\app\services\data_service.py", line 23, in get_stock_history
    df = data_provider.get_stock_history(source=source, code=code, market=market, start_date=start_date, end_date=end_date)
         │             │                        │            │            │                  │                    └ '20050520'
         │             │                        │            │            │                  └ '20050501'
         │             │                        │            │            └ 'SH'
         │             │                        │            └ '000001'
         │             │                        └ 'tushare'
         │             └ <function catch.<locals>.decorator.<locals>.wrapper at 0x0000020E1890BC10>
         └ <data_providers.tushare.TushareProvider object at 0x0000020E37B9A310>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\core\logger.py", line 28, in wrapper
    return func(*args, **kwargs_inner)
           │     │       └ {'source': 'tushare', 'code': '000001', 'market': 'SH', 'start_date': '20050501', 'end_date': '20050520'}
           │     └ (<data_providers.tushare.TushareProvider object at 0x0000020E37B9A310>,)
           └ <function TushareProvider.get_stock_history at 0x0000020E1890BB80>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\data_providers\tushare.py", line 35, in get_stock_history
    raise RuntimeError(f"从 tushare 获取股票 {code} 数据失败: {str(e)}") from e

RuntimeError: 从 tushare 获取股票 000001 数据失败: 从 tushare 获取股票 000001 的数据为空
2025-07-02 16:44:45.248 | INFO     | app.services.data_service:get_stock_history:20 - [Bridge]获取股票历史行情数据并标准化输出格式 for 000001.SH from tushare
2025-07-02 16:44:45.251 | INFO     | data_providers.tushare:get_stock_history:25 - [Provider]source=tushare, code=000001, market=SH, start_date=20050501, end_date=20050520
2025-07-02 16:44:45.345 | INFO     | data_providers.tushare:get_stock_history:30 - [Provider]tushare 返回的数据列名: ['ts_code', 'trade_date', 'open', 'high', 'low', 'close', 'pre_close', 'change', 'pct_chg', 'vol', 'amount']
2025-07-02 16:44:45.345 | ERROR    | core.logger:wrapper:33 - 捕获异常: 从 tushare 获取股票 000001 数据失败: 从 tushare 获取股票 000001 的数据为空
Traceback (最近 2 层):
  File "C:\proj\ELSE\SELF\py-fastapi-demo\core\logger.py", line 28, in wrapper
    return func(*args, **kwargs_inner)
  File "C:\proj\ELSE\SELF\py-fastapi-demo\data_providers\tushare.py", line 35, in get_stock_history
    raise RuntimeError(f"从 tushare 获取股票 {code} 数据失败: {str(e)}") from e

2025-07-02 16:44:45.345 | ERROR    | app.services.data_service:get_stock_history:74 - Error fetching stock history data
Traceback (most recent call last):

  File "C:\proj\ELSE\SELF\py-fastapi-demo\data_providers\tushare.py", line 32, in get_stock_history
    raise RuntimeError(f"从 tushare 获取股票 {code} 的数据为空")

RuntimeError: 从 tushare 获取股票 000001 的数据为空


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "C:\else_env\Python39\lib\multiprocessing\spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 364
               │     └ 3
               └ <function _main at 0x0000020E04B46AF0>

  File "C:\else_env\Python39\lib\multiprocessing\spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 364
           │    └ <function BaseProcess._bootstrap at 0x0000020E047DB5E0>
           └ <SpawnProcess name='SpawnProcess-4' parent=56312 started>

  File "C:\else_env\Python39\lib\multiprocessing\process.py", line 315, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x0000020E047D6C10>
    └ <SpawnProcess name='SpawnProcess-4' parent=56312 started>

  File "C:\else_env\Python39\lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x0000020E0452B3D0>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-4' parent=56312 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-4' parent=56312 started>
    │    └ <function subprocess_started at 0x0000020E06CDF040>
    └ <SpawnProcess name='SpawnProcess-4' parent=56312 started>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\uvicorn\_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=804, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('127.0.0.1', 8003)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x0000020E043F6CD0>>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\uvicorn\server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=804, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('127.0.0.1', 8003)>]
           │       │   │    └ <function Server.serve at 0x0000020E06CA7040>
           │       │   └ <uvicorn.server.Server object at 0x0000020E043F6CD0>
           │       └ <function run at 0x0000020E04B43820>
           └ <module 'asyncio' from 'C:\\else_env\\Python39\\lib\\asyncio\\__init__.py'>

  File "C:\else_env\Python39\lib\asyncio\runners.py", line 44, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x0000020E06C9DA40>
           │    └ <function BaseEventLoop.run_until_complete at 0x0000020E064DE670>
           └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 629, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x0000020E064DE5E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 596, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x0000020E064E1160>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 1890, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x0000020E06470DC0>
    └ <Handle <TaskStepMethWrapper object at 0x0000020E37B9AC70>()>

  File "C:\else_env\Python39\lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x0000020E37B9AC70>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x0000020E37B9AC70>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x0000020E37B9AC70>()>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\base.py", line 141, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x0000020E37B42A60>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000020E37B925E0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8003), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x0000020E37B147C0>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x0000020E37B14760>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x0000020E37B42A60>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000020E37B925E0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8003), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x0000020E37B14700>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x0000020E37B147C0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
          │                            │    │    │     │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x0000020E37B42A60>
          │                            │    │    │     │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000020E37B925E0>
          │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8003), 'cl...
          │                            │    │    └ <starlette.requests.Request object at 0x0000020E37B9ACA0>
          │                            │    └ <fastapi.routing.APIRouter object at 0x0000020E07DDBBB0>
          │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x0000020E37B14700>
          └ <function wrap_app_handling_exceptions at 0x0000020E07D1A160>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000020E37C9EDC0>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000020E37B925E0>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8003), 'cl...
          └ <fastapi.routing.APIRouter object at 0x0000020E07DDBBB0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000020E37C9EDC0>
          │    │                │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000020E37B925E0>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8003), 'cl...
          │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0x0000020E07DDBBB0>>
          └ <fastapi.routing.APIRouter object at 0x0000020E07DDBBB0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 734, in app
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000020E37C9EDC0>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000020E37B925E0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8003), 'cl...
          │     └ <function Route.handle at 0x0000020E07D39820>
          └ APIRoute(path='/data/index', name='get_history_data', methods=['GET'])

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000020E37C9EDC0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000020E37B925E0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8003), 'cl...
          │    └ <function request_response.<locals>.app at 0x0000020E37AF4AF0>
          └ APIRoute(path='/data/index', name='get_history_data', methods=['GET'])

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
          │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000020E37C9EDC0>
          │                            │    │        │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000020E37B925E0>
          │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8003), 'cl...
          │                            │    └ <starlette.requests.Request object at 0x0000020E37CC0C70>
          │                            └ <function request_response.<locals>.app.<locals>.app at 0x0000020E37C9ED30>
          └ <function wrap_app_handling_exceptions at 0x0000020E07D1A160>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000020E37C9EEE0>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000020E37B925E0>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8003), 'cl...
          └ <function request_response.<locals>.app.<locals>.app at 0x0000020E37C9ED30>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
                     │ └ <starlette.requests.Request object at 0x0000020E37CC0C70>
                     └ <function get_request_handler.<locals>.app at 0x0000020E37AF4D30>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x0000020E07D3F430>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'source': 'tushare', 'market': 'SH', 'code': '000001', 'start_date': '20050501', 'end_date': '20050520'}
                 │         └ <function get_history_data at 0x0000020E37AF4160>
                 └ Dependant(path_params=[], query_params=[ModelField(field_info=Query(akshare), name='source', mode='validation'), ModelField(f...

  File "C:\proj\ELSE\SELF\py-fastapi-demo\app\routers\router.py", line 15, in get_history_data
    df = data_service.get_stock_history(source=source, code=code, market=market, start_date=start_date, end_date=end_date)
         │            │                        │            │            │                  │                    └ '20050520'
         │            │                        │            │            │                  └ '20050501'
         │            │                        │            │            └ 'SH'
         │            │                        │            └ '000001'
         │            │                        └ 'tushare'
         │            └ <function get_stock_history at 0x0000020E07E53700>
         └ <module 'app.services.data_service' from 'C:\\proj\\ELSE\\SELF\\py-fastapi-demo\\app\\services\\data_service.py'>

> File "C:\proj\ELSE\SELF\py-fastapi-demo\app\services\data_service.py", line 23, in get_stock_history
    df = data_provider.get_stock_history(source=source, code=code, market=market, start_date=start_date, end_date=end_date)
         │             │                        │            │            │                  │                    └ '20050520'
         │             │                        │            │            │                  └ '20050501'
         │             │                        │            │            └ 'SH'
         │             │                        │            └ '000001'
         │             │                        └ 'tushare'
         │             └ <function catch.<locals>.decorator.<locals>.wrapper at 0x0000020E1890BC10>
         └ <data_providers.tushare.TushareProvider object at 0x0000020E37CC0070>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\core\logger.py", line 28, in wrapper
    return func(*args, **kwargs_inner)
           │     │       └ {'source': 'tushare', 'code': '000001', 'market': 'SH', 'start_date': '20050501', 'end_date': '20050520'}
           │     └ (<data_providers.tushare.TushareProvider object at 0x0000020E37CC0070>,)
           └ <function TushareProvider.get_stock_history at 0x0000020E1890BB80>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\data_providers\tushare.py", line 35, in get_stock_history
    raise RuntimeError(f"从 tushare 获取股票 {code} 数据失败: {str(e)}") from e

RuntimeError: 从 tushare 获取股票 000001 数据失败: 从 tushare 获取股票 000001 的数据为空
2025-07-02 16:47:01.808 | INFO     | app.services.data_service:get_stock_history:20 - [Bridge]获取股票历史行情数据并标准化输出格式 for 000001.SH from tushare
2025-07-02 16:47:01.810 | INFO     | data_providers.tushare:get_stock_history:25 - [Provider]source=tushare, code=000001, market=SH, start_date=20050501, end_date=20050520
2025-07-02 16:47:01.944 | INFO     | data_providers.tushare:get_stock_history:30 - [Provider]tushare 返回的数据列名: ['ts_code', 'trade_date', 'open', 'high', 'low', 'close', 'pre_close', 'change', 'pct_chg', 'vol', 'amount']
2025-07-02 16:47:01.944 | ERROR    | core.logger:wrapper:33 - 捕获异常: 从 tushare 获取股票 000001 数据失败: 从 tushare 获取股票 000001 的数据为空
Traceback (最近 2 层):
  File "C:\proj\ELSE\SELF\py-fastapi-demo\core\logger.py", line 28, in wrapper
    return func(*args, **kwargs_inner)
  File "C:\proj\ELSE\SELF\py-fastapi-demo\data_providers\tushare.py", line 35, in get_stock_history
    raise RuntimeError(f"从 tushare 获取股票 {code} 数据失败: {str(e)}") from e

2025-07-02 16:47:01.945 | ERROR    | app.services.data_service:get_stock_history:74 - Error fetching stock history data
Traceback (most recent call last):

  File "C:\proj\ELSE\SELF\py-fastapi-demo\data_providers\tushare.py", line 32, in get_stock_history
    raise RuntimeError(f"从 tushare 获取股票 {code} 的数据为空")

RuntimeError: 从 tushare 获取股票 000001 的数据为空


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "C:\else_env\Python39\lib\multiprocessing\spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 364
               │     └ 3
               └ <function _main at 0x0000020E04B46AF0>

  File "C:\else_env\Python39\lib\multiprocessing\spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 364
           │    └ <function BaseProcess._bootstrap at 0x0000020E047DB5E0>
           └ <SpawnProcess name='SpawnProcess-4' parent=56312 started>

  File "C:\else_env\Python39\lib\multiprocessing\process.py", line 315, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x0000020E047D6C10>
    └ <SpawnProcess name='SpawnProcess-4' parent=56312 started>

  File "C:\else_env\Python39\lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x0000020E0452B3D0>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-4' parent=56312 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-4' parent=56312 started>
    │    └ <function subprocess_started at 0x0000020E06CDF040>
    └ <SpawnProcess name='SpawnProcess-4' parent=56312 started>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\uvicorn\_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=804, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('127.0.0.1', 8003)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x0000020E043F6CD0>>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\uvicorn\server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=804, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('127.0.0.1', 8003)>]
           │       │   │    └ <function Server.serve at 0x0000020E06CA7040>
           │       │   └ <uvicorn.server.Server object at 0x0000020E043F6CD0>
           │       └ <function run at 0x0000020E04B43820>
           └ <module 'asyncio' from 'C:\\else_env\\Python39\\lib\\asyncio\\__init__.py'>

  File "C:\else_env\Python39\lib\asyncio\runners.py", line 44, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x0000020E06C9DA40>
           │    └ <function BaseEventLoop.run_until_complete at 0x0000020E064DE670>
           └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 629, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x0000020E064DE5E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 596, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x0000020E064E1160>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 1890, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x0000020E06470DC0>
    └ <Handle <TaskStepMethWrapper object at 0x0000020E37CC05B0>()>

  File "C:\else_env\Python39\lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x0000020E37CC05B0>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x0000020E37CC05B0>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x0000020E37CC05B0>()>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\base.py", line 141, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x0000020E37B420D0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000020E37B42A60>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8003), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x0000020E37B147C0>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x0000020E37B14760>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x0000020E37B420D0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000020E37B42A60>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8003), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x0000020E37B14700>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x0000020E37B147C0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
          │                            │    │    │     │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x0000020E37B420D0>
          │                            │    │    │     │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000020E37B42A60>
          │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8003), 'cl...
          │                            │    │    └ <starlette.requests.Request object at 0x0000020E37CC0580>
          │                            │    └ <fastapi.routing.APIRouter object at 0x0000020E07DDBBB0>
          │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x0000020E37B14700>
          └ <function wrap_app_handling_exceptions at 0x0000020E07D1A160>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000020E37B7EDC0>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000020E37B42A60>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8003), 'cl...
          └ <fastapi.routing.APIRouter object at 0x0000020E07DDBBB0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000020E37B7EDC0>
          │    │                │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000020E37B42A60>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8003), 'cl...
          │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0x0000020E07DDBBB0>>
          └ <fastapi.routing.APIRouter object at 0x0000020E07DDBBB0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 734, in app
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000020E37B7EDC0>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000020E37B42A60>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8003), 'cl...
          │     └ <function Route.handle at 0x0000020E07D39820>
          └ APIRoute(path='/data/index', name='get_history_data', methods=['GET'])

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000020E37B7EDC0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000020E37B42A60>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8003), 'cl...
          │    └ <function request_response.<locals>.app at 0x0000020E37AF4AF0>
          └ APIRoute(path='/data/index', name='get_history_data', methods=['GET'])

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
          │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000020E37B7EDC0>
          │                            │    │        │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000020E37B42A60>
          │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8003), 'cl...
          │                            │    └ <starlette.requests.Request object at 0x0000020E37B9A3D0>
          │                            └ <function request_response.<locals>.app.<locals>.app at 0x0000020E37C9EDC0>
          └ <function wrap_app_handling_exceptions at 0x0000020E07D1A160>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000020E37C9ED30>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000020E37B42A60>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8003), 'cl...
          └ <function request_response.<locals>.app.<locals>.app at 0x0000020E37C9EDC0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
                     │ └ <starlette.requests.Request object at 0x0000020E37B9A3D0>
                     └ <function get_request_handler.<locals>.app at 0x0000020E37AF4D30>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x0000020E07D3F430>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'source': 'tushare', 'market': 'SH', 'code': '000001', 'start_date': '20050501', 'end_date': '20050520'}
                 │         └ <function get_history_data at 0x0000020E37AF4160>
                 └ Dependant(path_params=[], query_params=[ModelField(field_info=Query(akshare), name='source', mode='validation'), ModelField(f...

  File "C:\proj\ELSE\SELF\py-fastapi-demo\app\routers\router.py", line 15, in get_history_data
    df = data_service.get_stock_history(source=source, code=code, market=market, start_date=start_date, end_date=end_date)
         │            │                        │            │            │                  │                    └ '20050520'
         │            │                        │            │            │                  └ '20050501'
         │            │                        │            │            └ 'SH'
         │            │                        │            └ '000001'
         │            │                        └ 'tushare'
         │            └ <function get_stock_history at 0x0000020E07E53700>
         └ <module 'app.services.data_service' from 'C:\\proj\\ELSE\\SELF\\py-fastapi-demo\\app\\services\\data_service.py'>

> File "C:\proj\ELSE\SELF\py-fastapi-demo\app\services\data_service.py", line 23, in get_stock_history
    df = data_provider.get_stock_history(source=source, code=code, market=market, start_date=start_date, end_date=end_date)
         │             │                        │            │            │                  │                    └ '20050520'
         │             │                        │            │            │                  └ '20050501'
         │             │                        │            │            └ 'SH'
         │             │                        │            └ '000001'
         │             │                        └ 'tushare'
         │             └ <function catch.<locals>.decorator.<locals>.wrapper at 0x0000020E1890BC10>
         └ <data_providers.tushare.TushareProvider object at 0x0000020E37B9AD90>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\core\logger.py", line 28, in wrapper
    return func(*args, **kwargs_inner)
           │     │       └ {'source': 'tushare', 'code': '000001', 'market': 'SH', 'start_date': '20050501', 'end_date': '20050520'}
           │     └ (<data_providers.tushare.TushareProvider object at 0x0000020E37B9AD90>,)
           └ <function TushareProvider.get_stock_history at 0x0000020E1890BB80>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\data_providers\tushare.py", line 35, in get_stock_history
    raise RuntimeError(f"从 tushare 获取股票 {code} 数据失败: {str(e)}") from e

RuntimeError: 从 tushare 获取股票 000001 数据失败: 从 tushare 获取股票 000001 的数据为空
2025-07-02 17:04:03.050 | INFO     | app.services.data_service:get_stock_history:20 - [Bridge]获取股票历史行情数据并标准化输出格式 for 000001.SH from tushare
2025-07-02 17:04:03.055 | INFO     | data_providers.tushare:get_stock_history:25 - [Provider]source=tushare, code=000001, market=SH, start_date=20050501, end_date=20050520
2025-07-02 17:04:03.191 | INFO     | data_providers.tushare:get_stock_history:30 - [Provider]tushare 返回的数据列名: ['ts_code', 'trade_date', 'open', 'high', 'low', 'close', 'pre_close', 'change', 'pct_chg', 'vol', 'amount']
2025-07-02 17:04:03.192 | ERROR    | core.logger:wrapper:33 - 捕获异常: 从 tushare 获取股票 000001 数据失败: 从 tushare 获取股票 000001 的数据为空
Traceback (最近 2 层):
  File "C:\proj\ELSE\SELF\py-fastapi-demo\core\logger.py", line 28, in wrapper
    return func(*args, **kwargs_inner)
  File "C:\proj\ELSE\SELF\py-fastapi-demo\data_providers\tushare.py", line 35, in get_stock_history
    except Exception as e:

2025-07-02 17:04:03.193 | ERROR    | app.services.data_service:get_stock_history:74 - Error fetching stock history data
Traceback (most recent call last):

  File "C:\proj\ELSE\SELF\py-fastapi-demo\data_providers\tushare.py", line 32, in get_stock_history
    if df.empty:
       │  └ <property object at 0x0000020E17E1D1D0>
       └ Empty DataFrame
         Columns: [ts_code, trade_date, open, high, low, close, pre_close, change, pct_chg, vol, amount]
         Index: []

RuntimeError: 从 tushare 获取股票 000001 的数据为空


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "C:\else_env\Python39\lib\multiprocessing\spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 364
               │     └ 3
               └ <function _main at 0x0000020E04B46AF0>

  File "C:\else_env\Python39\lib\multiprocessing\spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 364
           │    └ <function BaseProcess._bootstrap at 0x0000020E047DB5E0>
           └ <SpawnProcess name='SpawnProcess-4' parent=56312 started>

  File "C:\else_env\Python39\lib\multiprocessing\process.py", line 315, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x0000020E047D6C10>
    └ <SpawnProcess name='SpawnProcess-4' parent=56312 started>

  File "C:\else_env\Python39\lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x0000020E0452B3D0>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-4' parent=56312 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-4' parent=56312 started>
    │    └ <function subprocess_started at 0x0000020E06CDF040>
    └ <SpawnProcess name='SpawnProcess-4' parent=56312 started>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\uvicorn\_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=804, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('127.0.0.1', 8003)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x0000020E043F6CD0>>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\uvicorn\server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=804, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('127.0.0.1', 8003)>]
           │       │   │    └ <function Server.serve at 0x0000020E06CA7040>
           │       │   └ <uvicorn.server.Server object at 0x0000020E043F6CD0>
           │       └ <function run at 0x0000020E04B43820>
           └ <module 'asyncio' from 'C:\\else_env\\Python39\\lib\\asyncio\\__init__.py'>

  File "C:\else_env\Python39\lib\asyncio\runners.py", line 44, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x0000020E06C9DA40>
           │    └ <function BaseEventLoop.run_until_complete at 0x0000020E064DE670>
           └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 629, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x0000020E064DE5E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 596, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x0000020E064E1160>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 1890, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x0000020E06470DC0>
    └ <Handle <TaskStepMethWrapper object at 0x0000020E37B418E0>()>

  File "C:\else_env\Python39\lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x0000020E37B418E0>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x0000020E37B418E0>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x0000020E37B418E0>()>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\base.py", line 141, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x0000020E37B7ECA0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000020E37B7ED30>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8003), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x0000020E37B147C0>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x0000020E37B14760>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x0000020E37B7ECA0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000020E37B7ED30>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8003), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x0000020E37B14700>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x0000020E37B147C0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
          │                            │    │    │     │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x0000020E37B7ECA0>
          │                            │    │    │     │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000020E37B7ED30>
          │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8003), 'cl...
          │                            │    │    └ <starlette.requests.Request object at 0x0000020E37B41700>
          │                            │    └ <fastapi.routing.APIRouter object at 0x0000020E07DDBBB0>
          │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x0000020E37B14700>
          └ <function wrap_app_handling_exceptions at 0x0000020E07D1A160>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000020E37C9EDC0>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000020E37B7ED30>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8003), 'cl...
          └ <fastapi.routing.APIRouter object at 0x0000020E07DDBBB0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000020E37C9EDC0>
          │    │                │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000020E37B7ED30>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8003), 'cl...
          │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0x0000020E07DDBBB0>>
          └ <fastapi.routing.APIRouter object at 0x0000020E07DDBBB0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 734, in app
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000020E37C9EDC0>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000020E37B7ED30>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8003), 'cl...
          │     └ <function Route.handle at 0x0000020E07D39820>
          └ APIRoute(path='/data/index', name='get_history_data', methods=['GET'])

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000020E37C9EDC0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000020E37B7ED30>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8003), 'cl...
          │    └ <function request_response.<locals>.app at 0x0000020E37AF4AF0>
          └ APIRoute(path='/data/index', name='get_history_data', methods=['GET'])

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
          │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000020E37C9EDC0>
          │                            │    │        │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000020E37B7ED30>
          │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8003), 'cl...
          │                            │    └ <starlette.requests.Request object at 0x0000020E37B2C3A0>
          │                            └ <function request_response.<locals>.app.<locals>.app at 0x0000020E37C9ED30>
          └ <function wrap_app_handling_exceptions at 0x0000020E07D1A160>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000020E37C9EEE0>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000020E37B7ED30>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8003), 'cl...
          └ <function request_response.<locals>.app.<locals>.app at 0x0000020E37C9ED30>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
                     │ └ <starlette.requests.Request object at 0x0000020E37B2C3A0>
                     └ <function get_request_handler.<locals>.app at 0x0000020E37AF4D30>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x0000020E07D3F430>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'source': 'tushare', 'market': 'SH', 'code': '000001', 'start_date': '20050501', 'end_date': '20050520'}
                 │         └ <function get_history_data at 0x0000020E37AF4160>
                 └ Dependant(path_params=[], query_params=[ModelField(field_info=Query(akshare), name='source', mode='validation'), ModelField(f...

  File "C:\proj\ELSE\SELF\py-fastapi-demo\app\routers\router.py", line 15, in get_history_data
    df = data_service.get_stock_history(source=source, code=code, market=market, start_date=start_date, end_date=end_date)
         │            │                        │            │            │                  │                    └ '20050520'
         │            │                        │            │            │                  └ '20050501'
         │            │                        │            │            └ 'SH'
         │            │                        │            └ '000001'
         │            │                        └ 'tushare'
         │            └ <function get_stock_history at 0x0000020E07E53700>
         └ <module 'app.services.data_service' from 'C:\\proj\\ELSE\\SELF\\py-fastapi-demo\\app\\services\\data_service.py'>

> File "C:\proj\ELSE\SELF\py-fastapi-demo\app\services\data_service.py", line 23, in get_stock_history
    df = data_provider.get_stock_history(source=source, code=code, market=market, start_date=start_date, end_date=end_date)
         │             │                        │            │            │                  │                    └ '20050520'
         │             │                        │            │            │                  └ '20050501'
         │             │                        │            │            └ 'SH'
         │             │                        │            └ '000001'
         │             │                        └ 'tushare'
         │             └ <function catch.<locals>.decorator.<locals>.wrapper at 0x0000020E1890BC10>
         └ <data_providers.tushare.TushareProvider object at 0x0000020E37B9A9A0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\core\logger.py", line 28, in wrapper
    return func(*args, **kwargs_inner)
           │     │       └ {'source': 'tushare', 'code': '000001', 'market': 'SH', 'start_date': '20050501', 'end_date': '20050520'}
           │     └ (<data_providers.tushare.TushareProvider object at 0x0000020E37B9A9A0>,)
           └ <function TushareProvider.get_stock_history at 0x0000020E1890BB80>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\data_providers\tushare.py", line 35, in get_stock_history
    except Exception as e:

RuntimeError: 从 tushare 获取股票 000001 数据失败: 从 tushare 获取股票 000001 的数据为空
2025-07-02 17:12:13.948 | INFO     | app.services.data_service:get_stock_history:20 - [Bridge]获取股票历史行情数据并标准化输出格式 for 000001.SH from tushare
2025-07-02 17:12:13.954 | INFO     | data_providers.tushare:get_stock_history:25 - [Provider]source=tushare, code=000001, market=SH, start_date=20050501, end_date=20050520
2025-07-02 17:12:14.063 | INFO     | data_providers.tushare:get_stock_history:30 - [Provider]tushare 返回的数据列名: ['ts_code', 'trade_date', 'open', 'high', 'low', 'close', 'pre_close', 'change', 'pct_chg', 'vol', 'amount']
2025-07-02 17:12:14.063 | ERROR    | core.logger:wrapper:33 - 捕获异常: 从 tushare 获取股票 000001 数据失败: 从 tushare 获取股票 000001 的数据为空
Traceback (最近 2 层):
  File "C:\proj\ELSE\SELF\py-fastapi-demo\core\logger.py", line 28, in wrapper
    return func(*args, **kwargs_inner)
  File "C:\proj\ELSE\SELF\py-fastapi-demo\data_providers\tushare.py", line 35, in get_stock_history
    :param source: 数据源名称（如 'tushare'）

2025-07-02 17:12:14.063 | ERROR    | app.services.data_service:get_stock_history:74 - Error fetching stock history data
Traceback (most recent call last):

  File "C:\proj\ELSE\SELF\py-fastapi-demo\data_providers\tushare.py", line 32, in get_stock_history
    def get_macro_gdp_data(self, source):
                           │     └ 'tushare'
                           └ <data_providers.tushare.TushareProvider object at 0x0000020E37B9A1F0>

RuntimeError: 从 tushare 获取股票 000001 的数据为空


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "C:\else_env\Python39\lib\multiprocessing\spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 364
               │     └ 3
               └ <function _main at 0x0000020E04B46AF0>

  File "C:\else_env\Python39\lib\multiprocessing\spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 364
           │    └ <function BaseProcess._bootstrap at 0x0000020E047DB5E0>
           └ <SpawnProcess name='SpawnProcess-4' parent=56312 started>

  File "C:\else_env\Python39\lib\multiprocessing\process.py", line 315, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x0000020E047D6C10>
    └ <SpawnProcess name='SpawnProcess-4' parent=56312 started>

  File "C:\else_env\Python39\lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x0000020E0452B3D0>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-4' parent=56312 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-4' parent=56312 started>
    │    └ <function subprocess_started at 0x0000020E06CDF040>
    └ <SpawnProcess name='SpawnProcess-4' parent=56312 started>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\uvicorn\_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=804, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('127.0.0.1', 8003)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x0000020E043F6CD0>>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\uvicorn\server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=804, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('127.0.0.1', 8003)>]
           │       │   │    └ <function Server.serve at 0x0000020E06CA7040>
           │       │   └ <uvicorn.server.Server object at 0x0000020E043F6CD0>
           │       └ <function run at 0x0000020E04B43820>
           └ <module 'asyncio' from 'C:\\else_env\\Python39\\lib\\asyncio\\__init__.py'>

  File "C:\else_env\Python39\lib\asyncio\runners.py", line 44, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x0000020E06C9DA40>
           │    └ <function BaseEventLoop.run_until_complete at 0x0000020E064DE670>
           └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 629, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x0000020E064DE5E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 596, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x0000020E064E1160>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 1890, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x0000020E06470DC0>
    └ <Handle <TaskStepMethWrapper object at 0x0000020E37B5F7C0>()>

  File "C:\else_env\Python39\lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x0000020E37B5F7C0>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x0000020E37B5F7C0>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x0000020E37B5F7C0>()>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\base.py", line 141, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x0000020E37B7EDC0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000020E37B7ED30>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8003), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x0000020E37B147C0>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x0000020E37B14760>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x0000020E37B7EDC0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000020E37B7ED30>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8003), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x0000020E37B14700>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x0000020E37B147C0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
          │                            │    │    │     │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x0000020E37B7EDC0>
          │                            │    │    │     │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000020E37B7ED30>
          │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8003), 'cl...
          │                            │    │    └ <starlette.requests.Request object at 0x0000020E37B5F940>
          │                            │    └ <fastapi.routing.APIRouter object at 0x0000020E07DDBBB0>
          │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x0000020E37B14700>
          └ <function wrap_app_handling_exceptions at 0x0000020E07D1A160>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000020E37C9EEE0>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000020E37B7ED30>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8003), 'cl...
          └ <fastapi.routing.APIRouter object at 0x0000020E07DDBBB0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000020E37C9EEE0>
          │    │                │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000020E37B7ED30>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8003), 'cl...
          │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0x0000020E07DDBBB0>>
          └ <fastapi.routing.APIRouter object at 0x0000020E07DDBBB0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 734, in app
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000020E37C9EEE0>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000020E37B7ED30>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8003), 'cl...
          │     └ <function Route.handle at 0x0000020E07D39820>
          └ APIRoute(path='/data/index', name='get_history_data', methods=['GET'])

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000020E37C9EEE0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000020E37B7ED30>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8003), 'cl...
          │    └ <function request_response.<locals>.app at 0x0000020E37AF4AF0>
          └ APIRoute(path='/data/index', name='get_history_data', methods=['GET'])

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
          │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000020E37C9EEE0>
          │                            │    │        │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000020E37B7ED30>
          │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8003), 'cl...
          │                            │    └ <starlette.requests.Request object at 0x0000020E37B5F310>
          │                            └ <function request_response.<locals>.app.<locals>.app at 0x0000020E37C9EF70>
          └ <function wrap_app_handling_exceptions at 0x0000020E07D1A160>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000020E37B139D0>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000020E37B7ED30>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8003), 'cl...
          └ <function request_response.<locals>.app.<locals>.app at 0x0000020E37C9EF70>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
                     │ └ <starlette.requests.Request object at 0x0000020E37B5F310>
                     └ <function get_request_handler.<locals>.app at 0x0000020E37AF4D30>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x0000020E07D3F430>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'source': 'tushare', 'market': 'SH', 'code': '000001', 'start_date': '20050501', 'end_date': '20050520'}
                 │         └ <function get_history_data at 0x0000020E37AF4160>
                 └ Dependant(path_params=[], query_params=[ModelField(field_info=Query(akshare), name='source', mode='validation'), ModelField(f...

  File "C:\proj\ELSE\SELF\py-fastapi-demo\app\routers\router.py", line 15, in get_history_data
    df = data_service.get_stock_history(source=source, code=code, market=market, start_date=start_date, end_date=end_date)
         │            │                        │            │            │                  │                    └ '20050520'
         │            │                        │            │            │                  └ '20050501'
         │            │                        │            │            └ 'SH'
         │            │                        │            └ '000001'
         │            │                        └ 'tushare'
         │            └ <function get_stock_history at 0x0000020E07E53700>
         └ <module 'app.services.data_service' from 'C:\\proj\\ELSE\\SELF\\py-fastapi-demo\\app\\services\\data_service.py'>

> File "C:\proj\ELSE\SELF\py-fastapi-demo\app\services\data_service.py", line 23, in get_stock_history
    df = data_provider.get_stock_history(source=source, code=code, market=market, start_date=start_date, end_date=end_date)
         │             │                        │            │            │                  │                    └ '20050520'
         │             │                        │            │            │                  └ '20050501'
         │             │                        │            │            └ 'SH'
         │             │                        │            └ '000001'
         │             │                        └ 'tushare'
         │             └ <function catch.<locals>.decorator.<locals>.wrapper at 0x0000020E1890BC10>
         └ <data_providers.tushare.TushareProvider object at 0x0000020E37B9A1F0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\core\logger.py", line 28, in wrapper
    return func(*args, **kwargs_inner)
           │     │       └ {'source': 'tushare', 'code': '000001', 'market': 'SH', 'start_date': '20050501', 'end_date': '20050520'}
           │     └ (<data_providers.tushare.TushareProvider object at 0x0000020E37B9A1F0>,)
           └ <function TushareProvider.get_stock_history at 0x0000020E1890BB80>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\data_providers\tushare.py", line 35, in get_stock_history
    :param source: 数据源名称（如 'tushare'）
           └ 'tushare'

RuntimeError: 从 tushare 获取股票 000001 数据失败: 从 tushare 获取股票 000001 的数据为空
2025-07-02 17:13:32.520 | INFO     | app.services.data_service:get_stock_history:20 - [Bridge]获取股票历史行情数据并标准化输出格式 for 000001.SH from tushare
2025-07-02 17:13:32.524 | INFO     | data_providers.tushare:get_stock_history:25 - [Provider]source=tushare, code=000001, market=SH, start_date=20050501, end_date=20050520
2025-07-02 17:13:32.621 | INFO     | data_providers.tushare:get_stock_history:30 - [Provider]tushare 返回的数据列名: ['ts_code', 'trade_date', 'open', 'high', 'low', 'close', 'pre_close', 'change', 'pct_chg', 'vol', 'amount']
2025-07-02 17:13:32.622 | ERROR    | core.logger:wrapper:33 - 捕获异常: 从 tushare 获取股票 000001 数据失败: 从 tushare 获取股票 000001 的数据为空
Traceback (最近 2 层):
  File "C:\proj\ELSE\SELF\py-fastapi-demo\core\logger.py", line 28, in wrapper
    return func(*args, **kwargs_inner)
  File "C:\proj\ELSE\SELF\py-fastapi-demo\data_providers\tushare.py", line 35, in get_stock_history
    获取宏观GDP数据

2025-07-02 17:13:32.622 | ERROR    | app.services.data_service:get_stock_history:74 - Error fetching stock history data
Traceback (most recent call last):

  File "C:\proj\ELSE\SELF\py-fastapi-demo\data_providers\tushare.py", line 32, in get_stock_history
    @catch(depth=2)
     └ <function catch at 0x0000020E07DE1430>

RuntimeError: 从 tushare 获取股票 000001 的数据为空


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "C:\else_env\Python39\lib\multiprocessing\spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 364
               │     └ 3
               └ <function _main at 0x0000020E04B46AF0>

  File "C:\else_env\Python39\lib\multiprocessing\spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 364
           │    └ <function BaseProcess._bootstrap at 0x0000020E047DB5E0>
           └ <SpawnProcess name='SpawnProcess-4' parent=56312 started>

  File "C:\else_env\Python39\lib\multiprocessing\process.py", line 315, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x0000020E047D6C10>
    └ <SpawnProcess name='SpawnProcess-4' parent=56312 started>

  File "C:\else_env\Python39\lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x0000020E0452B3D0>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-4' parent=56312 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-4' parent=56312 started>
    │    └ <function subprocess_started at 0x0000020E06CDF040>
    └ <SpawnProcess name='SpawnProcess-4' parent=56312 started>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\uvicorn\_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=804, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('127.0.0.1', 8003)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x0000020E043F6CD0>>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\uvicorn\server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=804, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('127.0.0.1', 8003)>]
           │       │   │    └ <function Server.serve at 0x0000020E06CA7040>
           │       │   └ <uvicorn.server.Server object at 0x0000020E043F6CD0>
           │       └ <function run at 0x0000020E04B43820>
           └ <module 'asyncio' from 'C:\\else_env\\Python39\\lib\\asyncio\\__init__.py'>

  File "C:\else_env\Python39\lib\asyncio\runners.py", line 44, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x0000020E06C9DA40>
           │    └ <function BaseEventLoop.run_until_complete at 0x0000020E064DE670>
           └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 629, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x0000020E064DE5E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 596, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x0000020E064E1160>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 1890, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x0000020E06470DC0>
    └ <Handle <TaskStepMethWrapper object at 0x0000020E37B17A00>()>

  File "C:\else_env\Python39\lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x0000020E37B17A00>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x0000020E37B17A00>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x0000020E37B17A00>()>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\base.py", line 141, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x0000020E37C9ED30>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000020E37C9EDC0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8003), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x0000020E37B147C0>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x0000020E37B14760>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x0000020E37C9ED30>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000020E37C9EDC0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8003), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x0000020E37B14700>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x0000020E37B147C0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
          │                            │    │    │     │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x0000020E37C9ED30>
          │                            │    │    │     │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000020E37C9EDC0>
          │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8003), 'cl...
          │                            │    │    └ <starlette.requests.Request object at 0x0000020E37B9A220>
          │                            │    └ <fastapi.routing.APIRouter object at 0x0000020E07DDBBB0>
          │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x0000020E37B14700>
          └ <function wrap_app_handling_exceptions at 0x0000020E07D1A160>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000020E37B139D0>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000020E37C9EDC0>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8003), 'cl...
          └ <fastapi.routing.APIRouter object at 0x0000020E07DDBBB0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000020E37B139D0>
          │    │                │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000020E37C9EDC0>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8003), 'cl...
          │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0x0000020E07DDBBB0>>
          └ <fastapi.routing.APIRouter object at 0x0000020E07DDBBB0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 734, in app
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000020E37B139D0>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000020E37C9EDC0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8003), 'cl...
          │     └ <function Route.handle at 0x0000020E07D39820>
          └ APIRoute(path='/data/index', name='get_history_data', methods=['GET'])

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000020E37B139D0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000020E37C9EDC0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8003), 'cl...
          │    └ <function request_response.<locals>.app at 0x0000020E37AF4AF0>
          └ APIRoute(path='/data/index', name='get_history_data', methods=['GET'])

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
          │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000020E37B139D0>
          │                            │    │        │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000020E37C9EDC0>
          │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8003), 'cl...
          │                            │    └ <starlette.requests.Request object at 0x0000020E37B9AE20>
          │                            └ <function request_response.<locals>.app.<locals>.app at 0x0000020E37B138B0>
          └ <function wrap_app_handling_exceptions at 0x0000020E07D1A160>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000020E37CCB820>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000020E37C9EDC0>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8003), 'cl...
          └ <function request_response.<locals>.app.<locals>.app at 0x0000020E37B138B0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
                     │ └ <starlette.requests.Request object at 0x0000020E37B9AE20>
                     └ <function get_request_handler.<locals>.app at 0x0000020E37AF4D30>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x0000020E07D3F430>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'source': 'tushare', 'market': 'SH', 'code': '000001', 'start_date': '20050501', 'end_date': '20050520'}
                 │         └ <function get_history_data at 0x0000020E37AF4160>
                 └ Dependant(path_params=[], query_params=[ModelField(field_info=Query(akshare), name='source', mode='validation'), ModelField(f...

  File "C:\proj\ELSE\SELF\py-fastapi-demo\app\routers\router.py", line 15, in get_history_data
    df = data_service.get_stock_history(source=source, code=code, market=market, start_date=start_date, end_date=end_date)
         │            │                        │            │            │                  │                    └ '20050520'
         │            │                        │            │            │                  └ '20050501'
         │            │                        │            │            └ 'SH'
         │            │                        │            └ '000001'
         │            │                        └ 'tushare'
         │            └ <function get_stock_history at 0x0000020E07E53700>
         └ <module 'app.services.data_service' from 'C:\\proj\\ELSE\\SELF\\py-fastapi-demo\\app\\services\\data_service.py'>

> File "C:\proj\ELSE\SELF\py-fastapi-demo\app\services\data_service.py", line 23, in get_stock_history
    df = data_provider.get_stock_history(source=source, code=code, market=market, start_date=start_date, end_date=end_date)
         │             │                        │            │            │                  │                    └ '20050520'
         │             │                        │            │            │                  └ '20050501'
         │             │                        │            │            └ 'SH'
         │             │                        │            └ '000001'
         │             │                        └ 'tushare'
         │             └ <function catch.<locals>.decorator.<locals>.wrapper at 0x0000020E1890BC10>
         └ <data_providers.tushare.TushareProvider object at 0x0000020E37CC83A0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\core\logger.py", line 28, in wrapper
    return func(*args, **kwargs_inner)
           │     │       └ {'source': 'tushare', 'code': '000001', 'market': 'SH', 'start_date': '20050501', 'end_date': '20050520'}
           │     └ (<data_providers.tushare.TushareProvider object at 0x0000020E37CC83A0>,)
           └ <function TushareProvider.get_stock_history at 0x0000020E1890BB80>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\data_providers\tushare.py", line 35, in get_stock_history
    获取宏观GDP数据

RuntimeError: 从 tushare 获取股票 000001 数据失败: 从 tushare 获取股票 000001 的数据为空
2025-07-02 17:13:53.723 | INFO     | app.services.data_service:get_stock_history:20 - [Bridge]获取股票历史行情数据并标准化输出格式 for 000001.SH from tushare
2025-07-02 17:13:53.726 | INFO     | data_providers.tushare:get_stock_history:25 - [Provider]source=tushare, code=000001, market=SH, start_date=20050501, end_date=20050520
2025-07-02 17:13:53.833 | INFO     | data_providers.tushare:get_stock_history:30 - [Provider]tushare 返回的数据列名: ['ts_code', 'trade_date', 'open', 'high', 'low', 'close', 'pre_close', 'change', 'pct_chg', 'vol', 'amount']
2025-07-02 17:13:53.834 | ERROR    | core.logger:wrapper:33 - 捕获异常: 从 tushare 获取股票 000001 数据失败: 从 tushare 获取股票 000001 的数据为空
Traceback (最近 2 层):
  File "C:\proj\ELSE\SELF\py-fastapi-demo\core\logger.py", line 28, in wrapper
    return func(*args, **kwargs_inner)
  File "C:\proj\ELSE\SELF\py-fastapi-demo\data_providers\tushare.py", line 35, in get_stock_history
    :return: DataFrame

2025-07-02 17:13:53.834 | ERROR    | app.services.data_service:get_stock_history:74 - Error fetching stock history data
Traceback (most recent call last):

  File "C:\proj\ELSE\SELF\py-fastapi-demo\data_providers\tushare.py", line 32, in get_stock_history
    """

RuntimeError: 从 tushare 获取股票 000001 的数据为空


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "C:\else_env\Python39\lib\multiprocessing\spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 364
               │     └ 3
               └ <function _main at 0x0000020E04B46AF0>

  File "C:\else_env\Python39\lib\multiprocessing\spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 364
           │    └ <function BaseProcess._bootstrap at 0x0000020E047DB5E0>
           └ <SpawnProcess name='SpawnProcess-4' parent=56312 started>

  File "C:\else_env\Python39\lib\multiprocessing\process.py", line 315, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x0000020E047D6C10>
    └ <SpawnProcess name='SpawnProcess-4' parent=56312 started>

  File "C:\else_env\Python39\lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x0000020E0452B3D0>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-4' parent=56312 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-4' parent=56312 started>
    │    └ <function subprocess_started at 0x0000020E06CDF040>
    └ <SpawnProcess name='SpawnProcess-4' parent=56312 started>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\uvicorn\_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=804, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('127.0.0.1', 8003)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x0000020E043F6CD0>>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\uvicorn\server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=804, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('127.0.0.1', 8003)>]
           │       │   │    └ <function Server.serve at 0x0000020E06CA7040>
           │       │   └ <uvicorn.server.Server object at 0x0000020E043F6CD0>
           │       └ <function run at 0x0000020E04B43820>
           └ <module 'asyncio' from 'C:\\else_env\\Python39\\lib\\asyncio\\__init__.py'>

  File "C:\else_env\Python39\lib\asyncio\runners.py", line 44, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x0000020E06C9DA40>
           │    └ <function BaseEventLoop.run_until_complete at 0x0000020E064DE670>
           └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 629, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x0000020E064DE5E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 596, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x0000020E064E1160>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 1890, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x0000020E06470DC0>
    └ <Handle <TaskStepMethWrapper object at 0x0000020E37CC86A0>()>

  File "C:\else_env\Python39\lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x0000020E37CC86A0>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x0000020E37CC86A0>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x0000020E37CC86A0>()>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\base.py", line 141, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x0000020E37C9EE50>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000020E37C9EF70>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8003), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x0000020E37B147C0>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x0000020E37B14760>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x0000020E37C9EE50>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000020E37C9EF70>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8003), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x0000020E37B14700>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x0000020E37B147C0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
          │                            │    │    │     │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x0000020E37C9EE50>
          │                            │    │    │     │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000020E37C9EF70>
          │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8003), 'cl...
          │                            │    │    └ <starlette.requests.Request object at 0x0000020E37CC8C40>
          │                            │    └ <fastapi.routing.APIRouter object at 0x0000020E07DDBBB0>
          │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x0000020E37B14700>
          └ <function wrap_app_handling_exceptions at 0x0000020E07D1A160>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000020E37B925E0>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000020E37C9EF70>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8003), 'cl...
          └ <fastapi.routing.APIRouter object at 0x0000020E07DDBBB0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000020E37B925E0>
          │    │                │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000020E37C9EF70>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8003), 'cl...
          │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0x0000020E07DDBBB0>>
          └ <fastapi.routing.APIRouter object at 0x0000020E07DDBBB0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 734, in app
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000020E37B925E0>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000020E37C9EF70>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8003), 'cl...
          │     └ <function Route.handle at 0x0000020E07D39820>
          └ APIRoute(path='/data/index', name='get_history_data', methods=['GET'])

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000020E37B925E0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000020E37C9EF70>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8003), 'cl...
          │    └ <function request_response.<locals>.app at 0x0000020E37AF4AF0>
          └ APIRoute(path='/data/index', name='get_history_data', methods=['GET'])

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
          │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000020E37B925E0>
          │                            │    │        │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000020E37C9EF70>
          │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8003), 'cl...
          │                            │    └ <starlette.requests.Request object at 0x0000020E37CC85B0>
          │                            └ <function request_response.<locals>.app.<locals>.app at 0x0000020E37B924C0>
          └ <function wrap_app_handling_exceptions at 0x0000020E07D1A160>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000020E37B420D0>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000020E37C9EF70>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8003), 'cl...
          └ <function request_response.<locals>.app.<locals>.app at 0x0000020E37B924C0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
                     │ └ <starlette.requests.Request object at 0x0000020E37CC85B0>
                     └ <function get_request_handler.<locals>.app at 0x0000020E37AF4D30>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x0000020E07D3F430>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'source': 'tushare', 'market': 'SH', 'code': '000001', 'start_date': '20050501', 'end_date': '20050520'}
                 │         └ <function get_history_data at 0x0000020E37AF4160>
                 └ Dependant(path_params=[], query_params=[ModelField(field_info=Query(akshare), name='source', mode='validation'), ModelField(f...

  File "C:\proj\ELSE\SELF\py-fastapi-demo\app\routers\router.py", line 15, in get_history_data
    df = data_service.get_stock_history(source=source, code=code, market=market, start_date=start_date, end_date=end_date)
         │            │                        │            │            │                  │                    └ '20050520'
         │            │                        │            │            │                  └ '20050501'
         │            │                        │            │            └ 'SH'
         │            │                        │            └ '000001'
         │            │                        └ 'tushare'
         │            └ <function get_stock_history at 0x0000020E07E53700>
         └ <module 'app.services.data_service' from 'C:\\proj\\ELSE\\SELF\\py-fastapi-demo\\app\\services\\data_service.py'>

> File "C:\proj\ELSE\SELF\py-fastapi-demo\app\services\data_service.py", line 23, in get_stock_history
    df = data_provider.get_stock_history(source=source, code=code, market=market, start_date=start_date, end_date=end_date)
         │             │                        │            │            │                  │                    └ '20050520'
         │             │                        │            │            │                  └ '20050501'
         │             │                        │            │            └ 'SH'
         │             │                        │            └ '000001'
         │             │                        └ 'tushare'
         │             └ <function catch.<locals>.decorator.<locals>.wrapper at 0x0000020E1890BC10>
         └ <data_providers.tushare.TushareProvider object at 0x0000020E37CC8130>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\core\logger.py", line 28, in wrapper
    return func(*args, **kwargs_inner)
           │     │       └ {'source': 'tushare', 'code': '000001', 'market': 'SH', 'start_date': '20050501', 'end_date': '20050520'}
           │     └ (<data_providers.tushare.TushareProvider object at 0x0000020E37CC8130>,)
           └ <function TushareProvider.get_stock_history at 0x0000020E1890BB80>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\data_providers\tushare.py", line 35, in get_stock_history
    :return: DataFrame

RuntimeError: 从 tushare 获取股票 000001 数据失败: 从 tushare 获取股票 000001 的数据为空
2025-07-02 17:14:42.411 | INFO     | app.services.data_service:get_stock_history:20 - [Bridge]获取股票历史行情数据并标准化输出格式 for 000001.SH from tushare
2025-07-02 17:14:42.414 | INFO     | data_providers.tushare:get_stock_history:25 - [Provider]source=tushare, code=000001, market=SH, start_date=20050501, end_date=20050520
2025-07-02 17:14:42.529 | INFO     | data_providers.tushare:get_stock_history:30 - [Provider]tushare 返回的数据列名: ['ts_code', 'trade_date', 'open', 'high', 'low', 'close', 'pre_close', 'change', 'pct_chg', 'vol', 'amount']
2025-07-02 17:14:42.530 | ERROR    | core.logger:wrapper:33 - 捕获异常: 从 tushare 获取股票 000001 数据失败: 从 tushare 获取股票 000001 的数据为空
Traceback (最近 2 层):
  File "C:\proj\ELSE\SELF\py-fastapi-demo\core\logger.py", line 28, in wrapper
    return func(*args, **kwargs_inner)
  File "C:\proj\ELSE\SELF\py-fastapi-demo\data_providers\tushare.py", line 35, in get_stock_history
    :return: DataFrame

2025-07-02 17:14:42.531 | ERROR    | app.services.data_service:get_stock_history:74 - Error fetching stock history data
Traceback (most recent call last):

  File "C:\proj\ELSE\SELF\py-fastapi-demo\data_providers\tushare.py", line 32, in get_stock_history
    """

RuntimeError: 从 tushare 获取股票 000001 的数据为空


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "C:\else_env\Python39\lib\multiprocessing\spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 364
               │     └ 3
               └ <function _main at 0x0000020E04B46AF0>

  File "C:\else_env\Python39\lib\multiprocessing\spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 364
           │    └ <function BaseProcess._bootstrap at 0x0000020E047DB5E0>
           └ <SpawnProcess name='SpawnProcess-4' parent=56312 started>

  File "C:\else_env\Python39\lib\multiprocessing\process.py", line 315, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x0000020E047D6C10>
    └ <SpawnProcess name='SpawnProcess-4' parent=56312 started>

  File "C:\else_env\Python39\lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x0000020E0452B3D0>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-4' parent=56312 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-4' parent=56312 started>
    │    └ <function subprocess_started at 0x0000020E06CDF040>
    └ <SpawnProcess name='SpawnProcess-4' parent=56312 started>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\uvicorn\_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=804, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('127.0.0.1', 8003)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x0000020E043F6CD0>>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\uvicorn\server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=804, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('127.0.0.1', 8003)>]
           │       │   │    └ <function Server.serve at 0x0000020E06CA7040>
           │       │   └ <uvicorn.server.Server object at 0x0000020E043F6CD0>
           │       └ <function run at 0x0000020E04B43820>
           └ <module 'asyncio' from 'C:\\else_env\\Python39\\lib\\asyncio\\__init__.py'>

  File "C:\else_env\Python39\lib\asyncio\runners.py", line 44, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x0000020E06C9DA40>
           │    └ <function BaseEventLoop.run_until_complete at 0x0000020E064DE670>
           └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 629, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x0000020E064DE5E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 596, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x0000020E064E1160>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 1890, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x0000020E06470DC0>
    └ <Handle <TaskStepMethWrapper object at 0x0000020E37B9A250>()>

  File "C:\else_env\Python39\lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x0000020E37B9A250>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x0000020E37B9A250>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x0000020E37B9A250>()>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\base.py", line 141, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x0000020E37C9EEE0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000020E37C9EDC0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8003), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x0000020E37B147C0>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x0000020E37B14760>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x0000020E37C9EEE0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000020E37C9EDC0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8003), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x0000020E37B14700>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x0000020E37B147C0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
          │                            │    │    │     │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x0000020E37C9EEE0>
          │                            │    │    │     │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000020E37C9EDC0>
          │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8003), 'cl...
          │                            │    │    └ <starlette.requests.Request object at 0x0000020E37B9A580>
          │                            │    └ <fastapi.routing.APIRouter object at 0x0000020E07DDBBB0>
          │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x0000020E37B14700>
          └ <function wrap_app_handling_exceptions at 0x0000020E07D1A160>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000020E37B421F0>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000020E37C9EDC0>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8003), 'cl...
          └ <fastapi.routing.APIRouter object at 0x0000020E07DDBBB0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000020E37B421F0>
          │    │                │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000020E37C9EDC0>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8003), 'cl...
          │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0x0000020E07DDBBB0>>
          └ <fastapi.routing.APIRouter object at 0x0000020E07DDBBB0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 734, in app
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000020E37B421F0>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000020E37C9EDC0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8003), 'cl...
          │     └ <function Route.handle at 0x0000020E07D39820>
          └ APIRoute(path='/data/index', name='get_history_data', methods=['GET'])

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000020E37B421F0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000020E37C9EDC0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8003), 'cl...
          │    └ <function request_response.<locals>.app at 0x0000020E37AF4AF0>
          └ APIRoute(path='/data/index', name='get_history_data', methods=['GET'])

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
          │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000020E37B421F0>
          │                            │    │        │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000020E37C9EDC0>
          │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8003), 'cl...
          │                            │    └ <starlette.requests.Request object at 0x0000020E37B9A460>
          │                            └ <function request_response.<locals>.app.<locals>.app at 0x0000020E37B420D0>
          └ <function wrap_app_handling_exceptions at 0x0000020E07D1A160>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000020E37B42A60>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000020E37C9EDC0>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8003), 'cl...
          └ <function request_response.<locals>.app.<locals>.app at 0x0000020E37B420D0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
                     │ └ <starlette.requests.Request object at 0x0000020E37B9A460>
                     └ <function get_request_handler.<locals>.app at 0x0000020E37AF4D30>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x0000020E07D3F430>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'source': 'tushare', 'market': 'SH', 'code': '000001', 'start_date': '20050501', 'end_date': '20050520'}
                 │         └ <function get_history_data at 0x0000020E37AF4160>
                 └ Dependant(path_params=[], query_params=[ModelField(field_info=Query(akshare), name='source', mode='validation'), ModelField(f...

  File "C:\proj\ELSE\SELF\py-fastapi-demo\app\routers\router.py", line 15, in get_history_data
    df = data_service.get_stock_history(source=source, code=code, market=market, start_date=start_date, end_date=end_date)
         │            │                        │            │            │                  │                    └ '20050520'
         │            │                        │            │            │                  └ '20050501'
         │            │                        │            │            └ 'SH'
         │            │                        │            └ '000001'
         │            │                        └ 'tushare'
         │            └ <function get_stock_history at 0x0000020E07E53700>
         └ <module 'app.services.data_service' from 'C:\\proj\\ELSE\\SELF\\py-fastapi-demo\\app\\services\\data_service.py'>

> File "C:\proj\ELSE\SELF\py-fastapi-demo\app\services\data_service.py", line 23, in get_stock_history
    df = data_provider.get_stock_history(source=source, code=code, market=market, start_date=start_date, end_date=end_date)
         │             │                        │            │            │                  │                    └ '20050520'
         │             │                        │            │            │                  └ '20050501'
         │             │                        │            │            └ 'SH'
         │             │                        │            └ '000001'
         │             │                        └ 'tushare'
         │             └ <function catch.<locals>.decorator.<locals>.wrapper at 0x0000020E1890BC10>
         └ <data_providers.tushare.TushareProvider object at 0x0000020E37CC8D00>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\core\logger.py", line 28, in wrapper
    return func(*args, **kwargs_inner)
           │     │       └ {'source': 'tushare', 'code': '000001', 'market': 'SH', 'start_date': '20050501', 'end_date': '20050520'}
           │     └ (<data_providers.tushare.TushareProvider object at 0x0000020E37CC8D00>,)
           └ <function TushareProvider.get_stock_history at 0x0000020E1890BB80>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\data_providers\tushare.py", line 35, in get_stock_history
    :return: DataFrame

RuntimeError: 从 tushare 获取股票 000001 数据失败: 从 tushare 获取股票 000001 的数据为空
2025-07-02 17:15:18.876 | INFO     | app.services.data_service:get_stock_history:20 - [Bridge]获取股票历史行情数据并标准化输出格式 for 000001.SH from tushare
2025-07-02 17:15:18.881 | INFO     | data_providers.tushare:get_stock_history:25 - [Provider]source=tushare, code=000001, market=SH, start_date=20050501, end_date=20050520
2025-07-02 17:15:18.991 | INFO     | data_providers.tushare:get_stock_history:30 - [Provider]tushare 返回的数据列名: ['ts_code', 'trade_date', 'open', 'high', 'low', 'close', 'pre_close', 'change', 'pct_chg', 'vol', 'amount']
2025-07-02 17:15:18.992 | ERROR    | core.logger:wrapper:33 - 捕获异常: 从 tushare 获取股票 000001 数据失败: 从 tushare 获取股票 000001 的数据为空
Traceback (最近 2 层):
  File "C:\proj\ELSE\SELF\py-fastapi-demo\core\logger.py", line 28, in wrapper
  File "C:\proj\ELSE\SELF\py-fastapi-demo\data_providers\tushare.py", line 35, in get_stock_history
    :return: DataFrame

2025-07-02 17:15:18.992 | ERROR    | app.services.data_service:get_stock_history:74 - Error fetching stock history data
Traceback (most recent call last):

  File "C:\proj\ELSE\SELF\py-fastapi-demo\data_providers\tushare.py", line 32, in get_stock_history
    """

RuntimeError: 从 tushare 获取股票 000001 的数据为空


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "C:\else_env\Python39\lib\multiprocessing\spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 364
               │     └ 3
               └ <function _main at 0x0000020E04B46AF0>

  File "C:\else_env\Python39\lib\multiprocessing\spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 364
           │    └ <function BaseProcess._bootstrap at 0x0000020E047DB5E0>
           └ <SpawnProcess name='SpawnProcess-4' parent=56312 started>

  File "C:\else_env\Python39\lib\multiprocessing\process.py", line 315, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x0000020E047D6C10>
    └ <SpawnProcess name='SpawnProcess-4' parent=56312 started>

  File "C:\else_env\Python39\lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x0000020E0452B3D0>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-4' parent=56312 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-4' parent=56312 started>
    │    └ <function subprocess_started at 0x0000020E06CDF040>
    └ <SpawnProcess name='SpawnProcess-4' parent=56312 started>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\uvicorn\_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=804, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('127.0.0.1', 8003)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x0000020E043F6CD0>>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\uvicorn\server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=804, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=6, laddr=('127.0.0.1', 8003)>]
           │       │   │    └ <function Server.serve at 0x0000020E06CA7040>
           │       │   └ <uvicorn.server.Server object at 0x0000020E043F6CD0>
           │       └ <function run at 0x0000020E04B43820>
           └ <module 'asyncio' from 'C:\\else_env\\Python39\\lib\\asyncio\\__init__.py'>

  File "C:\else_env\Python39\lib\asyncio\runners.py", line 44, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x0000020E06C9DA40>
           │    └ <function BaseEventLoop.run_until_complete at 0x0000020E064DE670>
           └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 629, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x0000020E064DE5E0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 596, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x0000020E064E1160>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>

  File "C:\else_env\Python39\lib\asyncio\base_events.py", line 1890, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x0000020E06470DC0>
    └ <Handle <TaskStepMethWrapper object at 0x0000020E37CC8D90>()>

  File "C:\else_env\Python39\lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x0000020E37CC8D90>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x0000020E37CC8D90>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x0000020E37CC8D90>()>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\base.py", line 141, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x0000020E37C9EDC0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000020E37C9EEE0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8003), 'cl...
          │    └ <starlette.middleware.cors.CORSMiddleware object at 0x0000020E37B147C0>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x0000020E37B14760>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x0000020E37C9EDC0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000020E37C9EEE0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8003), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x0000020E37B14700>
          └ <starlette.middleware.cors.CORSMiddleware object at 0x0000020E37B147C0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
          │                            │    │    │     │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x0000020E37C9EDC0>
          │                            │    │    │     │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000020E37C9EEE0>
          │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8003), 'cl...
          │                            │    │    └ <starlette.requests.Request object at 0x0000020E37CC88B0>
          │                            │    └ <fastapi.routing.APIRouter object at 0x0000020E07DDBBB0>
          │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x0000020E37B14700>
          └ <function wrap_app_handling_exceptions at 0x0000020E07D1A160>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000020E37B42A60>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000020E37C9EEE0>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8003), 'cl...
          └ <fastapi.routing.APIRouter object at 0x0000020E07DDBBB0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000020E37B42A60>
          │    │                │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000020E37C9EEE0>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8003), 'cl...
          │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0x0000020E07DDBBB0>>
          └ <fastapi.routing.APIRouter object at 0x0000020E07DDBBB0>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 734, in app
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000020E37B42A60>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000020E37C9EEE0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8003), 'cl...
          │     └ <function Route.handle at 0x0000020E07D39820>
          └ APIRoute(path='/data/index', name='get_history_data', methods=['GET'])

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000020E37B42A60>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000020E37C9EEE0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8003), 'cl...
          │    └ <function request_response.<locals>.app at 0x0000020E37AF4AF0>
          └ APIRoute(path='/data/index', name='get_history_data', methods=['GET'])

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
          │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000020E37B42A60>
          │                            │    │        │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000020E37C9EEE0>
          │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8003), 'cl...
          │                            │    └ <starlette.requests.Request object at 0x0000020E37CC8BE0>
          │                            └ <function request_response.<locals>.app.<locals>.app at 0x0000020E37B42790>
          └ <function wrap_app_handling_exceptions at 0x0000020E07D1A160>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000020E37CCBAF0>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000020E37C9EEE0>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8003), 'cl...
          └ <function request_response.<locals>.app.<locals>.app at 0x0000020E37B42790>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
                     │ └ <starlette.requests.Request object at 0x0000020E37CC8BE0>
                     └ <function get_request_handler.<locals>.app at 0x0000020E37AF4D30>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x0000020E07D3F430>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\.venv\lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'source': 'tushare', 'market': 'SH', 'code': '000001', 'start_date': '20050501', 'end_date': '20050520'}
                 │         └ <function get_history_data at 0x0000020E37AF4160>
                 └ Dependant(path_params=[], query_params=[ModelField(field_info=Query(akshare), name='source', mode='validation'), ModelField(f...

  File "C:\proj\ELSE\SELF\py-fastapi-demo\app\routers\router.py", line 15, in get_history_data
    df = data_service.get_stock_history(source=source, code=code, market=market, start_date=start_date, end_date=end_date)
         │            │                        │            │            │                  │                    └ '20050520'
         │            │                        │            │            │                  └ '20050501'
         │            │                        │            │            └ 'SH'
         │            │                        │            └ '000001'
         │            │                        └ 'tushare'
         │            └ <function get_stock_history at 0x0000020E07E53700>
         └ <module 'app.services.data_service' from 'C:\\proj\\ELSE\\SELF\\py-fastapi-demo\\app\\services\\data_service.py'>

> File "C:\proj\ELSE\SELF\py-fastapi-demo\app\services\data_service.py", line 23, in get_stock_history
    df = data_provider.get_stock_history(source=source, code=code, market=market, start_date=start_date, end_date=end_date)
         │             │                        │            │            │                  │                    └ '20050520'
         │             │                        │            │            │                  └ '20050501'
         │             │                        │            │            └ 'SH'
         │             │                        │            └ '000001'
         │             │                        └ 'tushare'
         │             └ <function catch.<locals>.decorator.<locals>.wrapper at 0x0000020E1890BC10>
         └ <data_providers.tushare.TushareProvider object at 0x0000020E37CC8250>

  File "C:\proj\ELSE\SELF\py-fastapi-demo\core\logger.py", line 28, in wrapper

  File "C:\proj\ELSE\SELF\py-fastapi-demo\data_providers\tushare.py", line 35, in get_stock_history
    :return: DataFrame

RuntimeError: 从 tushare 获取股票 000001 数据失败: 从 tushare 获取股票 000001 的数据为空
2025-07-02 17:18:13.057 | INFO     | app.services.data_service:get_stock_history:22 - [Bridge]获取股票历史行情数据并标准化输出格式 for 000001.SH from tushare
2025-07-02 17:18:13.066 | INFO     | data_providers.tushare:get_stock_history:25 - [Provider]source=tushare, code=000001, market=SH, start_date=20050501, end_date=20050520
2025-07-02 17:18:13.174 | INFO     | data_providers.tushare:get_stock_history:28 - [Provider]tushare 返回的数据列名: ['ts_code', 'trade_date', 'open', 'high', 'low', 'close', 'pre_close', 'change', 'pct_chg', 'vol', 'amount']
2025-07-02 17:18:13.174 | WARNING  | app.services.data_service:get_stock_history:27 - No data returned from tushare for 000001.SH
2025-07-02 17:29:56.476 | INFO     | app.services.data_service:get_stock_history:22 - [Bridge]获取股票历史行情数据并标准化输出格式 for 000001.SH from tushare
2025-07-02 17:29:56.480 | INFO     | data_providers.tushare:get_stock_history:25 - [Provider]source=tushare, code=000001, market=SH, start_date=20050501, end_date=20050520
2025-07-02 17:29:56.586 | INFO     | data_providers.tushare:get_stock_history:28 - [Provider]tushare 返回的数据列名: ['ts_code', 'trade_date', 'open', 'high', 'low', 'close', 'pre_close', 'change', 'pct_chg', 'vol', 'amount']
2025-07-02 17:29:56.586 | WARNING  | app.services.data_service:get_stock_history:27 - No data returned from tushare for 000001.SH
2025-07-02 17:31:18.149 | INFO     | app.services.data_service:get_stock_history:22 - [Bridge]获取股票历史行情数据并标准化输出格式 for 000001.SH from tushare
2025-07-02 17:31:18.156 | INFO     | data_providers.tushare:get_stock_history:25 - [Provider]source=tushare, code=000001, market=SH, start_date=20050501, end_date=20050520
2025-07-02 17:31:18.256 | INFO     | data_providers.tushare:get_stock_history:28 - [Provider]tushare 返回的数据列名: ['ts_code', 'trade_date', 'open', 'high', 'low', 'close', 'pre_close', 'change', 'pct_chg', 'vol', 'amount']
2025-07-02 17:31:18.256 | WARNING  | app.services.data_service:get_stock_history:27 - No data returned from tushare for 000001.SH
